(this["webpackJsonpjuju-dashboard"]=this["webpackJsonpjuju-dashboard"]||[]).push([[0],{140:function(e,t,n){},155:function(e){e.exports=JSON.parse('{"a":"0.9.3"}')},20:function(e,t,n){"use strict";function s(e){const t=Object.getOwnPropertyNames(e.constructor.prototype);for(let n=0;n<t.length;n++){const s=t[n];"constructor"!==s&&"function"===typeof e[s]&&(e[s]=e[s].bind(e))}}function a(e,t,n,s){return(a,r)=>{a?e?e(a,null):n(a):(s&&(r=s(r)),e?e(null,r):t(r))}}n.r(t),n.d(t,"autoBind",(function(){return s})),n.d(t,"createAsyncHandler",(function(){return a}))},328:function(e,t){},330:function(e,t){},340:function(e,t){},342:function(e,t){},369:function(e,t){},370:function(e,t){},375:function(e,t){},377:function(e,t){},384:function(e,t){},403:function(e,t){},420:function(e,t){},436:function(e,t,n){},437:function(e,t,n){},438:function(e,t,n){},439:function(e,t,n){},441:function(e,t,n){},442:function(e,t,n){},443:function(e,t,n){},444:function(e,t,n){},445:function(e,t,n){},446:function(e,t,n){},447:function(e,t,n){},448:function(e,t,n){},449:function(e,t,n){},450:function(e,t,n){},451:function(e,t,n){},452:function(e,t,n){},462:function(e,t,n){},463:function(e,t,n){},464:function(e,t,n){},465:function(e,t,n){},466:function(e,t,n){},467:function(e,t,n){},538:function(e,t,n){},539:function(e,t,n){},540:function(e,t,n){},541:function(e,t,n){},542:function(e,t,n){},543:function(e,t,n){},544:function(e,t,n){},545:function(e,t,n){},546:function(e,t,n){},547:function(e,t,n){},548:function(e,t,n){},549:function(e,t,n){"use strict";n.r(t);var s=n(1),a=n(62),r=n.n(a),c=n(3),i=n(94),o=n(240),l=n(233),d=n(152),u=n(555),p=n(31),j=n(10),m=n(22),b=n(4),h=n(80),O=n(0);class v extends s.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){p.c((n=>{n.setExtras(t);const s=p.a(e);this.setState({eventId:s})}))}render(){const{hasError:e}=this.state,{children:t}=this.props;return e?Object(O.jsx)("div",{className:"p-notification--negative",children:Object(O.jsxs)("p",{className:"p-notification__response",children:[Object(O.jsx)("span",{className:"p-notification__status",children:"Error: "}),"Something has gone wrong. If this issue persists,"," ",Object(O.jsx)("a",{href:"https://github.com/canonical-web-and-design/jaas-dashboard/issues/new?assignees=&labels=&template=bug_report.md&title=",children:"please raise an issue on GitHub."})]})}):t}}var f=n(17),g=n(12),x=n.n(g),w=n(556),_=n(557),y=n.p+"static/media/default-charm-icon.22a7fa5d.svg";function N(e,t,n){return e?Object(O.jsxs)("div",{className:"entity-name u-truncate",title:t,children:[n&&Object(O.jsx)("span",{className:"subordinate"}),e&&F(t,e),t]}):null}const C=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"unknown",t=arguments.length>1?arguments[1]:void 0,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=e?`is-${e.toLowerCase()}`:"",r="";void 0!==t&&(r=` (${t})`);const c=n?"status-icon "+a:"";return s&&"is-running"===a?Object(O.jsxs)("span",{className:"status-icon is-spinner",children:[Object(O.jsx)("i",{className:"p-icon--spinner u-animation--spin"}),e]}):Object(O.jsxs)("span",{className:c,children:[e,r]})},k=["running","alert","blocked"],A=(e,t)=>k.indexOf(e)>k.indexOf(t)?e:t,S=e=>e===k[k.length-1],E=e=>{let t=k[0],n=[];const s=e.applications||{};return Object.keys(s).forEach((e=>{const a=s[e],{status:r}=M(a);if(t=A(r,t),S(t))return void n.push(a.status.info);const c=a.units||{};Object.keys(c).forEach((e=>{const s=c[e],{status:a}=I(s);t=A(a,t),S(t)&&n.push(s["agent-status"].info)}))})),{highestStatus:t,messages:n}},M=e=>{const t=e.status.status,n={status:"running",message:null};return["blocked"].includes(t)&&(n.status="blocked"),["unknown"].includes(t)&&(n.status="alert"),n},R=e=>{const t=e["agent-status"].status,n={status:"running",message:null};return["down"].includes(t)&&(n.status="blocked"),["pending"].includes(t)&&(n.status="alert"),n},I=e=>{const t=e["agent-status"].status,n={status:"running",message:null};return["lost"].includes(t)&&(n.status="blocked"),["allocating"].includes(t)&&(n.status="alert"),n},P=e=>e.split("@")[0].replace("user-",""),L=(e,t)=>{const n={active:"active",allocating:"allocating",down:"down",joined:"joined",lost:"lost",running:"running",started:"started",unknown:"unknown",waiting:"waiting"};return 1===e?t:n[t]?n[t]:`${t}s`},U=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e.replace("cloud-","")},$=e=>{if(!e)return"-";let t=e.split("cloudcred-")[1];return t.indexOf("@")>-1?t.split("@")[1].split("_")[1]:t.split("_")[1]},q=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e.split("-").pop()},T=e=>{if(0===e.indexOf("local:"))return y;if(0===e.indexOf("cs:"))return`https://charmhub.io/${e=(e=(e=(e=(e=(e=(e=(e=(e=e.replace("cs:~","")).replace("cs:","")).replace("precise/","")).replace("trusty/","")).replace("xenial/","")).replace("bionic/","")).replace("focal/","")).replace("/","-")).substr(0,e.lastIndexOf("-",e.length))}/icon`;if(0===e.indexOf("ch:")){return`https://charmhub.io/${e.match(/\/(.+)\/(.+)-\d+/)[2]}/icon`}return""},D=e=>e||void 0!==e,F=(e,t)=>{let n=y;return 0!==t.indexOf("local:")&&(n=T(t)),Object(O.jsx)("img",{alt:e+" icon",title:e,width:"24",height:"24",className:"entity-icon",src:n},e)},V=(e,t)=>{const n=t[e];if(n&&e)return F(e,n["charm-url"])},K=(e,t)=>{let n=!1;const s=["admin","write","owner"];return t&&t.forEach((t=>{t.user===e&&s.includes(t.access)&&(n=!0)})),n},H=e=>{var t;return null!==e&&void 0!==e&&null!==(t=e.juju)&&void 0!==t&&t.modelData?e.juju.modelData:null},B=e=>{var t;return null===e||void 0===e||null===(t=e.juju)||void 0===t?void 0:t.controllers},W=e=>{var t;return null===e||void 0===e||null===(t=e.root)||void 0===t?void 0:t.bakery},J=e=>{var t;return null===e||void 0===e||null===(t=e.root)||void 0===t?void 0:t.config},G=(e,t)=>{var n,s;return null===t||void 0===t||null===(n=t.root)||void 0===n||null===(s=n.credentials)||void 0===s?void 0:s[e]},Y=e=>{var t;return null===e||void 0===e||null===(t=e.root)||void 0===t?void 0:t.loginError},z=e=>{var t;return null===e||void 0===e||null===(t=e.root)||void 0===t?void 0:t.appVersion},X=e=>Object(f.a)([H,B],((t,n)=>te(e,t,n))),Q=e=>{const t={blocked:[],alert:[],running:[]};if(!e)return t;for(let n in e){const s=e[n],{highestStatus:a}=E(s);t[a].push(s)}return t},Z=e=>{const t={};if(!e)return t;for(let n in e){const s=e[n];if(s.info){const e=P(s.info["owner-tag"]);t[e]||(t[e]=[]),t[e].push(s)}}return t},ee=e=>{const t={};if(!e)return t;for(let n in e){const s=e[n];if(s.info){const e=U(s.info["cloud-tag"]);t[e]||(t[e]=[]),t[e].push(s)}}return t},te=(e,t,n)=>{const s=x()(t);if(Object.entries(s).forEach((e=>{if(e[1].info){let t=null;const s=e[1].info;n&&Object.entries(n).some((e=>{var n;return t=null===(n=e[1].find((e=>s["controller-uuid"]===e.uuid)))||void 0===n?void 0:n.path,t})),"a030379a-940f-4760-8fcf-3062b41a04e7"===s["controller-uuid"]&&(t="JAAS"),t||(t=s["controller-uuid"]),s.controllerName=t}})),!e)return s;const a={};return Object.entries(e).forEach((e=>{0!==e[1].length&&(a[e[0]]||(a[e[0]]=[]),a[e[0]].push(e[1]))})),Object.entries(s).forEach((e=>{var t;let[n,r]=e;const c=null===r||void 0===r||null===(t=r.model)||void 0===t?void 0:t.name,i=(null===r||void 0===r?void 0:r.model)&&U(r.model["cloud-tag"]),o=(null===r||void 0===r?void 0:r.info)&&$(r.info["cloud-credential-tag"]),l=(null===r||void 0===r?void 0:r.model)&&r.model.region,d=(null===r||void 0===r?void 0:r.info)&&P(r.info["owner-tag"]),u=`${c} ${i} ${o} ${l} ${d}`;Object.entries(a).some((e=>{let[t,n]=e;const s=n[0];switch(t){case"cloud":return!s.includes(i);case"credential":if(r.info)return!s.includes(o);break;case"region":return!s.includes(l);case"owner":if(r.info)return!s.includes(d);break;case"custom":function a(e){return u.includes(e)}return!s.some((e=>a(e)))}return!1}))&&delete s[n]})),s},ne=e=>Object(f.a)(H,(t=>((e,t)=>{let n=null,s=null;if(null!==e&&void 0!==e&&e.includes("/")?[n,s]=e.split("/"):s=e,t)for(let a in t){const e=t[a].info;if(e&&e.name===s){if(!n)return a;if(e["owner-tag"]===`user-${n}`)return a}}return null})(e,t))),se=(Object(f.a)((e=>{var t;let n=null;return null!==e&&void 0!==e&&null!==(t=e.root)&&void 0!==t&&t.bakery&&(n=e.root.bakery.storage._store),n}),(e=>{if(!e)return null;let t={};return Object.keys(e).forEach((n=>{try{t[n]=JSON.parse(atob(e[n]))}catch(s){console.error("Unable to decode macaroons",s)}})),t})),(e,t)=>{var n,s,a,r;return null===(n=t.root.controllerConnections)||void 0===n||null===(s=n[e])||void 0===s||null===(a=s.info)||void 0===a||null===(r=a.user)||void 0===r?void 0:r.identity}),ae=(e,t)=>{var n,s;return null===t||void 0===t||null===(n=t.root)||void 0===n||null===(s=n.controllerConnections)||void 0===s?void 0:s[e]},re=e=>{var t;return null===e||void 0===e||null===(t=e.root)||void 0===t?void 0:t.controllerConnections},ce=(e,t)=>{var n,s,a;return null===t||void 0===t||null===(n=t.root)||void 0===n||null===(s=n.controllerConnections)||void 0===s||null===(a=s[e])||void 0===a?void 0:a.info.user.identity},ie=e=>Object(f.a)(H,(t=>((e,t)=>t&&t[e]?t[e]:null)(e,t))),oe=Object(f.a)(H,Q),le=Object(f.a)(H,(e=>{const t={blocked:[],alert:[],running:[]};if(!e)return t;for(let n in e){const s=e[n];for(let e in s.machines){const n=s.machines[e];t[R(n).status].push(n)}}return t})),de=Object(f.a)(H,(e=>{const t={blocked:[],alert:[],running:[]};if(!e)return t;for(let n in e){const s=e[n];for(let e in s.applications){const n=s.applications[e];for(let e in n.units){const s=n.units[e];t[I(s).status].push(s)}}}return t})),ue=Object(f.a)(H,(e=>{const t={blocked:[],alert:[],running:[]};if(!e)return t;for(let n in e){const s=e[n];for(let e in s.applications){const n=s.applications[e];t[M(n).status].push(n)}}return t})),pe=Object(f.a)(oe,(e=>({blocked:e.blocked.length,alert:e.alert.length,running:e.running.length}))),je=Object(f.a)(J,(e=>e.controllerAPIEndpoint));var me=n(236),be=n.n(me),he=n(20);class Oe{constructor(e,t){this.version=3,this._transport=e,this._info=t,Object(he.autoBind)(this)}login(e){return new Promise(((t,n)=>{const s={type:"Admin",request:"Login",version:3,params:e};this._transport.write(s,t,n)}))}redirectInfo(){return new Promise(((e,t)=>{this._transport.write({type:"Admin",request:"RedirectInfo",version:3},e,t)}))}}Oe.NAME="Admin",Oe.VERSION=3;var ve=Oe;function fe(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return t.bakery||(t.bakery=null),t.closeCallback||(t.closeCallback=()=>{}),t.debug||(t.debug=!1),t.facades||(t.facades=[]),t.wsclass||console.error("No websocket provided. define 'wsclass'."),new Promise(((s,a)=>{const r=new t.wsclass(e),c=Object(he.createAsyncHandler)(n,s,a);r.onopen=e=>{c(null,new xe(r,t))},r.onclose=e=>{c("cannot connect WebSocket: "+e.reason,null)},r.onerror=e=>{console.log("--",e)}}))}function ge(e,t,n){return new Promise((async(s,a)=>{let r;try{r=await fe(e,n);s({conn:await r.login(t),logout:r.logout.bind(r)})}catch(c){if(!r||!r.isRedirectionError(c))return void a(c);r&&r.logout();for(let a=0;a<c.servers.length;a++){const r=c.servers[a][0];if("hostname"===r.type&&"public"===r.scope){const a=(e,t)=>{let n=e;if(n.startsWith("wss://")||n.startsWith("ws://")){const e=n.split("/");n=e[e.length-2]}return`wss://${t.value}:${t.port}/model/${n}/api`};s(ge(a(e,r),t,n))}}a("cannot connect to model after redirection")}}))}class xe{constructor(e,t){this._transport=new Ce(e,t.closeCallback,t.debug),this._facades=t.facades,this._bakery=t.bakery,this._admin=new ve(this._transport,{})}login(e){const t={},n=this._transport._ws.url,s=new URL(n).origin;if(e.username&&e.password)t.credentials=e.password,t["auth-tag"]=`user-${e.username}`;else{const e=this._bakery.storage.get(s);let n;e&&(n=JSON.parse(atob(e))),t.macaroons=[n]}return t["client-version"]="3.0.0",new Promise((async(n,a)=>{try{const r=await this._admin.login(t),c=r["discharge-required"]||r["bakery-discharge-required"];if(c){if(!this._bakery)return void a("macaroon discharge required but no bakery instance provided");const t=t=>{const a=btoa(JSON.stringify(t));return this._bakery.storage.set(s,a,(()=>{})),e.macaroons=[t],n(this.login(e))},r=e=>{a("macaroon discharge failed: "+e)};return void this._bakery.discharge(c,t,r)}if(r===we)throw r;if(r===_e)throw"response\nHave you been granted permission to a model on this controller?";if(r===ye)throw"response\nEnsure that you've been given 'login' permission on this controller.";if("string"===typeof r)throw r;n(new ke(this._transport,this._facades,r))}catch(r){if(r!==we)return void a(r);try{const e=await this._admin.redirectInfo();return void a(new Ne(e))}catch(r){return void a(r)}}}))}logout(e){this._transport.close(e)}isRedirectionError(e){return e instanceof Ne}}const we="redirection required",_e="invalid entity name or password",ye="permission denied";class Ne{constructor(e){this.servers=e.servers,this.caCert=e["ca-cert"]}}class Ce{constructor(e,t,n){this._ws=e,this._counter=0,this._callbacks={},this._closeCallback=t,this._debug=n,e.onmessage=e=>{this._debug&&console.debug("<--",e.data),this._handle(e.data)},e.onclose=e=>{this._debug&&console.debug("close:",e.code,e.reason),this._closeCallback(e.code)}}write(e,t,n){const s=this._ws.readyState;if(1!==s){n(`cannot send request ${JSON.stringify(e)}: connection state ${s} is not open`)}this._counter+=1,e["request-id"]=this._counter,this._callbacks[this._counter]=t;const a=JSON.stringify(e);this._debug&&console.debug("--\x3e",a),this._ws.send(a)}close(e){const t=this._closeCallback;this._closeCallback=n=>{e?e(n,t):t(n)},this._ws.close()}_handle(e){const t=JSON.parse(e),n=t["request-id"],s=this._callbacks[n];delete this._callbacks[n],s&&s(t.error||t.response)}}class ke{constructor(e,t,n){this.transport=e,this.loginResult=n,this.info={controllerTag:n["controller-tag"],serverVersion:n["server-version"],servers:n.servers,user:n["user-info"],getFacade:e=>this.facades[e]};const s=t.reduce(((e,t)=>(e[t.NAME]=t,e)),{});this.facades=n.facades.reduce(((e,t)=>{const n=s[t.name];if(n&&t.versions.includes(n.VERSION)){return e[function(e){if(!e)return"";const t=e=>e.toLowerCase()===e;if(t(e[0]))return e;const n=[];for(let a=0;a<e.length;a++){const s=e.charAt(a);if(t(s))break;n.push(s)}n.length>1&&n.pop();const s=n.join("");return s.toLowerCase()+e.slice(s.length)}(n.NAME)]=new n(this.transport,this.info),e}return e}),{})}}class Ae{constructor(e,t){this.version=7,this._transport=e,this._info=t,Object(he.autoBind)(this)}actions(e){return new Promise(((t,n)=>{const s={type:"Action",request:"Actions",version:7,params:e};this._transport.write(s,t,n)}))}applicationsCharmsActions(e){return new Promise(((t,n)=>{const s={type:"Action",request:"ApplicationsCharmsActions",version:7,params:e};this._transport.write(s,t,n)}))}cancel(e){return new Promise(((t,n)=>{const s={type:"Action",request:"Cancel",version:7,params:e};this._transport.write(s,t,n)}))}enqueueOperation(e){return new Promise(((t,n)=>{const s={type:"Action",request:"EnqueueOperation",version:7,params:e};this._transport.write(s,t,n)}))}listOperations(e){return new Promise(((t,n)=>{const s={type:"Action",request:"ListOperations",version:7,params:e};this._transport.write(s,t,n)}))}operations(e){return new Promise(((t,n)=>{const s={type:"Action",request:"Operations",version:7,params:e};this._transport.write(s,t,n)}))}run(e){return new Promise(((t,n)=>{const s={type:"Action",request:"Run",version:7,params:e};this._transport.write(s,t,n)}))}runOnAllMachines(e){return new Promise(((t,n)=>{const s={type:"Action",request:"RunOnAllMachines",version:7,params:e};this._transport.write(s,t,n)}))}watchActionsProgress(e){return new Promise(((t,n)=>{const s={type:"Action",request:"WatchActionsProgress",version:7,params:e};this._transport.write(s,t,n)}))}}Ae.NAME="Action",Ae.VERSION=7;var Se=Ae;class Ee{constructor(e,t){this.version=2,this._transport=e,this._info=t,Object(he.autoBind)(this)}next(){return new Promise(((e,t)=>{this._transport.write({type:"AllWatcher",request:"Next",version:2},e,t)}))}stop(){return new Promise(((e,t)=>{this._transport.write({type:"AllWatcher",request:"Stop",version:2},e,t)}))}}Ee.NAME="AllWatcher",Ee.VERSION=2;var Me=Ee;class Re{constructor(e,t){this.version=2,this._transport=e,this._info=t,Object(he.autoBind)(this)}get(e){return new Promise(((t,n)=>{const s={type:"Annotations",request:"Get",version:2,params:e};this._transport.write(s,t,n)}))}set(e){return new Promise(((t,n)=>{const s={type:"Annotations",request:"Set",version:2,params:e};this._transport.write(s,t,n)}))}}Re.NAME="Annotations",Re.VERSION=2;var Ie=Re;class Pe{constructor(e,t){this.version=14,this._transport=e,this._info=t,Object(he.autoBind)(this)}addRelation(e){return new Promise(((t,n)=>{const s={type:"Application",request:"AddRelation",version:14,params:e};this._transport.write(s,t,n)}))}addUnits(e){return new Promise(((t,n)=>{const s={type:"Application",request:"AddUnits",version:14,params:e};this._transport.write(s,t,n)}))}applicationsInfo(e){return new Promise(((t,n)=>{const s={type:"Application",request:"ApplicationsInfo",version:14,params:e};this._transport.write(s,t,n)}))}charmConfig(e){return new Promise(((t,n)=>{const s={type:"Application",request:"CharmConfig",version:14,params:e};this._transport.write(s,t,n)}))}charmRelations(e){return new Promise(((t,n)=>{const s={type:"Application",request:"CharmRelations",version:14,params:e};this._transport.write(s,t,n)}))}consume(e){return new Promise(((t,n)=>{const s={type:"Application",request:"Consume",version:14,params:e};this._transport.write(s,t,n)}))}deploy(e){return new Promise(((t,n)=>{const s={type:"Application",request:"Deploy",version:14,params:e};this._transport.write(s,t,n)}))}destroy(e){return new Promise(((t,n)=>{const s={type:"Application",request:"Destroy",version:14,params:e};this._transport.write(s,t,n)}))}destroyApplication(e){return new Promise(((t,n)=>{const s={type:"Application",request:"DestroyApplication",version:14,params:e};this._transport.write(s,t,n)}))}destroyConsumedApplications(e){return new Promise(((t,n)=>{const s={type:"Application",request:"DestroyConsumedApplications",version:14,params:e};this._transport.write(s,t,n)}))}destroyRelation(e){return new Promise(((t,n)=>{const s={type:"Application",request:"DestroyRelation",version:14,params:e};this._transport.write(s,t,n)}))}destroyUnit(e){return new Promise(((t,n)=>{const s={type:"Application",request:"DestroyUnit",version:14,params:e};this._transport.write(s,t,n)}))}destroyUnits(e){return new Promise(((t,n)=>{const s={type:"Application",request:"DestroyUnits",version:14,params:e};this._transport.write(s,t,n)}))}expose(e){return new Promise(((t,n)=>{const s={type:"Application",request:"Expose",version:14,params:e};this._transport.write(s,t,n)}))}get(e){return new Promise(((t,n)=>{const s={type:"Application",request:"Get",version:14,params:e};this._transport.write(s,t,n)}))}getCharmURLOrigin(e){return new Promise(((t,n)=>{const s={type:"Application",request:"GetCharmURLOrigin",version:14,params:e};this._transport.write(s,t,n)}))}getConfig(e){return new Promise(((t,n)=>{const s={type:"Application",request:"GetConfig",version:14,params:e};this._transport.write(s,t,n)}))}getConstraints(e){return new Promise(((t,n)=>{const s={type:"Application",request:"GetConstraints",version:14,params:e};this._transport.write(s,t,n)}))}leader(e){return new Promise(((t,n)=>{const s={type:"Application",request:"Leader",version:14,params:e};this._transport.write(s,t,n)}))}mergeBindings(e){return new Promise(((t,n)=>{const s={type:"Application",request:"MergeBindings",version:14,params:e};this._transport.write(s,t,n)}))}resolveUnitErrors(e){return new Promise(((t,n)=>{const s={type:"Application",request:"ResolveUnitErrors",version:14,params:e};this._transport.write(s,t,n)}))}scaleApplications(e){return new Promise(((t,n)=>{const s={type:"Application",request:"ScaleApplications",version:14,params:e};this._transport.write(s,t,n)}))}setCharm(e){return new Promise(((t,n)=>{const s={type:"Application",request:"SetCharm",version:14,params:e};this._transport.write(s,t,n)}))}setConfigs(e){return new Promise(((t,n)=>{const s={type:"Application",request:"SetConfigs",version:14,params:e};this._transport.write(s,t,n)}))}setConstraints(e){return new Promise(((t,n)=>{const s={type:"Application",request:"SetConstraints",version:14,params:e};this._transport.write(s,t,n)}))}setMetricCredentials(e){return new Promise(((t,n)=>{const s={type:"Application",request:"SetMetricCredentials",version:14,params:e};this._transport.write(s,t,n)}))}setRelationsSuspended(e){return new Promise(((t,n)=>{const s={type:"Application",request:"SetRelationsSuspended",version:14,params:e};this._transport.write(s,t,n)}))}unexpose(e){return new Promise(((t,n)=>{const s={type:"Application",request:"Unexpose",version:14,params:e};this._transport.write(s,t,n)}))}unitsInfo(e){return new Promise(((t,n)=>{const s={type:"Application",request:"UnitsInfo",version:14,params:e};this._transport.write(s,t,n)}))}unsetApplicationsConfig(e){return new Promise(((t,n)=>{const s={type:"Application",request:"UnsetApplicationsConfig",version:14,params:e};this._transport.write(s,t,n)}))}updateApplicationSeries(e){return new Promise(((t,n)=>{const s={type:"Application",request:"UpdateApplicationSeries",version:14,params:e};this._transport.write(s,t,n)}))}}Pe.NAME="Application",Pe.VERSION=14;var Le=Pe;class Ue{constructor(e,t){this.version=5,this._transport=e,this._info=t,Object(he.autoBind)(this)}findTools(e){return new Promise(((t,n)=>{const s={type:"Client",request:"FindTools",version:5,params:e};this._transport.write(s,t,n)}))}fullStatus(e){return new Promise(((t,n)=>{const s={type:"Client",request:"FullStatus",version:5,params:e};this._transport.write(s,t,n)}))}statusHistory(e){return new Promise(((t,n)=>{const s={type:"Client",request:"StatusHistory",version:5,params:e};this._transport.write(s,t,n)}))}watchAll(){return new Promise(((e,t)=>{this._transport.write({type:"Client",request:"WatchAll",version:5},e,t)}))}}Ue.NAME="Client",Ue.VERSION=5;var $e=Ue;class qe{constructor(e,t){this.version=7,this._transport=e,this._info=t,Object(he.autoBind)(this)}addCloud(e){return new Promise(((t,n)=>{const s={type:"Cloud",request:"AddCloud",version:7,params:e};this._transport.write(s,t,n)}))}addCredentials(e){return new Promise(((t,n)=>{const s={type:"Cloud",request:"AddCredentials",version:7,params:e};this._transport.write(s,t,n)}))}checkCredentialsModels(e){return new Promise(((t,n)=>{const s={type:"Cloud",request:"CheckCredentialsModels",version:7,params:e};this._transport.write(s,t,n)}))}cloud(e){return new Promise(((t,n)=>{const s={type:"Cloud",request:"Cloud",version:7,params:e};this._transport.write(s,t,n)}))}cloudInfo(e){return new Promise(((t,n)=>{const s={type:"Cloud",request:"CloudInfo",version:7,params:e};this._transport.write(s,t,n)}))}clouds(){return new Promise(((e,t)=>{this._transport.write({type:"Cloud",request:"Clouds",version:7},e,t)}))}credential(e){return new Promise(((t,n)=>{const s={type:"Cloud",request:"Credential",version:7,params:e};this._transport.write(s,t,n)}))}credentialContents(e){return new Promise(((t,n)=>{const s={type:"Cloud",request:"CredentialContents",version:7,params:e};this._transport.write(s,t,n)}))}instanceTypes(e){return new Promise(((t,n)=>{const s={type:"Cloud",request:"InstanceTypes",version:7,params:e};this._transport.write(s,t,n)}))}listCloudInfo(e){return new Promise(((t,n)=>{const s={type:"Cloud",request:"ListCloudInfo",version:7,params:e};this._transport.write(s,t,n)}))}modifyCloudAccess(e){return new Promise(((t,n)=>{const s={type:"Cloud",request:"ModifyCloudAccess",version:7,params:e};this._transport.write(s,t,n)}))}removeClouds(e){return new Promise(((t,n)=>{const s={type:"Cloud",request:"RemoveClouds",version:7,params:e};this._transport.write(s,t,n)}))}revokeCredentialsCheckModels(e){return new Promise(((t,n)=>{const s={type:"Cloud",request:"RevokeCredentialsCheckModels",version:7,params:e};this._transport.write(s,t,n)}))}updateCloud(e){return new Promise(((t,n)=>{const s={type:"Cloud",request:"UpdateCloud",version:7,params:e};this._transport.write(s,t,n)}))}updateCredentialsCheckModels(e){return new Promise(((t,n)=>{const s={type:"Cloud",request:"UpdateCredentialsCheckModels",version:7,params:e};this._transport.write(s,t,n)}))}userCredentials(e){return new Promise(((t,n)=>{const s={type:"Cloud",request:"UserCredentials",version:7,params:e};this._transport.write(s,t,n)}))}}qe.NAME="Cloud",qe.VERSION=7;var Te=qe;class De{constructor(e,t){this.version=11,this._transport=e,this._info=t,Object(he.autoBind)(this)}allModels(){return new Promise(((e,t)=>{this._transport.write({type:"Controller",request:"AllModels",version:11},e,t)}))}cloudSpec(e){return new Promise(((t,n)=>{const s={type:"Controller",request:"CloudSpec",version:11,params:e};this._transport.write(s,t,n)}))}configSet(e){return new Promise(((t,n)=>{const s={type:"Controller",request:"ConfigSet",version:11,params:e};this._transport.write(s,t,n)}))}controllerAPIInfoForModels(e){return new Promise(((t,n)=>{const s={type:"Controller",request:"ControllerAPIInfoForModels",version:11,params:e};this._transport.write(s,t,n)}))}controllerConfig(){return new Promise(((e,t)=>{this._transport.write({type:"Controller",request:"ControllerConfig",version:11},e,t)}))}controllerVersion(){return new Promise(((e,t)=>{this._transport.write({type:"Controller",request:"ControllerVersion",version:11},e,t)}))}dashboardConnectionInfo(){return new Promise(((e,t)=>{this._transport.write({type:"Controller",request:"DashboardConnectionInfo",version:11},e,t)}))}destroyController(e){return new Promise(((t,n)=>{const s={type:"Controller",request:"DestroyController",version:11,params:e};this._transport.write(s,t,n)}))}getCloudSpec(e){return new Promise(((t,n)=>{const s={type:"Controller",request:"GetCloudSpec",version:11,params:e};this._transport.write(s,t,n)}))}getControllerAccess(e){return new Promise(((t,n)=>{const s={type:"Controller",request:"GetControllerAccess",version:11,params:e};this._transport.write(s,t,n)}))}hostedModelConfigs(){return new Promise(((e,t)=>{this._transport.write({type:"Controller",request:"HostedModelConfigs",version:11},e,t)}))}identityProviderURL(){return new Promise(((e,t)=>{this._transport.write({type:"Controller",request:"IdentityProviderURL",version:11},e,t)}))}initiateMigration(e){return new Promise(((t,n)=>{const s={type:"Controller",request:"InitiateMigration",version:11,params:e};this._transport.write(s,t,n)}))}listBlockedModels(){return new Promise(((e,t)=>{this._transport.write({type:"Controller",request:"ListBlockedModels",version:11},e,t)}))}modelConfig(){return new Promise(((e,t)=>{this._transport.write({type:"Controller",request:"ModelConfig",version:11},e,t)}))}modelStatus(e){return new Promise(((t,n)=>{const s={type:"Controller",request:"ModelStatus",version:11,params:e};this._transport.write(s,t,n)}))}modifyControllerAccess(e){return new Promise(((t,n)=>{const s={type:"Controller",request:"ModifyControllerAccess",version:11,params:e};this._transport.write(s,t,n)}))}mongoVersion(){return new Promise(((e,t)=>{this._transport.write({type:"Controller",request:"MongoVersion",version:11},e,t)}))}removeBlocks(e){return new Promise(((t,n)=>{const s={type:"Controller",request:"RemoveBlocks",version:11,params:e};this._transport.write(s,t,n)}))}watchAllModelSummaries(){return new Promise(((e,t)=>{this._transport.write({type:"Controller",request:"WatchAllModelSummaries",version:11},e,t)}))}watchAllModels(){return new Promise(((e,t)=>{this._transport.write({type:"Controller",request:"WatchAllModels",version:11},e,t)}))}watchCloudSpecsChanges(e){return new Promise(((t,n)=>{const s={type:"Controller",request:"WatchCloudSpecsChanges",version:11,params:e};this._transport.write(s,t,n)}))}watchModelSummaries(){return new Promise(((e,t)=>{this._transport.write({type:"Controller",request:"WatchModelSummaries",version:11},e,t)}))}}De.NAME="Controller",De.VERSION=11;var Fe=De;class Ve{constructor(e,t){this.version=9,this._transport=e,this._info=t,Object(he.autoBind)(this)}changeModelCredential(e){return new Promise(((t,n)=>{const s={type:"ModelManager",request:"ChangeModelCredential",version:9,params:e};this._transport.write(s,t,n)}))}createModel(e){return new Promise(((t,n)=>{const s={type:"ModelManager",request:"CreateModel",version:9,params:e};this._transport.write(s,t,n)}))}destroyModels(e){return new Promise(((t,n)=>{const s={type:"ModelManager",request:"DestroyModels",version:9,params:e};this._transport.write(s,t,n)}))}dumpModels(e){return new Promise(((t,n)=>{const s={type:"ModelManager",request:"DumpModels",version:9,params:e};this._transport.write(s,t,n)}))}dumpModelsDB(e){return new Promise(((t,n)=>{const s={type:"ModelManager",request:"DumpModelsDB",version:9,params:e};this._transport.write(s,t,n)}))}listModelSummaries(e){return new Promise(((t,n)=>{const s={type:"ModelManager",request:"ListModelSummaries",version:9,params:e};this._transport.write(s,t,n)}))}listModels(e){return new Promise(((t,n)=>{const s={type:"ModelManager",request:"ListModels",version:9,params:e};this._transport.write(s,t,n)}))}modelDefaultsForClouds(e){return new Promise(((t,n)=>{const s={type:"ModelManager",request:"ModelDefaultsForClouds",version:9,params:e};this._transport.write(s,t,n)}))}modelInfo(e){return new Promise(((t,n)=>{const s={type:"ModelManager",request:"ModelInfo",version:9,params:e};this._transport.write(s,t,n)}))}modelStatus(e){return new Promise(((t,n)=>{const s={type:"ModelManager",request:"ModelStatus",version:9,params:e};this._transport.write(s,t,n)}))}modifyModelAccess(e){return new Promise(((t,n)=>{const s={type:"ModelManager",request:"ModifyModelAccess",version:9,params:e};this._transport.write(s,t,n)}))}setModelDefaults(e){return new Promise(((t,n)=>{const s={type:"ModelManager",request:"SetModelDefaults",version:9,params:e};this._transport.write(s,t,n)}))}unsetModelDefaults(e){return new Promise(((t,n)=>{const s={type:"ModelManager",request:"UnsetModelDefaults",version:9,params:e};this._transport.write(s,t,n)}))}}Ve.NAME="ModelManager",Ve.VERSION=9;var Ke=Ve;class He{constructor(e,t){this.version=1,this._transport=e,this._info=t,Object(he.autoBind)(this)}ping(){return new Promise(((e,t)=>{this._transport.write({type:"Pinger",request:"Ping",version:1},e,t)}))}stop(){return new Promise(((e,t)=>{this._transport.write({type:"Pinger",request:"Stop",version:1},e,t)}))}}He.NAME="Pinger",He.VERSION=1;var Be=He;const{autoBind:We}=n(20);class Je{constructor(e,t){this._transport=e,this._info=t,this.version=2,We(this)}disableControllerUUIDMasking(){return new Promise(((e,t)=>{const n={type:"JIMM",request:"DisableControllerUUIDMasking",version:2,params:{}};this._transport.write(n,e,t)}))}listControllers(){return new Promise(((e,t)=>{const n={type:"JIMM",request:"ListControllers",version:2,params:{}};this._transport.write(n,e,t)}))}}Je.NAME="JIMM",Je.VERSION=2;var Ge=Je;const Ye="CLEAR_CONTROLLER_DATA",ze="CLEAR_MODEL_DATA",Xe="UPDATE_CONTROLLER_LIST",Qe="UPDATE_MODEL_INFO",Ze="UPDATE_MODEL_STATUS",et="UPDATE_MODEL_LIST",tt="PROCESS_ALL_WATCHER_DELTAS",nt="POPULATE_MISSING_ALLWATCHER_DATA";function st(e,t){return{type:Xe,payload:{wsControllerURL:e,controllers:t}}}function at(e){return{type:et,payload:e}}function rt(e){return{type:Qe,payload:e}}function ct(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;const s=[Se,Me,Ie,Le,$e,Te,Fe,Ke,Ge];return e&&s.push(Be),{bakery:t,closeCallback:n,debug:!1,facades:s,wsclass:WebSocket}}function it(e,t){let n={};return t||(n={username:e.user,password:e.password}),n}function ot(e){const t=window.setInterval((()=>{e.facades.pinger.ping().catch((e=>{console.error("pinger stopped,",e),lt(t)}))}),2e4);return t}function lt(e){e&&clearInterval(e)}async function dt(e,t,n,s){const a=new Promise((e=>{setTimeout(e,5e3,"timeout")})),r=ge(e,it(t,s),n);return new Promise(((e,t)=>{Promise.race([a,r]).then((n=>{"timeout"!==n?e(n):t("timeout")}))}))}async function ut(e,t,n,s){const a=await async function(e,t,n){const s=n(),a=W(s),r=je(s),{identityProviderAvailable:c}=J(s);let i=!1;r===t&&(i=c);const o=t.replace("/api",`/model/${e}/api`);let l=null;if(se(t,n()))try{const e=G(t,n()),{conn:s,logout:r}=await dt(o,e,ct(!1,a),i);if(se(t,n())&&(l=await s.facades.client.fullStatus(),l.error))return void console.error(l.error);if(se(t,n())){const e=Object.keys(l.applications).map((e=>({tag:`application-${e}`}))),t=await s.facades.annotations.get({entities:e}),n={};t.results.forEach((e=>{if(Object.keys(e.annotations).length>0){const t=e.entity.replace("application-","");n[t]=e.annotations}})),l.annotations=n}r()}catch(d){console.error("error connecting to model:",e,d)}return l}(e,t,s);null!==a&&n(function(e,t){return{type:Ze,payload:{modelUUID:e,status:t}}}(e,a),{wsControllerURL:t})}async function pt(e,t){return await e.facades.modelManager.modelInfo({entities:[{tag:`model-${t}`}]})}async function jt(e,t,n,s){const a=s.getState,r=s.dispatch,c=new be.a({concurrency:1});return t.forEach((t=>{c.push((async s=>{if(se(e,a())&&await ut(t,e,r,a),se(e,a())){const s=await pt(n,t);r(rt(s),{wsControllerURL:e}),s.results[0].result.isController&&r(function(e,t){return async function(n,s){var a,r;const c=null===(a=s())||void 0===a||null===(r=a.juju)||void 0===r?void 0:r.controllers[e],i=t.results[0].result;if(c){const t=x()(c).map((e=>(e.uuid===i["controller-uuid"]&&(e.location={cloud:i["cloud-region"],region:i["cloud-tag"].replace("cloud-","")}),e)));n(st(e,t),{wsControllerURL:e})}else console.log("attempting to update non-existent controller:",e)}}(e,s),{wsControllerURL:e})}s()}))})),new Promise((e=>{c.onDone((()=>{e()}))}))}async function mt(e,t){const n=W(t),s=je(t),{identityProviderAvailable:a}=J(t),r=G(s,t),c=s.replace("/api",`/model/${e}/api`),{conn:i}=await dt(c,r,ct(!0,n),a);return i}async function bt(e,t,n){const s=await mt(e,t),a=await s.facades.client.watchAll(),r=e=>{var t;null!==e&&void 0!==e&&e.deltas&&n((t=null===e||void 0===e?void 0:e.deltas,{type:tt,payload:t})),s.facades.allWatcher._transport.write({type:"AllWatcher",request:"Next",version:1,id:a["watcher-id"]},r)},c=ot(s);return r(),{conn:s,watcherHandle:a,pingerIntervalId:c}}async function ht(e,t,n){try{const s=e.getState(),{identityProviderAvailable:a,isJuju:r}=J(s),c=je(s),i=G(c,s),o=re(s)||{};let l=[[c,i,t,a]];n&&(l=l.concat(n));const d=Object.keys(o);l=l.filter((e=>!d.includes(e[0]))),l.forEach((t=>async function(e,t,n){let s,a,r,c;try{if(({conn:s,error:a,juju:r,intervalId:c}=await async function(e,t,n,s){const r=await fe(e,ct(!0,n,(e=>console.log("controller closed",e)))),c=it(t,s);let i=null;try{i=await r.login(c)}catch(a){return{error:a}}return{conn:i,juju:r,intervalId:ot(i)}}(...e)),a)return void n.dispatch(function(e){return{type:gt,payload:e}}(a))}catch(l){return console.log("unable to log into controller",l,e)}var i,o;p.b("jujuVersion",null===(i=s)||void 0===i||null===(o=i.info)||void 0===o?void 0:o.serverVersion);if(n.dispatch(function(e,t){return{type:yt,payload:{wsControllerURL:e,conn:t}}}(e[0],s)),n.dispatch(function(e,t){return{type:Nt,payload:{wsControllerURL:e,juju:t}}}(e[0],r)),n.dispatch(function(e,t){return{type:Ct,payload:{wsControllerURL:e,intervalId:t}}}(e[0],c)),async function(e,t,n,s){let a=null;if(t.facades.jimM)a=(await t.facades.jimM.listControllers()).controllers,a.forEach((e=>e.additionalController=n));else{var r,c;const i=await t.facades.controller.controllerConfig();a=[{path:i.config["controller-name"],uuid:i.config["controller-uuid"],version:null===(r=ae(e,s.getState()))||void 0===r||null===(c=r.info)||void 0===c?void 0:c.serverVersion,additionalController:n}]}s.dispatch(st(e,a),{wsControllerURL:e})}(e[0],s,e[4],n),!t)try{await function(e){return new Promise((async(t,n)=>{var s;if(null!==e&&void 0!==e&&null!==(s=e.facades)&&void 0!==s&&s.jimM)try{await e.facades.jimM.disableControllerUUIDMasking(),t()}catch(l){n()}else t()}))}(s)}catch(l){}do{try{const t=await s.facades.modelManager.listModels({tag:s.info.user.identity});n.dispatch(at(t),{wsControllerURL:e[0]});const a=t["user-models"].map((e=>e.model.uuid));await jt(e[0],a,s,n)}catch(l){console.log(l)}await new Promise((e=>{setTimeout((()=>{e(!0)}),3e4)}))}while(se(e[0],n.getState()))}(t,r,e)))}catch(s){console.error("Something went wrong: ",s)}}const Ot="LOG_OUT",vt="STORE_BAKERY",ft="STORE_CONFIG",gt="STORE_LOGIN_ERROR",xt="STORE_USER_PASS",wt="STORE_VERSION",_t="STORE_VISIT_URL",yt="UPDATE_CONTROLLER_CONNECTION",Nt="UPDATE_JUJU_API_INSTANCE",Ct="UPDATE_PINGER_INTERVAL_ID";function kt(e,t){return{type:xt,payload:{wsControllerURL:e,credential:t}}}function At(e){async function t(t){var n,s;const a=e.getState(),r=null===a||void 0===a||null===(n=a.root)||void 0===n||null===(s=n.config)||void 0===s?void 0:s.identityProviderAvailable,c=W(a),i=(e=>{var t;return null===e||void 0===e||null===(t=e.root)||void 0===t?void 0:t.jujus})(a),o=(e=>{var t;return null===e||void 0===e||null===(t=e.root)||void 0===t?void 0:t.pingerIntervalIds})(a);c.storage._store.removeItem("identity"),c.storage._store.removeItem("https://api.jujucharms.com/identity"),localStorage.removeItem("additionalControllers"),Object.entries(i).forEach((e=>e[1].logout())),Object.entries(o).forEach((e=>clearInterval(e[1]))),t({type:Ot}),t({type:ze}),t({type:Ye}),r&&t(St(e,c))}return t.NAME="logOut",t}function St(e,t){async function n(n){let s=null;try{const e=window.localStorage.getItem("additionalControllers");e&&(s=JSON.parse(e),s.forEach((e=>{n(kt(e[0],e[1])),n(st(e[0],[{additionalController:!0}]))})))}catch(a){console.log("Error retrieving additional registered controllers",a)}ht(e,t,s)}return n.NAME="connectAndStartPolling",n}var Et=n(47),Mt=n.n(Et),Rt=n(558),It=n(554);function Pt(e){let{children:t,isActive:n=!0}=e;return Object(O.jsx)(O.Fragment,{children:n&&Object(O.jsx)(Rt.a,{children:Object(O.jsx)(It.a.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},children:t})})})}var Lt=n.p+"static/media/logo-black-on-white.3b8d326f.svg";n(436);function Ut(e){let{children:t}=e;const{identityProviderAvailable:n}=Object(c.c)(J),s=Object(c.c)(re)||{},a=Object.keys(s),r=Object(c.d)(),i=a.some((e=>se(e,r.getState()))),o=Object(c.c)(Y);return Object(O.jsxs)(O.Fragment,{children:[!i&&Object(O.jsx)("div",{className:"login",children:Object(O.jsx)(Pt,{isActive:!i,children:Object(O.jsxs)("div",{className:"login__inner p-card--highlighted",children:[Object(O.jsx)("img",{className:"login__logo",src:Lt,alt:"JAAS logo"}),n?Object(O.jsx)(qt,{userIsLoggedIn:i}):Object(O.jsx)(Tt,{}),$t(o)]})})}),Object(O.jsx)("div",{className:"app-content",children:t})]})}function $t(e){if(!e)return null;let t=null;switch(e){case'"user-" is not a valid user tag':t="Invalid user name";break;case"invalid entity name or password":t="Invalid user name or password";break;default:t=e}return Object(O.jsxs)("p",{className:"error-message",children:[Object(O.jsx)("i",{className:"p-icon--error"}),t]})}function qt(e){let{userIsLoggedIn:t}=e;const n=Object(c.c)((e=>{var n;if(!t)return null===e||void 0===e||null===(n=e.root)||void 0===n?void 0:n.visitURL}));return Object(O.jsx)(Dt,{visitURL:n})}function Tt(){const e=Object(c.b)(),t=Object(c.d)(),n=Object(c.c)(W),a=Object(s.useRef)();return Object(s.useEffect)((()=>{a.current.focus()}),[]),Object(O.jsxs)("form",{onSubmit:function(s){s.preventDefault();const a=s.currentTarget.elements,r=a.username.value,c=a.password.value;e(kt(je(t.getState()),{user:r,password:c})),e(St(t,n))},children:[Object(O.jsx)("label",{htmlFor:"username",children:"Username"}),Object(O.jsx)("input",{type:"text",name:"username",id:"username",ref:a}),Object(O.jsx)("label",{htmlFor:"password",children:"Password"}),Object(O.jsx)("input",{type:"password",name:"password",id:"password"}),Object(O.jsx)("button",{className:"p-button--positive",type:"submit",children:"Log in to the dashboard"})]})}function Dt(e){let{visitURL:t}=e;return t?Object(O.jsx)("a",{className:"p-button--positive",href:t,rel:"noopener noreferrer",target:"_blank",children:"Log in to the dashboard"}):Object(O.jsx)("button",{className:"p-button--neutral",disabled:!0,children:Object(O.jsx)(Mt.a,{text:"Connecting..."})})}var Ft=n(42),Vt=n.p+"static/media/logo-mark.b44c09ab.svg",Kt=n.p+"static/media/jaas-text.107a2fc8.svg",Ht=n.p+"static/media/juju-text.b4135778.svg";n(437);function Bt(){const e=Object(c.c)(J).isJuju;return Object(O.jsxs)("a",{href:e?"https://juju.is":"https://jaas.ai",className:"logo",children:[Object(O.jsx)("img",{src:Vt,alt:"Juju logo mark",height:"20",width:"20"}),Object(O.jsx)("img",{className:"logo__text",src:e?Ht:Kt,height:"20",alt:"Juju logo"})]})}var Wt=n(5),Jt=n.n(Wt);n(438);function Gt(e){let{isActive:t,children:n,variant:a}=e;const[r,c]=Object(s.useState)(!1);return Object(s.useEffect)((()=>{c(!1)}),[a]),Object(O.jsxs)("div",{className:"banner","data-active":t&&!r,"data-variant":a,children:[n,Object(O.jsx)("button",{className:"banner__close",onClick:()=>{c(!0)},children:Object(O.jsx)("i",{className:Jt()("p-icon--close",{"is-light":"positive"===a}),children:"Close banner"})})]})}function Yt(){return e=>{let{path:t,category:n="",action:s=""}=e;const a=localStorage.getItem("disableAnalytics");(null!==!0||!0)&&"true"!==a&&(t?h.a.pageview(t):h.a.event({category:n,action:s}))}}let zt;function Xt(e){return{type:zt.sideNavCollapsed,payload:e}}!function(e){e.userMenuActive="TOGGLE_USER_MENU",e.confirmationModalActive="TOGGLE_CONFIRMATION_MODAL",e.sideNavCollapsed="SIDENAV_COLLAPSED"}(zt||(zt={}));const Qt=e=>e.ui.userMenuActive,Zt=e=>e.ui.sideNavCollapsed;n(439);var en=()=>{const e=Yt(),t=Object(c.b)(),n=Object(c.d)(),a=n.getState,r=ce(Object(c.c)(je),a()),i=Object(c.c)(Qt)||!1;Object(s.useEffect)((()=>{i&&e({category:"User",action:"Opened user menu"})}),[i,e]);const o=()=>{return t((e=!i,{type:zt.userMenuActive,payload:e}));var e};return Object(O.jsx)(O.Fragment,{children:r&&Object(O.jsxs)("div",{className:Jt()("user-menu",{"is-active":i}),children:[Object(O.jsxs)("div",{className:"user-menu__header",onClick:o,onKeyPress:o,role:"button",tabIndex:"0",children:[Object(O.jsx)("i",{className:"p-icon--user is-light"}),Object(O.jsx)("span",{className:"user-menu__name",children:r?P(r):""}),Object(O.jsx)("i",{className:"p-icon--chevron-up is-light"})]}),Object(O.jsxs)("ul",{className:"p-list user-menu__options",children:[Object(O.jsx)("li",{className:"p-list__item",children:Object(O.jsx)(j.c,{className:"user-menu__link p-list__link",isActive:e=>{if(e&&e.url.includes("settings"))return!0},to:"/settings",activeClassName:"is-selected",children:"Settings"})}),Object(O.jsx)("li",{className:"p-list__item",children:Object(O.jsx)(j.b,{className:"user-menu__link",to:"/",onClick:()=>t(At(n)),children:"Log out"})})]})]})})};n(441);const tn=[{label:"Models",path:"/models",icon:"models"},{label:"Controllers",path:"/controllers",icon:"controllers"}];var nn=()=>{const{blocked:e}=Object(c.c)(pe),t=Object(c.c)(z);return Object(O.jsxs)("nav",{className:"p-primary-nav",children:[Object(O.jsx)("div",{className:"p-primary-nav__header",children:Object(O.jsx)(Bt,{})}),Object(O.jsx)("ul",{className:"p-list is-internal",children:tn.map((t=>Object(O.jsx)("li",{className:"p-list__item",children:Object(O.jsxs)(j.c,{className:"p-list__link",isActive:e=>{if(e&&e.url.includes(t.path))return!0},to:t.path,activeClassName:"is-selected",children:[Object(O.jsx)("i",{className:`p-icon--${t.icon} is-light`}),t.label,"Models"===t.label&&e>0?Object(O.jsx)("span",{className:"entity-count",children:e}):""]})},t.path)))}),Object(O.jsx)("hr",{className:"p-primary-nav__divider"}),Object(O.jsx)("div",{className:"p-primary-nav__bottom",children:Object(O.jsx)("ul",{className:"p-list",children:Object(O.jsx)("li",{className:"p-list__item",children:Object(O.jsx)("a",{className:"p-list__link",href:"https://github.com/canonical-web-and-design/jaas-dashboard/issues/new",target:"_blank",rel:"noopener noreferrer",children:"Report a bug"})})})}),Object(O.jsx)("hr",{className:"p-primary-nav__divider"}),Object(O.jsx)("div",{className:"p-primary-nav__bottom",children:Object(O.jsx)("ul",{className:"p-list",children:Object(O.jsxs)("li",{className:"p-list__item",children:[Object(O.jsxs)("span",{className:"version",children:["Version ",t]}),Object(O.jsx)("span",{className:"p-label--new",children:"Beta"})]})})}),Object(O.jsx)(en,{})]})};function sn(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:window;const a=Object(s.useRef)();Object(s.useEffect)((()=>{a.current=t}),[t]),Object(s.useEffect)((()=>{if(!(n&&n.addEventListener))return;const t=e=>a.current(e);return n.addEventListener(e,t),()=>{n.removeEventListener(e,t)}}),[e,n])}var an=n(77),rn=n.n(an);function cn(e){let{isActive:t=!0,children:n,className:s}=e;return Object(O.jsx)(O.Fragment,{children:t&&Object(O.jsx)(It.a.div,{className:s,initial:{x:"100%"},animate:{x:0},exit:{x:"100%"},transition:{type:"tween"},children:n})})}var on=n(63),ln=n.n(on);n(442);function dn(e){let{children:t,width:n,pinned:s=!1,loading:a=!1,isSplit:r=!1}=e;return Object(O.jsx)(cn,{isActive:!0,className:Jt()("l-aside",{"is-narrow":"narrow"===n,"is-wide":"wide"===n,"is-pinned":!0===s,"is-split":!0===r}),children:a?Object(O.jsx)("div",{className:"loading",children:Object(O.jsx)(ln.a,{})}):t})}var un=n(149);n(443);function pn(e){let{children:t,buttonRow:n}=e;const r=Object(s.useRef)(null),c=document.querySelector("#confirmation-modal-container")||document.body;return Object(s.useEffect)((()=>{if(r.current){var e;const t=null===r||void 0===r||null===(e=r.current)||void 0===e?void 0:e.querySelector("button.p-button--neutral");t?t.focus():r.current.focus()}}),[]),Object(a.createPortal)(Object(O.jsx)("div",{className:"p-confirmation-modal",ref:r,children:Object(O.jsx)(un.Modal,{buttonRow:n,children:Object(O.jsx)("div",{children:t})})}),c)}function jn(e){let{title:t}=e;const[n,s]=Object(b.e)({panel:b.c,model:b.c}),a={};return Object.keys(n).forEach((e=>{a[e]=void 0})),Object(O.jsxs)("div",{className:"p-panel__header",children:[Object(O.jsx)("div",{className:"p-panel__title",children:t}),Object(O.jsx)("div",{className:"p-panel__controls",children:Object(O.jsx)("button",{onClick:()=>s(a),className:"p-button--base js-aside-close u-no-margin--bottom has-icon",children:Object(O.jsx)("i",{className:"p-icon--close"})})})]})}n(444);function mn(e){let{hasData:t,noDataMessage:n,loading:s,children:a}=e;return Object(O.jsx)("div",{className:"loading-handler",children:t?a:s?Object(O.jsx)("div",{className:"loading-handler__spinner",children:Object(O.jsx)("div",{className:"loading-handler__spinner-content",children:Object(O.jsx)(ln.a,{})})}):n})}n(445);function bn(e){let{name:t,children:n,description:a,selectedInput:r,onSelect:c}=e;const[i,o]=Object(s.useState)(!1),l=Object(s.useRef)(null),d=Object(s.useRef)(null);Object(s.useEffect)((()=>{null!==l.current&&(l.current.style.height="40px")}),[l]),Object(s.useEffect)((()=>{o(r===t)}),[r,t]),Object(s.useEffect)((()=>{const e=l.current,t=d.current;if(null===e||null===t)return;let n=0,s=0,a=0;i?(n=e.offsetHeight,s=t.offsetHeight+20,a=s,e.style.height=s+"px"):40!==e.offsetHeight&&(s=40,n=t.offsetHeight+20,a=n);e.animate({height:[n+"px",s+"px"]},{duration:a,easing:"ease-out"}).onfinish=()=>{e.style.height=!1===i?"40px":""}}),[i,40]);const u=()=>{c(t),o(!0)},p=`inputRadio-${t}`;return Object(O.jsx)("div",{className:"radio-input-box","aria-expanded":i,ref:l,children:Object(O.jsxs)("div",{className:"radio-input-box__container",ref:d,children:[Object(O.jsxs)("label",{className:"p-radio radio-input-box__label",children:[Object(O.jsx)("input",{type:"radio",className:"p-radio__input",name:"inputRadioSelector","aria-labelledby":p,onClick:u,onChange:u}),Object(O.jsx)("span",{className:"p-radio__label",id:p,children:t})]}),Object(O.jsxs)("div",{className:"radio-input-box__content",children:[Object(O.jsx)("div",{className:"radio-input-box__description",children:a}),Object(O.jsx)("div",{className:"radio-input-box__options",children:n})]})]})})}var hn=n(19);function On(e){let{description:t}=e;return t?t.length>30?Object(O.jsxs)("details",{className:"radio-input-box__details",children:[Object(O.jsxs)("summary",{className:"radio-input-box__summary",children:[Object(O.jsx)("span",{className:"radio-input-box__summary-description",children:t}),"\xa0"]}),Object(O.jsx)("span",{className:"radio-input-box__details-description",children:t})]}):Object(O.jsx)("span",{children:t}):null}function vn(e){let{name:t,options:n,onValuesChange:a}=e;const{values:r}=Object(hn.d)();return Object(s.useEffect)((()=>{a(t,r)}),[a,t,r]),Object(O.jsx)("form",{children:n.map((e=>{const n=`${t}-${e.name}`;return Object(O.jsxs)("div",{className:"radio-input-box__input-group",children:[Object(O.jsx)("label",{className:Jt()("radio-input-box__label",{"is-required":e.required}),htmlFor:n,children:e.name}),Object(O.jsx)(hn.a,{className:"radio-input-box__input",type:"text",id:n,name:n}),Object(O.jsx)(On,{description:e.description})]},`${e.name}InputGroup`)}))})}function fn(e){let{name:t,data:n,onValuesChange:a}=e;const r=n[t],c=Object(s.useMemo)((()=>{const e=[];return Object.keys(r.params.properties).forEach((t=>{const n=r.params.properties[t],s=r.params.required;e.push({name:t,description:n.description,type:n.type,required:!!s&&s.includes(t)})})),e}),[r.params.properties,r.params.required]),i=Object(s.useMemo)((()=>{const e={};return c.forEach((n=>{e[`${t}-${n.name}`]=""})),e}),[t,c]);return Object(O.jsx)(hn.c,{initialValues:i,onSubmit:()=>{},children:Object(O.jsx)(vn,{name:t,options:c,onValuesChange:a})},t)}n(446);function gn(){var e,t,n,a,r;const i=Object(c.d)(),o=i.getState(),{appName:l,modelName:d}=Object(m.i)(),u=Object(s.useMemo)((()=>ne(d)),[d]),p=Object(c.c)(u),[j,h]=Object(s.useState)(!0),[v,f]=Object(s.useState)({}),[g,x]=Object(s.useState)(!1),[w,_]=Object(s.useState)(""),[y,N]=Object(s.useState)(),C=Object(s.useRef)({}),k=Object(b.d)("units",Object(b.f)(b.a,[]))[0],A=Object(b.d)("panel")[1];Object(s.useEffect)((()=>{x(!0),async function(e,t,n){const s=await mt(t,n);return await s.facades.action.applicationsCharmsActions({entities:[{tag:`application-${e}`}]})}(l,p,i.getState()).then((e=>{var t,n;null!==e&&void 0!==e&&null!==(t=e.results)&&void 0!==t&&null!==(n=t[0])&&void 0!==n&&n.actions&&f(e.results[0].actions),x(!1)}))}),[l,i,p]);const S=null===(e=o.juju)||void 0===e||null===(t=e.modelData)||void 0===t||null===(n=t[p])||void 0===n||null===(a=n.applications)||void 0===a||null===(r=a[l])||void 0===r?void 0:r.charm,E=async()=>{y&&await async function(){let e=arguments.length>1?arguments[1]:void 0,t=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0;const a=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).map((n=>({name:e,receiver:`unit-${n.replace("/","-")}`,parameters:t}))),r=await mt(n,s);return await r.facades.action.enqueueOperation({actions:a})}(k,y,C.current[y],p,i.getState())},M=Object(s.useCallback)(((e,t)=>{!function(e,t,n){const s={};Object.keys(t).forEach((n=>{s[n.replace(`${e}-`,"")]=t[n]})),n.current={...n.current,[e]:s}}(e,t,C),xn(y,k,v,C,h)}),[v,y,k]),R=Object(s.useCallback)((e=>{N(e),xn(e,k,v,C,h)}),[v,k]),I=Object.keys(v).length>0?v:null;return Object(O.jsx)(dn,{width:"narrow",children:Object(O.jsxs)("div",{className:"p-panel actions-panel",children:[Object(O.jsx)(jn,{title:(()=>{const e=k.length;return Object(O.jsxs)("h5",{children:[F(l,S)," ",e," ",L(e,"unit")," selected"]})})()}),Object(O.jsxs)("div",{className:"actions-panel__unit-list","data-test":"actions-panel-unit-list",children:["Run action on: ",k.length?k.reduce(((e,t)=>`${e}, ${t.split("/")[1]}`)):"0 units selected"]}),Object(O.jsx)("div",{className:"actions-panel__action-list",children:Object(O.jsx)(mn,{hasData:!!I,loading:g,noDataMessage:"This charm has not provided any actions.",children:Object.keys(v).map((e=>Object(O.jsx)(bn,{name:e,description:v[e].description,onSelect:R,selectedInput:y,children:Object(O.jsx)(fn,{name:e,data:v,onValuesChange:M})},e)))})}),(()=>{if(w&&y&&"submit"===w)return function(e,t,n,s,a){const r=n.reduce(((e,t)=>`${e}, ${t.split("/")[1]}`));return Object(O.jsx)(pn,{buttonRow:Object(O.jsxs)("div",{children:[Object(O.jsx)(rn.a,{onClick:a,children:"Cancel"},"cancel"),Object(O.jsx)(rn.a,{appearance:"positive",onClick:s,children:"Confirm"},"save")]}),children:Object(O.jsxs)("div",{children:[Object(O.jsxs)("h4",{children:["Run ",e,"?"]}),Object(O.jsxs)("div",{className:"p-confirmation-modal__info-group",children:[Object(O.jsx)("div",{className:"p-confirmation-modal__sub-header",children:"UNIT COUNT"}),Object(O.jsx)("div",{"data-test":"confirmation-modal-unit-count",children:t})]}),Object(O.jsxs)("div",{className:"p-confirmation-modal__info-group",children:[Object(O.jsx)("div",{className:"p-confirmation-modal__sub-header",children:"UNIT NAME"}),Object(O.jsx)("div",{"data-test":"confirmation-modal-unit-names",children:r})]})]})})}(y,k.length,k,(()=>{_(""),E(),A("")}),(()=>_("")))})(),Object(O.jsx)("div",{className:"actions-panel__drawer",children:Object(O.jsx)(rn.a,{appearance:"positive",className:"actions-panel__run-action",disabled:j,onClick:()=>{_("submit")},children:"Run action"})})]})})}function xn(e,t,n,s,a){if(e&&t.length>0){if(wn(e,s.current))return void a(!1);if(_n(e,n,s.current)&&yn(e,s.current))return void a(!1)}a(!0)}const wn=(e,t)=>!t[e]||0===Object.keys(t[e]).length,_n=(e,t,n)=>{const s=t[e].params.required;return!s||(0===s.length||!s.some((t=>""===n[e][t])))},yn=(e,t)=>!0;var Nn=function(e,t){const[n,a]=Object(s.useState)((()=>{try{const n=window.localStorage.getItem(e);return n?JSON.parse(n):t}catch(n){return console.error("Unable to parse local storage:",n),t}}));return[n,t=>{try{const s=t instanceof Function?t(n):t;a(s),window.localStorage.setItem(e,JSON.stringify(s))}catch(s){console.log(s)}}]};n(447);function Cn(){const[e,t]=Object(s.useState)({}),n=Object(c.b)(),a=Object(c.d)(),r=Object(c.c)(W),[i,o]=Nn("additionalControllers",[]),l=Object(m.g)();function d(n){const s={...e};s[n.target.name]="checkbox"===n.target.type?n.target.checked:n.target.value,t(s)}return Object(O.jsx)(dn,{children:Object(O.jsxs)("div",{className:"p-panel register-controller",children:[Object(O.jsx)(jn,{title:Object(O.jsx)("h4",{children:"Register a controller"})}),Object(O.jsxs)("div",{className:"p-panel__content",children:[Object(O.jsxs)("p",{className:"p-form-help-text",children:["Information can be retrieved using the"," ",Object(O.jsx)("code",{children:"juju show-controller"})," command."]}),Object(O.jsxs)("form",{className:"p-form p-form--stacked",onSubmit:function(t){t.preventDefault(),i.push([`wss://${e.wsControllerHost}/api`,{user:e.username,password:e.password},null,e.identityProviderAvailable,!0]),o(i),n(St(a,r)),l.push("/controllers")},children:[Object(O.jsxs)("div",{className:"p-form__group row",children:[Object(O.jsx)("div",{className:"col-2",children:Object(O.jsx)("label",{htmlFor:"controller-name",className:"p-form__label is-required",children:"Name"})}),Object(O.jsx)("div",{className:"col-10",children:Object(O.jsxs)("div",{className:"p-form__control",children:[Object(O.jsx)("input",{type:"text",id:"controller-name",name:"controllerName",onChange:d,required:!0}),Object(O.jsxs)("p",{className:"p-form-help-text",children:["Must be a valid alpha-numeric Juju controller name. ",Object(O.jsx)("br",{}),"e.g. production-controller-aws"]})]})})]}),Object(O.jsxs)("div",{className:"p-form__group row",children:[Object(O.jsx)("div",{className:"col-2",children:Object(O.jsx)("label",{htmlFor:"host",className:"p-form__label is-required",children:"Host"})}),Object(O.jsx)("div",{className:"col-10",children:Object(O.jsxs)("div",{className:"p-form__control",children:[Object(O.jsx)("input",{type:"text",id:"host",name:"wsControllerHost",onChange:d,required:!0}),Object(O.jsxs)("p",{className:"p-form-help-text",children:["You'll typically want to use the public IP:Port address for the controller. ",Object(O.jsx)("br",{}),"e.g. 91.189.88.181:17070"]})]})})]}),Object(O.jsxs)("div",{className:"p-form__group row",children:[Object(O.jsx)("div",{className:"col-2",children:Object(O.jsx)("label",{htmlFor:"username",className:"p-form__label",children:"Username"})}),Object(O.jsx)("div",{className:"col-10",children:Object(O.jsxs)("div",{className:"p-form__control",children:[Object(O.jsx)("input",{type:"text",id:"username",name:"username",onChange:d}),Object(O.jsx)("p",{className:"p-form-help-text",children:"The username you use to access the controller."})]})})]}),Object(O.jsxs)("div",{className:"p-form__group row",children:[Object(O.jsx)("div",{className:"col-2",children:Object(O.jsx)("label",{htmlFor:"password",className:"p-form__label",children:"Password"})}),Object(O.jsx)("div",{className:"col-10",children:Object(O.jsxs)("div",{className:"p-form__control",children:[Object(O.jsx)("input",{type:"password",id:"password",name:"password",onChange:d}),Object(O.jsxs)("p",{className:"p-form-help-text",children:["The password will be what you used when running"," ",Object(O.jsx)("code",{children:"juju register"})," or if unchanged from the default it can be retrieved by running ",Object(O.jsx)("code",{children:"juju dashboard"}),"."]})]})})]}),Object(O.jsx)("div",{className:Jt()("p-form__group row",{"u-hide":e.username&&e.password}),children:Object(O.jsxs)("div",{className:"col-10 col-start-large-3",children:[Object(O.jsx)("input",{type:"checkbox",id:"identityProviderAvailable",name:"identityProvider",defaultChecked:!1,onChange:d}),Object(O.jsxs)("label",{htmlFor:"identityProviderAvailable",children:["An identity provider is available."," "]}),Object(O.jsx)("div",{className:"p-form-help-text identity-provider",children:"If you provided a username and password this should be left unchecked."})]})}),Object(O.jsx)("div",{className:"p-form__group row",children:Object(O.jsxs)("div",{className:"col-10 col-start-large-3",children:[Object(O.jsx)("i",{className:"p-icon--warning"}),Object(O.jsxs)("div",{className:"controller-link-message",children:["Visit"," ",function(e){if(!e)return"the controller";const t=`https://${e}/dashboard`;return Object(O.jsx)("a",{href:t,target:"_blank",rel:"noopener noreferrer",children:"the controller"})}(null===e||void 0===e?void 0:e.wsControllerHost)," to accept the certificate on this controller to enable a secure connection"]})]})}),Object(O.jsx)("div",{className:"p-form__group row",children:Object(O.jsxs)("div",{className:"col-10 col-start-large-3",children:[Object(O.jsx)("input",{type:"checkbox",id:"certificateHasBeenAccepted",name:"certificateAccepted",defaultChecked:!1,onChange:d,required:!0}),Object(O.jsxs)("label",{htmlFor:"certificateHasBeenAccepted",children:["The SSL certificate, if any, has been accepted."," ",Object(O.jsx)("span",{className:"required-star",children:"*"})]})]})}),Object(O.jsx)("hr",{}),Object(O.jsxs)("div",{className:"row register-a-controller__submit-segment",children:[Object(O.jsx)("div",{className:"col-9",children:Object(O.jsx)("p",{className:"p-form-help-text",children:"The credentials are stored locally in your browser and can be cleared on log-out."})}),Object(O.jsx)("div",{className:"col-3",children:Object(O.jsx)("button",{className:"p-button--positive",type:"submit",disabled:!e.certificateAccepted,children:"Add Controller"})})]})]})]})]})})}function kn(){let{modelName:e}=Object(m.i)();const t=Object(b.e)({model:b.c});e||(e=t[0].model);const n=Object(s.useMemo)((()=>ne(e)),[e]),a=Object(c.c)(n),r=Object(s.useMemo)((()=>ie(a)),[a]);return Object(c.c)(r)}function An(e){let{children:t,className:n,isAnimating:s}=e;return Object(O.jsx)(Rt.a,{children:Object(O.jsx)(It.a.div,{initial:{opacity:1,y:0},animate:s&&{opacity:0,y:50},className:n,children:t})})}n(448);function Sn(e){let{userName:t,lastConnected:n,access:a,isOwner:r,removeUser:c,accessSelectChange:i}=e;const[o,l]=Object(s.useState)(!1),[d,u]=Object(s.useState)(!1),[p,j]=Object(s.useState)(!0),[m,b]=Object(s.useState)(null);Object(s.useEffect)((()=>{const e=setTimeout((()=>{j(!1)}),3e3);return()=>{clearTimeout(e)}}),[p]);return Object(O.jsx)("div",{children:Object(O.jsx)(An,{isAnimating:d,children:Object(O.jsxs)("div",{className:"share-card","data-active":o,children:[Object(O.jsxs)("div",{className:"share-card__title",children:[Object(O.jsx)("strong",{className:"share-card__username",children:t}),Object(O.jsx)("span",{className:"share-card__secondary",children:r?"Owner":Object(O.jsx)("i",{className:"p-icon--delete",onClick:()=>{c(t),u(!0)},onKeyPress:()=>c(t),role:"button",tabIndex:0,children:"Remove user"})})]}),Object(O.jsxs)("div",{className:"share-card__supplementary",children:["Last connected:"," ",n?(h=n,Object(w.a)(Object(_.a)(h)).concat(" ago")):"Never",Object(O.jsx)("div",{className:"share-card__access-wrapper",children:!r&&Object(O.jsxs)(O.Fragment,{children:[Object(O.jsx)(hn.c,{initialValues:{},onSubmit:()=>{},children:Object(O.jsx)(hn.b,{children:Object(O.jsxs)(hn.a,{as:"select",name:"access",onFocus:()=>l(!0),onBlur:()=>l(!1),onChange:e=>{j(!0),b("Updating");const n=i(e,t);n&&n.then((e=>{var t;null!==e&&void 0!==e&&null!==(t=e.results[0])&&void 0!==t&&t.error?b("Error"):(l(!1),b("Updated"))}))},value:a,className:"share__card-access",children:[Object(O.jsx)("option",{value:"read",children:"read"}),Object(O.jsx)("option",{value:"write",children:"write"}),Object(O.jsx)("option",{value:"admin",children:"admin"})]})})}),Object(O.jsx)("div",{className:"share-card__status","data-visible":p,children:Object(O.jsxs)("div",{className:"share-card__status-wrap "+("updating"===m?"is-spinner":""),children:[Object(O.jsx)("span",{className:"share-card__status-text",children:m})," ",Object(O.jsx)("i",{className:(e=>{let t="";switch(e){case"Updating":t="p-icon--spinner u-animation--spin";break;case"Updated":t="p-icon--success";break;case"Error":t="p-icon--error"}return t})(m)})]})})]})})]})]})})});var h}n(449);function En(e){let t,{toastInstance:n,type:s,text:a,undo:r}=e;switch(s){case"positive":t="success";break;case"caution":t="warning";break;case"negative":t="error"}const c=e=>{Ft.b.remove(e)};return Object(O.jsxs)("div",{className:"toast-card","data-type":s,role:"status","aria-live":"polite",children:[Object(O.jsxs)("div",{className:"toast-card__body",children:[t&&Object(O.jsx)("i",{className:`p-icon--${t}`,children:"Success"}),Object(O.jsx)("div",{className:"toast-card__message",dangerouslySetInnerHTML:{__html:a}}),Object(O.jsx)("i",{className:"p-icon--close",onClick:()=>c(n.id),onKeyPress:()=>c(n.id),role:"button",tabIndex:0,children:"Close"})]}),r&&Object(O.jsx)("footer",{className:"toast-card__undo",children:Object(O.jsx)("button",{onClick:()=>{r(),c(n.id)},className:"p-button--base",children:"Undo"})})]})}n(450);function Mn(){var e,t;const n=Object(c.b)(),a=Object(c.d)(),[r,i]=Object(s.useState)({}),[o,l]=Object(s.useState)(!1),[d,u]=Object(s.useState)(!1),p=kn()||null,j=null===p||void 0===p||null===(e=p.info)||void 0===e?void 0:e["controller-uuid"],m=null===p||void 0===p?void 0:p.info.uuid,b=null===p||void 0===p?void 0:p.info.name,h=(e=>Object(f.a)(B,(t=>{if(!t)return null;let n=null;Object.entries(t).some((t=>{const s=t[1].find((t=>e===t.uuid));return!!s&&(n=s,!0)}));const s=x()(n);return s&&(s.url=Object.keys(t)[0]),s})))(j),v=Object(c.c)(h),g=null===v||void 0===v?void 0:v.url,w=null===p||void 0===p||null===(t=p.info)||void 0===t?void 0:t.users;Object(s.useEffect)((()=>{const e=x()(r);null===w||void 0===w||w.forEach((t=>{const n=t.user;e&&(e[n]=null===t||void 0===t?void 0:t.access,i(e))}))}),[w]);const _=e=>e===(null===p||void 0===p?void 0:p.info["owner-tag"].replace("user-","")),y=async(e,t,s,r)=>{const c=await async function(e,t,n,s,a,r,c,i){const o=await ae(e,n()),l=async(e,n)=>await o.facades.modelManager.modifyModelAccess({changes:[{access:e,action:n,"model-tag":`model-${t}`,"user-tag":`user-${s}`}]});let d=Promise.resolve({results:[{}]});if(o){r&&(d=await l(r,"revoke")),"grant"===c&&(d=await l(a,"grant"));const n=await pt(o,t);n&&i(rt(n),{wsControllerURL:e})}else d=Promise.resolve({results:[{error:!0}]});return d}(g,m,a.getState,t,s,r,e,n);return null!==c&&void 0!==c&&c.error?(Ft.b.custom((e=>Object(O.jsx)(En,{toastInstance:e,type:"negative",text:c.error}))),!1):c},N=async(e,t)=>{var n,s;const a=e.target.value,c=x()(r);c&&(c[t]=a),i(c);const o=null===r||void 0===r?void 0:r[t],l=await y("grant",t,a,o),d=null===l||void 0===l||null===(n=l.results[0])||void 0===n||null===(s=n.error)||void 0===s?void 0:s.message;return d?Ft.b.custom((e=>Object(O.jsx)(En,{toastInstance:e,type:"negative",text:d}))):Ft.b.custom((e=>Object(O.jsx)(En,{toastInstance:e,type:"positive",text:`Permissions for <strong>${t}</strong> have been changed to <em>${a}.</em>`}))),l},C=async e=>{await y("revoke",e,void 0,null===r||void 0===r?void 0:r[e]),Ft.b.custom((t=>Object(O.jsx)(En,{toastInstance:t,type:"positive",text:`<strong>${e}</strong> has been successfully removed.`,undo:async()=>{const t=null===r||void 0===r?void 0:r[e];await y("grant",e,t,undefined)}})))},k=x()(w||null);return null===k||void 0===k||k.some(((e,t)=>_(e.user)&&k.unshift(k.splice(t,1)[0]))),Object(O.jsx)(dn,{loading:!p,isSplit:!0,children:Object(O.jsxs)(It.a.div,{layout:!0,className:"p-panel share-model",children:[Object(O.jsx)(jn,{title:Object(O.jsx)("div",{className:"title-wrapper",children:d?Object(O.jsx)(O.Fragment,{children:Object(O.jsxs)("button",{className:"p-button--base has-icon",onClick:()=>u(!1),children:[Object(O.jsx)("i",{className:"p-icon--chevron-up"}),Object(O.jsx)("span",{children:"Back"})]})}):Object(O.jsxs)("div",{className:"title-wrapper__heading",children:[Object(O.jsxs)("h5",{children:[Object(O.jsx)("i",{className:"p-icon--share is-inline"})," Model access:"," ",b]})," "]})})}),Object(O.jsxs)("div",{className:"p-panel__content aside-split-wrapper","data-mobile-show-add-user":d,children:[Object(O.jsxs)("div",{className:"aside-split-col share-cards",children:[Object(O.jsxs)("div",{className:"share-cards__heading",children:[Object(O.jsx)("h5",{children:"Sharing with:"}),Object(O.jsxs)("button",{className:"add-user-btn p-button--base has-icon",onClick:()=>u(!0),children:[Object(O.jsx)("i",{className:"p-icon--plus"}),Object(O.jsx)("span",{children:"Add new user"})]})]}),null===k||void 0===k?void 0:k.map((e=>{const t=e.user,n=e["last-connection"];return Object(O.jsx)(Sn,{userName:t,lastConnected:n,access:null===r||void 0===r?void 0:r[t],isOwner:_(t),removeUser:C,accessSelectChange:N},t)}))]}),Object(O.jsxs)("div",{className:"aside-split-col add-new-user",children:[Object(O.jsx)("h5",{children:"Add new user"}),Object(O.jsx)(hn.c,{initialValues:{name:"",access:"read"},validate:e=>(e=>{l(""!==e.username&&null!==e.accessLevel)})(e),onSubmit:(e,t)=>{let{resetForm:n}=t;(async(e,t)=>{if(((e,t)=>t.some((t=>t.user===e)))(e.name,w))Ft.b.custom((t=>Object(O.jsx)(En,{toastInstance:t,type:"negative",text:`<strong>${e.name}</strong> already has access to this model.`})));else{var n,s,a;const r=e.name,c=e.access;let i=null;r&&c&&(i=await y("grant",r,c,void 0));const o=null===(n=i)||void 0===n||null===(s=n.results[0])||void 0===s||null===(a=s.error)||void 0===a?void 0:a.message;o?Ft.b.custom((e=>Object(O.jsx)(En,{toastInstance:e,type:"negative",text:o}))):(t(),Ft.b.custom((t=>Object(O.jsx)(En,{toastInstance:t,type:"positive",text:`<strong>${e.name}</strong> now has access to this model.`}))))}})(e,n),u(!1)},children:Object(O.jsxs)(hn.b,{children:[Object(O.jsx)("label",{className:"is-required",htmlFor:"username",children:"Username"}),Object(O.jsx)(hn.a,{required:!0,type:"text",placeholder:"Username",name:"name"}),Object(O.jsx)("label",{className:"is-required",htmlFor:" ",children:"Access level"}),Object(O.jsx)("div",{className:"p-radio",children:Object(O.jsxs)("label",{htmlFor:"accessRead",children:[Object(O.jsx)(hn.a,{id:"accessRead",type:"radio",className:"p-radio__input",name:"access","aria-labelledby":"Read",value:"read"}),Object(O.jsxs)("span",{className:"p-radio__label",id:"accessLevel1",children:["read",Object(O.jsx)("span",{className:"help-text",children:"A user can view the state of the model"})]})]})}),Object(O.jsx)("div",{className:"p-radio",children:Object(O.jsxs)("label",{htmlFor:"accessWrite",children:[Object(O.jsx)(hn.a,{id:"accessWrite",type:"radio",className:"p-radio__input",name:"access","aria-labelledby":"Write",value:"write"}),Object(O.jsxs)("span",{className:"p-radio__label",id:"accessLevel2",children:["write",Object(O.jsx)("span",{className:"help-text",children:"In addition to 'read' abilities, a user can modify/configure models"})]})]})}),Object(O.jsx)("div",{className:"p-radio",children:Object(O.jsxs)("label",{htmlFor:"accessAdmin",children:[Object(O.jsx)(hn.a,{id:"accessAdmin",type:"radio",className:"p-radio__input",name:"access","aria-labelledby":"Admin",value:"admin"}),Object(O.jsxs)("span",{className:"p-radio__label",id:"accessLevel3",children:["admin",Object(O.jsx)("span",{className:"help-text",children:"In addition to 'write' abilities, a user can perform model upgrades and connect to machines via juju ssh. Makes the user an effective model owner."})]})]})}),Object(O.jsx)("div",{className:"action-wrapper",children:Object(O.jsx)("button",{className:"p-button--positive",type:"submit",disabled:!o,children:"Add user"})})]})})]})]})]})})}n(140);const Rn=function(e,t){"Escape"===e.code&&t(void 0)};function In(){const[e,t]=Object(b.d)("panel",b.c);sn("keydown",(e=>Rn(e,t)));return Object(O.jsx)(Rt.a,{children:e&&(()=>{switch(e){case"register-controller":return Object(O.jsx)(Cn,{});case"execute-action":return Object(O.jsx)(gn,{});case"share-model":return Object(O.jsx)(Mn,{});default:return null}})()})}n(451);var Pn=e=>{let{children:t}=e;const[n,a]=Object(s.useState)(!0),r=Object(m.h)(),i=Object(c.b)(),{modelName:o}=Object(m.i)(),l=Object(c.c)(Zt)||!1;Object(s.useEffect)((()=>(i(Xt(!!o)),()=>{i(Xt(!1))})),[o,i]);const d=function(){const[e,t]=Object(s.useState)(null);return Object(s.useEffect)((()=>{const e=window.addEventListener("offline",(function(){t(!0)}),!1),n=window.addEventListener("online",(function(){t(!1)}),!1);return()=>{window.removeEventListener("offline",e),window.removeEventListener("online",n)}}),[]),e}();return Object(O.jsxs)(O.Fragment,{children:[Object(O.jsx)("a",{className:"skip-main",href:"#main-content",children:"Skip to main content"}),Object(O.jsx)(Gt,{isActive:null!==d,variant:!1===d?"positive":"caution",children:d?Object(O.jsx)("p",{children:"Your dashboard is offline."}):Object(O.jsxs)("p",{children:["Your dashboard is now back online - please"," ",Object(O.jsx)("a",{href:r.pathname,children:"refresh your browser."})]})}),Object(O.jsx)("div",{id:"confirmation-modal-container"}),Object(O.jsxs)("div",{className:"l-application",children:[Object(O.jsxs)("div",{className:"l-navigation-bar",children:[Object(O.jsx)(Bt,{}),Object(O.jsx)("button",{className:"is-dense toggle-menu",onClick:()=>{a(!n)},children:n?"Open menu":"Close menu"})]}),Object(O.jsx)("header",{className:"l-navigation","data-collapsed":n,"data-sidenav-initially-collapsed":l,children:Object(O.jsx)("div",{className:"l-navigation__drawer",children:Object(O.jsx)(nn,{})})}),Object(O.jsx)("main",{className:"l-main",id:"main-content",children:Object(O.jsx)("div",{"data-test":"main-children",children:t})}),Object(O.jsx)(In,{}),Object(O.jsx)(Ft.a,{position:"bottom-right",containerClassName:"toast-container",toastOptions:{duration:5e3},reverseOrder:!0})]})]})};n(452);var Ln=e=>{let{children:t}=e;return Object(O.jsx)("div",{className:"header",children:t})},Un=n(113),$n=n.n(Un);function qn(e){let{children:t,className:n,isActive:s=!0}=e;return Object(O.jsx)(O.Fragment,{children:s&&Object(O.jsx)(Rt.a,{children:Object(O.jsx)(It.a.div,{initial:{opacity:0},animate:{opacity:1},className:n,children:t})})})}function Tn(e){const t=e?`${e} | `:"";Object(s.useEffect)((()=>{document.title=`${t}Juju Dashboard`}),[t])}var Dn=n(58);var Fn=e=>{let{chartData:t}=e;const n=Object(s.useRef)(),a=((null===t||void 0===t?void 0:t.blocked)||0)+((null===t||void 0===t?void 0:t.alert)||0)+((null===t||void 0===t?void 0:t.running)||0)===0;return Object(s.useEffect)((()=>{const e=Math.min(100,100)/2,s=Dn.d(n.current).attr("width",100).attr("height",100).append("g").attr("transform","translate(50,50) scale(0.49,0.49)"),r=a?{disabled:1}:t,c=Dn.c().domain(Object.keys(r)).range(a?["is-disabled"]:["is-blocked","is-alert","is-running"]),i=Dn.b().value((e=>e[1]))(Object.entries(r));return s.selectAll("g").data(i).enter().append("path").attr("d",Dn.a().innerRadius(100).outerRadius(e)).attr("class",(e=>c(e.data[0]))),()=>{s.remove()}}),[t,a]),Object(O.jsx)("svg",{ref:n})};n(462);function Vn(e,t){if(0===e||0===t)return 0;const n=Math.trunc(e/t);return Number.isNaN(n)?0:n}function Kn(e){let{chartData:t,totalLabel:n}=e;const s=(t.blocked||0)+(t.alert||0)+(t.running||0);return Object(O.jsxs)("div",{className:"p-chart",children:[Object(O.jsx)("div",{className:"p-chart__chart",children:Object(O.jsx)(Fn,{chartData:t})}),Object(O.jsx)("div",{className:"p-chart__legend",children:Object(O.jsxs)("ul",{className:"p-list p-legend",children:[Object(O.jsx)("li",{className:"p-list__item p-legend__item label","data-test":"legend-label",children:Object(O.jsxs)("strong",{"data-test":"total-count",children:[s," ",L(s,n)]})}),Object(O.jsxs)("li",{className:"p-list__item p-legend__item is-blocked","data-test":"legend-blocked",children:["Blocked: ",Vn(s,t.blocked),"%,"," ",t.blocked||0]}),Object(O.jsxs)("li",{className:"p-list__item p-legend__item is-alert","data-test":"legend-alert",children:["Alerts: ",Vn(s,t.alert),"%,"," ",t.alert||0]}),Object(O.jsxs)("li",{className:"p-list__item p-legend__item is-running","data-test":"legend-running",children:["Running: ",Vn(s,t.running),"%,"," ",t.running||0]})]})})]})}n(463);function Hn(){const e=Object(c.c)(le),t=Object(c.c)(ue),n=Object(c.c)(de);let s={blocked:e.blocked.length,alert:e.alert.length,running:e.running.length},a={blocked:t.blocked.length,alert:t.alert.length,running:t.running.length},r={blocked:n.blocked.length,alert:n.alert.length,running:n.running.length};return Object(O.jsx)("div",{className:"p-strip is-shallow controllers-overview",children:Object(O.jsxs)("div",{className:"controllers-overview__container",children:[Object(O.jsx)("div",{className:"controllers-overview__chart",children:Object(O.jsx)(Kn,{chartData:s,totalLabel:"machine"})}),Object(O.jsx)("div",{className:"controllers-overview__chart",children:Object(O.jsx)(Kn,{chartData:a,totalLabel:"application"})}),Object(O.jsx)("div",{className:"controllers-overview__chart",children:Object(O.jsx)(Kn,{chartData:r,totalLabel:"unit"})})]})})}n(464);function Bn(){Tn("Controllers");const e=Object(c.c)(B),t=Object(c.c)(H),n={},s=[];if(e&&(Object.entries(e).forEach((e=>{e[1].forEach((t=>{t.additionalController&&s.push(t.uuid),n[t.uuid]={...t,models:0,machines:0,applications:0,units:0,wsControllerURL:e[0]}}))})),t))for(const c in t){const e=t[c];if(e.info){const t=e.info["controller-uuid"];if(n[t]){n[t].models+=1,n[t].machines+=Object.keys(e.machines).length;const s=Object.keys(e.applications);n[t].applications+=s.length;const a=s.reduce(((t,n)=>{const s=e.applications[n].units||{};return t+Object.keys(s).length}),0);n[t].units+=a}}}const a=[{content:"Default",sortKey:"name"},{content:"cloud/region",sortKey:"cloud/region"},{content:"models",sortKey:"models",className:"u-align--right"},{content:"machines",sortKey:"machines",className:"u-align--right"},{content:"applications",sortKey:"applications",className:"u-align--right"},{content:"units",sortKey:"units",className:"u-align--right"},{content:"version",sortKey:"version",className:"u-align--right"},{content:"public",sortKey:"public",className:"u-align--right"}],r=x()(a);function i(e){const t={content:""};return"admin/jaas"===(null===e||void 0===e?void 0:e.path)?t.content="JAAS":null!==e&&void 0!==e&&e.path?t.content=e.path:(t.content=null===e||void 0===e?void 0:e.wsControllerURL,t.className="is-disconnected",t.title="disconnected"),t}function o(e){var t,n;const s=`${(null===e||void 0===e||null===(t=e.location)||void 0===t?void 0:t.cloud)||"unknown"}/${(null===e||void 0===e||null===(n=e.location)||void 0===n?void 0:n.region)||"unknown"}`,a=`${null===e||void 0===e?void 0:e.Public}`||"False";return{columns:[i(e),{content:s},{content:e.models,className:"u-align--right"},{content:e.machines,className:"u-align--right"},{content:e.applications,className:"u-align--right"},{content:e.units,className:"u-align--right"},{content:e.version,className:"u-align--right"},{content:a,className:"u-align--right u-capitalise"}]}}r[0].content=Object(O.jsxs)("span",{children:["Registered",Object(O.jsx)("span",{className:"controllers--registered-tooltip p-icon--help",title:"The controller authentication data is only stored in your browser localStorage. If you'd like this to persist across browsers try JAAS"})]});const l=s.map((e=>{const t=o(n[e]);return delete n[e],t})),d=n&&Object.values(n).map(o),u=Object(b.d)("panel",b.c)[1];return Object(O.jsxs)(O.Fragment,{children:[Object(O.jsxs)("div",{className:"controllers--header",children:[Object(O.jsx)("div",{className:"controllers__heading",children:"Model status across controllers"}),Object(O.jsx)("div",{className:"controllers--register",children:Object(O.jsx)("button",{className:"p-button--positive",onClick:()=>u("register-controller"),children:"Register a controller"})})]}),Object(O.jsx)(Hn,{}),Object(O.jsxs)("div",{className:"l-controllers-table u-overflow--scroll",children:[d.length>0&&Object(O.jsx)($n.a,{headers:a,rows:d}),l.length>0&&Object(O.jsx)($n.a,{headers:r,rows:l})]})]})}function Wn(){const e=Object(c.c)(B);let t=0;e&&(t=Object.keys(e).length);const n=Object(c.c)(H);let s=0;return n&&(s=Object.keys(n).length),Object(O.jsxs)(Pn,{children:[Object(O.jsx)(Ln,{children:Object(O.jsx)("div",{className:"entity-details__header",children:Object(O.jsxs)("strong",{className:"controllers--count",children:[t," controllers,"," ",Object(O.jsxs)(j.b,{to:"/models",children:[s," models"]})]})})}),Object(O.jsx)("div",{className:"l-content controllers",children:Object(O.jsx)(qn,{isActive:!0,children:Object(O.jsx)(Bn,{})})})]})}var Jn=n(16),Gn=n.n(Jn);function Yn(){var e;const t=Object(c.d)().getState;return null===(e=ce(Object(c.c)(je),t()))||void 0===e?void 0:e.replace("user-","")}var zn=n.p+"static/media/aws.80fb338e.svg",Xn=n.p+"static/media/azure.394f88bf.svg",Qn=n.p+"static/media/gce.cf230f61.svg",Zn=n.p+"static/media/kubernetes.f5c2ef9a.svg";function es(e,t,n){if(!t)return n;const s=`/models/${t.replace("user-","")}/${e}`;return Object(O.jsx)(j.b,{to:s,children:n})}function ts(e,t){var n;let s="";if("object"===typeof e&&null!==e)switch(t){case"summary":const a=Object.keys(e.applications),r=a.length,c=Object.keys(e.machines).length,i=a.reduce(((t,n)=>{const s=e.applications[n].units||{};return t+Object.keys(s).length}),0);s=Object(O.jsx)(O.Fragment,{children:Object(O.jsxs)("div",{className:"u-flex",children:[Object(O.jsxs)("div",{className:"u-flex--block p-tooltip--top-center","aria-describedby":"tp-cntr",children:[Object(O.jsxs)("div",{className:"has-icon",children:[Object(O.jsx)("i",{className:"p-icon--applications"}),Object(O.jsx)("span",{children:r})]}),Object(O.jsx)("span",{className:"p-tooltip__message",role:"tooltip",id:"tp-cntr",children:"Applications"})]}),Object(O.jsxs)("div",{className:"u-flex--block p-tooltip--top-center","aria-describedby":"tp-cntr",children:[Object(O.jsxs)("div",{className:"has-icon",children:[Object(O.jsx)("i",{className:"p-icon--units"}),Object(O.jsx)("span",{children:i})]}),Object(O.jsx)("span",{className:"p-tooltip__message",role:"tooltip",id:"tp-cntr",children:"Units"})]}),Object(O.jsxs)("div",{className:"u-flex--block p-tooltip--top-center","aria-describedby":"tp-cntr",children:[Object(O.jsxs)("div",{className:"has-icon",children:[Object(O.jsx)("i",{className:"p-icon--machines"}),Object(O.jsx)("span",{children:c})]}),Object(O.jsx)("span",{className:"p-tooltip__message",role:"tooltip",id:"tp-cntr",children:"Machines"})]})]})});break;case"cloud-tag":s=U(e.model["cloud-tag"]);break;case"region":s=e.model.region;break;case"cloud-credential-tag":s=$(e["cloud-credential-tag"]);break;case"controllerUuid":s=e["controller-uuid"];break;case"controllerName":s=e.controllerName;break;case"status.since":s=null===(n=e.status.since)||void 0===n?void 0:n.split("T")[0];break;default:console.log(`unsupported status value key: ${t}`)}return s}function ns(e){var t;let n=null;switch(null===e||void 0===e||null===(t=e.info)||void 0===t?void 0:t["provider-type"]){case"ec2":n=Object(O.jsx)("img",{src:zn,alt:"AWS logo",className:"p-table__logo","data-test":"provider-logo"});break;case"gce":n=Object(O.jsx)("img",{src:Qn,alt:"Google Cloud Platform logo",className:"p-table__logo","data-test":"provider-logo"});break;case"azure":n=Object(O.jsx)("img",{src:Xn,alt:"Azure logo",className:"p-table__logo","data-test":"provider-logo"});break;case"kubernetes":n=Object(O.jsx)("img",{src:Zn,alt:"Kubernetes logo",className:"p-table__logo","data-test":"provider-logo"})}return Object(O.jsxs)(O.Fragment,{children:[n,ss(e)]})}function ss(e){return`${ts(e,"cloud-tag")}/${ts(e,"region")}`}function as(e,t){return Object(O.jsx)("button",{onClick:()=>{e({model:t,panel:"share-model"})},className:"model-access p-button--neutral is-dense",children:"Access"})}function rs(e,t){return[{content:C(e,t),sortKey:"name"},{content:"",sortKey:"summary"},{content:"Owner",sortKey:"owner"},{content:"Cloud/Region",sortKey:"cloud"},{content:"Credential",sortKey:"credential"},{content:"Controller",sortKey:"controller"},{content:"Last Updated",sortKey:"lastUpdated",className:"u-align--right"},{content:"",sortKey:"",className:"sm-screen-access-header"}]}const cs=e=>{var t;const{messages:n}=E(e),s=n.join("; "),a=es(e.model.name,null===e||void 0===e||null===(t=e.info)||void 0===t?void 0:t.ownerTag,s);return Object(O.jsx)("span",{className:"model-table-list_error-message",title:s,children:a})},is=(e,t)=>{const n=es(e.model.name,e.info&&e.info["owner-tag"],e.model.name);return Object(O.jsxs)(O.Fragment,{children:[Object(O.jsx)("div",{children:n}),"blocked"===t?cs(e):null]})};function os(e){let{filters:t}=e;const n=Object(c.c)((e=>Object(f.a)(X(e),Q))(t)),s=Object(b.e)({model:b.c,panel:Object(b.f)(b.c,"share-model")})[1],a=Yn(),{blockedRows:r,alertRows:i,runningRows:o}=function(e,t,n){const s={blockedRows:[],alertRows:[],runningRows:[]};return Object.keys(e).forEach((a=>{e[a].forEach((e=>{var r,c,i,o;let l="";e.info&&(l=P(e.info["owner-tag"]));const d=ns(e),u=ts(e.info,"cloud-credential-tag"),p=ts(e.info,"controllerName"),j=null===(r=ts(e.info,"status.since"))||void 0===r?void 0:r.slice(2);s[`${a}Rows`].push({"data-test-model-uuid":null===e||void 0===e?void 0:e.uuid,columns:[{"data-test-column":"name",content:is(e,a)},{"data-test-column":"summary",content:ts(e,"summary"),className:"u-overflow--visible"},{"data-test-column":"owner",content:Object(O.jsx)(O.Fragment,{children:l})},{"data-test-column":"cloud",content:d,className:"u-truncate",title:ss(e)},{"data-test-column":"credential",content:u},{"data-test-column":"controller",content:p},{"data-test-column":"updated",content:Object(O.jsxs)(O.Fragment,{children:[K(n,null===e||void 0===e||null===(c=e.info)||void 0===c?void 0:c.users)&&as(t,e.model.name),Object(O.jsx)("span",{className:"model-access-alt",children:j})]}),className:"u-align--right lrg-screen-access-cell "+(K(n,null===e||void 0===e||null===(i=e.info)||void 0===i?void 0:i.users)?"has-permission":"")},{content:Object(O.jsx)(O.Fragment,{children:K(n,null===e||void 0===e||null===(o=e.info)||void 0===o?void 0:o.users)&&as(t,e.model.name)}),className:"sm-screen-access-cell"}],sortData:{name:e.model.name,owner:l,cloud:d,credential:u,controller:p,lastUpdated:j}})}))})),s}(n,s,a),l="There are no models with this status";return Object(O.jsxs)("div",{className:"status-group u-overflow--scroll",children:[r.length?Object(O.jsx)(Gn.a,{headers:rs("Blocked",r.length),rows:r,sortable:!0,emptyStateMsg:l,className:"p-main-table"}):null,i.length?Object(O.jsx)(Gn.a,{headers:rs("Alert",i.length),rows:i,sortable:!0,emptyStateMsg:l,className:"p-main-table"}):null,o.length?Object(O.jsx)(Gn.a,{headers:rs("Running",o.length),rows:o,sortable:!0,emptyStateMsg:l,className:"p-main-table"}):null]})}function ls(e,t){return[{content:C(e,t,!1),sortKey:"name"},{content:"",sortKey:"summary"},{content:"Owner",sortKey:"owner"},{content:"Status",sortKey:"status"},{content:"Region",sortKey:"region"},{content:"Credential",sortKey:"credential"},{content:"Controller",sortKey:"controller"},{content:"Last Updated",sortKey:"lastUpdated",className:"u-align--right"},{content:"",sortKey:"",className:"sm-screen-access-header"}]}function ds(e){let{filters:t}=e;const n=Yn(),s=Object(c.c)((e=>Object(f.a)(X(e),ee))(t)),a=Object(b.e)({model:b.c,panel:Object(b.f)(b.c,"share-model")})[1],r=function(e){const t={};return Object.keys(e).forEach((n=>{t[n]=t[n]||[],t[n].push(e[n])})),t}(s);let i=[],o={};for(const c in r)Object.values(r[c]).forEach((e=>{o.rows=[],e.forEach((e=>{var t,s,r,c;const{highestStatus:i}=E(e),l=P(e.info["owner-tag"]),d=ts(e,"region"),u=ts(e.info,"cloud-credential-tag"),p=ts(e.info,"controllerName"),j=null===(t=ts(e.info,"status.since"))||void 0===t?void 0:t.slice(2);o.rows.push({"data-test-model-uuid":null===e||void 0===e?void 0:e.uuid,columns:[{"data-test-column":"name",content:es(e.info.name,e.info&&e.info["owner-tag"],e.info.name)},{"data-test-column":"summary",content:ts(e,"summary"),className:"u-overflow--visible"},{"data-test-column":"owner",content:l},{"data-test-column":"status",content:C(i),className:"u-capitalise"},{"data-test-column":"region",content:d},{"data-test-column":"credential",content:u},{"data-test-column":"controller",content:p},{"data-test-column":"updated",content:Object(O.jsxs)(O.Fragment,{children:[K(n,null===e||void 0===e||null===(s=e.info)||void 0===s?void 0:s.users)&&as(a,e.info.name),Object(O.jsx)("span",{className:"model-access-alt",children:j})]}),className:"u-align--right lrg-screen-access-cell "+(K(n,null===e||void 0===e||null===(r=e.info)||void 0===r?void 0:r.users)?"has-permission":"")},{content:Object(O.jsx)(O.Fragment,{children:K(n,null===e||void 0===e||null===(c=e.info)||void 0===c?void 0:c.users)&&as(a,e.info.name)}),className:"sm-screen-access-cell"}],sortData:{name:e.info.name,owner:l,status:i,region:d,credential:u,controller:p,lastUpdated:j}})}))})),i.push(Object(O.jsx)(Gn.a,{headers:ls(c,o.rows.length),rows:o.rows,sortable:!0},c));return Object(O.jsx)("div",{className:"cloud-group u-overflow--scroll",children:i})}function us(e,t){return[{content:C(e,t,!1),sortKey:"name"},{content:"",sortKey:"summary"},{content:"Status",sortKey:"status"},{content:"Cloud/Region",sortKey:"cloud"},{content:"Credential",sortKey:"credential"},{content:"Controller",sortKey:"controller"},{content:"Last Updated",sortKey:"lastUpdated",className:"u-align--right"},{content:"",sortKey:"",className:"sm-screen-access-header"}]}function ps(e){let{filters:t}=e;const n=Object(c.c)((e=>Object(f.a)(X(e),Z))(t)),s=function(e){const t={};return Object.keys(e).forEach((n=>{t[n]=t[n]||[],t[n].push(e[n])})),t}(n),a=Object(b.e)({model:b.c,panel:Object(b.f)(b.c,"share-model")})[1],r=Yn();let i=[],o={};for(const c in s)Object.values(s[c]).forEach((e=>{o.rows=[],e.forEach((e=>{var t,n,s,c;const{highestStatus:i}=E(e),l=ns(e),d=ts(e.info,"cloud-credential-tag"),u=ts(e.info,"controllerName"),p=null===(t=ts(e.info,"status.since"))||void 0===t?void 0:t.slice(2);o.rows.push({"data-test-model-uuid":null===e||void 0===e?void 0:e.uuid,columns:[{"data-test-column":"name",content:es(e.info.name,e.info&&e.info["owner-tag"],e.info.name)},{"data-test-column":"summary",content:ts(e,"summary"),className:"u-overflow--visible"},{"data-test-column":"status",content:C(i),className:"u-capitalise"},{"data-test-column":"cloud",content:l,className:"u-truncate",title:ss(e)},{"data-test-column":"credential",content:d},{"data-test-column":"controller",content:u},{"data-test-column":"updated",content:Object(O.jsxs)(O.Fragment,{children:[K(r,null===e||void 0===e||null===(n=e.info)||void 0===n?void 0:n.users)&&as(a,e.info.name),Object(O.jsx)("span",{className:"model-access-alt",children:p})]}),className:"u-align--right lrg-screen-access-cell "+(K(r,null===e||void 0===e||null===(s=e.info)||void 0===s?void 0:s.users)?"has-permission":"")},{content:Object(O.jsx)(O.Fragment,{children:K(r,null===e||void 0===e||null===(c=e.info)||void 0===c?void 0:c.users)&&as(a,e.info.name)}),className:"sm-screen-access-cell"}],sortData:{name:e.info.name,status:i,cloud:l,credential:d,controller:u,lastUpdated:p}})}))})),i.push(Object(O.jsx)(Gn.a,{headers:us(c,o.rows.length),rows:o.rows,sortable:!0,className:"p-main-table"},c));return Object(O.jsx)("div",{className:"owners-group u-overflow--scroll",children:i})}n(465);function js(e){let{filters:t,groupedBy:n}=e;switch(n){case"status":default:return Object(O.jsx)(os,{filters:t});case"cloud":return Object(O.jsx)(ds,{filters:t});case"owner":return Object(O.jsx)(ps,{filters:t})}}n(466);var ms=e=>{let{buttons:t,label:n,activeButton:s,setActiveButton:a}=e;return Object(O.jsx)("div",{className:"p-button-group",children:Object(O.jsxs)("div",{className:"p-button-group__inner",children:[n?Object(O.jsx)("span",{className:"p-button-group__label","data-test":"label",children:n}):null,Object(O.jsx)("div",{className:"p-button-group__buttons",children:t.map((e=>Object(O.jsx)("button",{"aria-label":`view by ${e}`,className:Jt()("p-button-group__button",{"is-selected":s===e}),value:e,onClick:e=>a(e.currentTarget.value),children:e},e)))})]})})};n(467);var bs=e=>{let{chips:t,descriptor:n}=e;const s=(e=>{let t=0;return e&&Object.values(e).forEach((e=>{t+=e})),t})(t),a=(e=>{let t;switch(e){case"localApps":t="Local applications";break;case"units":t="Units";break;case"machines":t="Machines"}return t})(n);return Object(O.jsx)(O.Fragment,{children:s>0&&Object(O.jsxs)("div",{className:"chip-group",children:[a&&Object(O.jsx)("strong",{className:"chip-group__descriptor",children:`${s} ${a}`}),Object.entries(t).map((e=>{let[t,n]=e;return n>0&&Object(O.jsx)("div",{className:"p-chip",children:Object(O.jsx)("span",{className:`status-icon is-${t.toLowerCase()}`,children:`${n} ${t}`})},t)}))]})})},hs=n(93);n(538);function Os(){Tn("Models");const[e,t]=Object(b.d)("groupedby",Object(b.f)(b.c,"status")),[n,s]=Object(b.e)({cloud:Object(b.f)(b.a,[]),owner:Object(b.f)(b.a,[]),region:Object(b.f)(b.a,[]),credential:Object(b.f)(b.a,[]),custom:Object(b.f)(b.a,[])}),a=Object(c.c)(H),{clouds:r,regions:i,owners:o,credentials:l}=function(e){const t=[],n=[],s=[],a=[];return Object.values(e).forEach((e=>{if(!e.info)return;const r=U(e.info["cloud-tag"]);t.includes(r)||t.push(r);const c=e.info["cloud-region"];n.includes(c)||n.push(c);const i=P(e.info["owner-tag"]);s.includes(i)||s.push(i);const o=$(e.info["cloud-credential-tag"]);a.includes(o)||a.push(o)})),{clouds:t,regions:n,owners:s,credentials:a}}(a),d=(e,t)=>{let n=[];return t.forEach((t=>{n.push({lead:e,value:t})})),n},{blocked:u,alert:p,running:j}=Object(c.c)(pe);let m={};const h=[];for(const[c,b]of Object.entries(n))b.forEach((e=>{h.push({lead:c,value:e})}));const v=u+p+j,f=v>0;return Object(O.jsxs)(Pn,{children:[Object(O.jsx)(Ln,{children:Object(O.jsxs)("div",{className:"models__header","data-disabled":0===v,children:[Object(O.jsxs)("strong",{className:"models__count",children:[v," ",L(v,"model")]}),Object(O.jsx)(ms,{activeButton:e,buttons:["status","cloud","owner"],label:"Group by:",setActiveButton:t}),Object(O.jsx)(hs.SearchAndFilter,{filterPanelData:[{id:0,heading:"Cloud",chips:d("Cloud",r)},{id:1,heading:"Region",chips:d("Region",i)},{id:2,heading:"Owner",chips:d("Owner",o)},{id:3,heading:"Credential",chips:d("Credential",l)}],existingSearchData:h,returnSearchData:e=>{var t,a;m={cloud:[],owner:[],region:[],credential:[],custom:[]},e.length&&e.forEach((e=>{let{lead:t,value:n}=e;const s=t?t.toLowerCase():"custom";m[s]||(m[s]=[]),m[s].push(n)})),t=m,a=n,JSON.stringify(t)!==JSON.stringify(a)&&s(m)}})]})}),f?Object(O.jsx)(qn,{isActive:f,children:Object(O.jsx)("div",{className:"l-content",children:Object(O.jsxs)("div",{className:"models",children:[Object(O.jsx)(bs,{chips:{blocked:u,alert:p,running:j}}),Object(O.jsx)(js,{groupedBy:e,filters:n})]})})}):Object(O.jsx)("div",{className:"entity-details__loading",children:Object(O.jsx)(Mt.a,{})})]})}const vs=e=>e.juju.modelWatcherData,fs=e=>e.juju.models;function gs(e){return Object(f.a)(vs,(t=>null!==t&&void 0!==t&&t[e]?t[e]:null))}function xs(e){return Object(f.a)(gs(e),(e=>e?e.model:null))}function ws(e,t){return Object(f.a)(fs,(n=>{let s="";return n?(Object.entries(n).some((n=>{let[a,{name:r,ownerTag:c,uuid:i}]=n;return r===e&&c.replace("user-","")===t&&(s=i,!0)})),s):s}))}function _s(e){return Object(f.a)(gs(e),(e=>e?e.applications:null))}function ys(e){return Object(f.a)(gs(e),(e=>e?e.units:null))}function Ns(e){return Object(f.a)(gs(e),(e=>e?e.relations:null))}function Cs(e){return Object(f.a)(gs(e),(e=>e?e.machines:null))}var ks;function As(e){return Object(f.a)(ys(e),(e=>{if(!e)return null;const t={};return Object.entries(e).forEach((e=>{let[n,s]=e,a=ks.running;switch(s["workload-status"].current){case"maintenance":case"waiting":a=ks.alert;break;case"blocked":a=ks.blocked}let r=ks.running;switch(s["agent-status"].current){case"allocating":case"executing":case"rebooting":r=ks.alert;break;case"failed":case"lost":r=ks.blocked}const c=Math.max(a,r,ks.running);t[s.application]=ks[c]})),t}))}!function(e){e[e.running=0]="running",e[e.alert=1]="alert",e[e.blocked=2]="blocked"}(ks||(ks={}));const Ss=[{content:"local apps",sortKey:"local-apps"},{content:"status",sortKey:"status"},{content:"version",sortKey:"version"},{content:"scale",className:"u-align--right",sortKey:"scale"},{content:"store",sortKey:"store"},{content:"rev",className:"u-align--right",sortKey:"rev"},{content:"message",sortKey:"message"}],Es=[{content:"remote apps",sortKey:"remote-apps"},{content:"status",sortKey:"status"},{content:"interface",sortKey:"interface"},{content:"offer url",sortKey:"offer-url"},{content:"store",sortKey:"store"}],Ms=[{content:"unit",sortKey:"unit"},{content:"workload",sortKey:"workload"},{content:"agent",sortKey:"agent"},{content:"machine",className:"u-align--right",sortKey:"machine"},{content:"public address",sortKey:"publicAddress"},{content:"ports",className:"u-align--right",sortKey:"ports"},{content:"message",sortKey:"message"}],Rs=[{content:"machine",sortKey:"machine"},{content:"apps",sortKey:"apps"},{content:"state",sortKey:"state"},{content:"az",sortKey:"az"},{content:"instance id",sortKey:"instanceId"},{content:"message",sortKey:"message"}],Is=[{content:"relation provider",sortKey:"provider"},{content:"requirer",sortKey:"requirer"},{content:"interface",sortKey:"interface"},{content:"type",sortKey:"type"}],Ps=[{content:"consumed"},{content:"endpoint"},{content:"status"}],Ls=[{content:"connected offers"},{content:"endpoints"},{content:"connections"}],Us=[{content:"offers"},{content:"interface"},{content:"connection"},{content:"offer url"}];function $s(e,t,n,s){if(!e)return[];return Object.keys(e).map((a=>{var r,c,i;const o=e[a],l=q(o["charm-url"])||"-",d=(u=o["charm-url"])?0===u.indexOf("local:")?"Local":"Charmhub":"";var u;const p=o["workload-version"]||"-";return{columns:[{"data-test-column":"name",content:N(o["charm-url"]||"",a,!1),className:"u-truncate"},{"data-test-column":"status",content:o.status?C(t[o.name]):"-",className:"u-capitalise u-truncate"},{"data-test-column":"version",content:o["workload-version"]||"-"},{"data-test-column":"scale",content:o["unit-count"],className:"u-align--right"},{"data-test-column":"store",content:d},{"data-test-column":"revision",content:l,className:"u-align--right"},{"data-test-column":"message",content:null===(r=o.status)||void 0===r?void 0:r.message,className:"u-truncate",title:null===(c=o.status)||void 0===c?void 0:c.message}],sortData:{app:a,status:null===(i=o.status)||void 0===i?void 0:i.status,version:p,scale:o["unit-count"],store:d,rev:l,notes:"-"},onClick:e=>n("app",a,e),"data-app":a,className:"apps"===(null===s||void 0===s?void 0:s.panel)&&(null===s||void 0===s?void 0:s.entity)===a?"is-selected":""}}))}function qs(e,t,n,s){if(!e)return[];const a=x()(e);Object.entries(a).forEach((e=>{let[t,n]=e;n.subordinate&&a[n.principal]&&(a[n.principal].subordinates||(a[n.principal].subordinates={}),a[n.principal].subordinates[t]=n,delete a[t])}));const r=[];return Object.keys(a).forEach((e=>{const c=a[e],i=c["workload-status"].current||"-",o=c["agent-status"].current||"-",l=c["public-address"]||"-",d=function(e){return e&&0!==e.length?e.map((e=>e.number)).join(", "):"-"}(c.ports),u=c["workload-status"].message||"-",p=c["charm-url"];let j=[{content:N(p||"",e,!1),className:"u-truncate"},{content:C(i),className:"u-capitalise"},{content:o},{content:c["machine-id"],className:"u-align--right",key:"machine"},{content:l},{content:d,className:"u-align--right",title:d},{content:Object(O.jsx)("span",{title:u,children:u}),className:"u-truncate"}];if(s&&(j=j.filter((e=>!("machine"===e.key)))),n){const t=`table-checkbox-${e}`,n=`aria-labeled-${e}`;j.splice(0,0,{content:Object(O.jsxs)("label",{className:"p-checkbox--inline",htmlFor:t,children:[Object(O.jsx)(hn.a,{id:t,type:"checkbox","aria-labelledby":n,className:"p-checkbox__input",name:"selectedUnits",value:e}),Object(O.jsx)("span",{className:"p-checkbox__label",id:n})]})})}r.push({columns:j,sortData:{unit:e,workload:i,agent:o,machine:c.machine,publicAddress:l,ports:d,message:u},onClick:n=>t("unit",e,n),"data-unit":e});const m=c.subordinates;if(m)for(let[s]of Object.entries(m)){const a=m[s];let p=[{content:N(a["charm-url"],s,!0),className:"u-truncate"},{content:C(a["workload-status"].current),className:"u-capitalise"},{content:a["agent-status"].current},{content:a["machine-id"],className:"u-align--right"},{content:a["public-address"]},{content:a["public-address"].split(":")[-1]||"-",className:"u-align--right"},{content:a["workload-status"].current,className:"u-truncate"}];n&&p.splice(0,0,{content:""}),r.push({columns:p,sortData:{unit:e,workload:i,agent:o,machine:c["machine-id"],publicAddress:l,ports:d,message:u},onClick:n=>t("unit",e,n),"data-unit":e})}})),r}function Ts(e,t,n,s){if(!e)return[];const a=(e,t)=>{const n=[];t&&Object.values(t).forEach((t=>{e===t["machine-id"]&&n.push([t.application,t["charm-url"]])}));return n.length?n.map((e=>F(e[0],e[1]))):"None"};return Object.keys(e).map((r=>{var c,i;const o=e[r],l=(null===o||void 0===o||null===(c=o["hardware-characteristics"])||void 0===c?void 0:c["availability-zone"])||"";return{columns:[{content:Object(O.jsxs)(O.Fragment,{children:[Object(O.jsxs)("div",{children:[r,Object(O.jsxs)("span",{className:"u-capitalise",children:[". ",o.series]})]}),o.dnsName]})},{content:a(r,t),className:"machine-app-icons"},{content:C(o["agent-status"].current),className:"u-capitalise"},{content:l},{content:o["instance-id"]},{content:Object(O.jsx)("span",{title:o["agent-status"].message,children:o["agent-status"].message}),className:"u-truncate"}],sortData:{machine:o.series,state:null===o||void 0===o||null===(i=o["agent-status"])||void 0===i?void 0:i.current,az:l,instanceId:o["instance-id"],message:null===o||void 0===o?void 0:o["agent-status"].message},onClick:e=>n("machine",r,e),"data-machine":r,className:s===r?"is-selected":""}}))}const Ds=e=>{var t;return(null===e||void 0===e||null===(t=e.subordinateTo)||void 0===t?void 0:t.length)>0},Fs=(e,t)=>parseFloat(e)+-parseFloat(t),Vs=e=>{const t=/(\d*\.?\d*),\s(\d*\.?\d*)/,n=t=>Dn.d(`[data-name="${e[t]}"]`),s=e=>t.exec(e.node().getAttribute("transform")),a=e=>e.data()[0],r=n(0),c=n(1),i=s(r),o=s(c);return{x1:Fs(i[1],Ds(a(r))?-60:-90),y1:Fs(i[2],Ds(a(r))?-60:-90),x2:Fs(o[1],Ds(a(c))?-60:-90),y2:Fs(o[2],Ds(a(c))?-60:-90)}};var Ks=e=>{let{annotations:t,applications:n,relations:a,width:r,height:c}=e;const i=Object(s.useRef)(),o=x()(t),{deltaX:l,deltaY:d}=(e=>{let t=null,n=null;return e?(Object.keys(e).forEach((s=>{const{"gui-x":a,"gui-y":r}=e[s],c=parseFloat(a),i=parseFloat(r);!isNaN(c)&&(null===t||c<t)&&(t=c),!isNaN(i)&&(null===n||i<n)&&(n=i)})),{deltaX:t,deltaY:n}):{deltaX:t,deltaY:n}})(o),u=Object.entries(n).map((e=>{let[t,n]=e;return{...n,...o[t],name:t}}));for(const s in o){const e=o[s];e["gui-x"]&&(e["gui-x"]=Fs(e["gui-x"],l)),e["gui-y"]&&(e["gui-y"]=Fs(e["gui-y"],d))}let{maxX:p,maxY:j}=(e=>{let t=0,n=0;return e?(Object.keys(e).forEach((s=>{const{"gui-x":a,"gui-y":r}=e[s],c=parseFloat(r),i=parseFloat(a);!isNaN(i)&&i>n&&(n=i),!isNaN(c)&&c>t&&(t=c)})),{maxX:n,maxY:t}):{maxX:n,maxY:t}})(o);0===p&&(p=500);const m=/(.+):(.+)\s(.+):(.+)/,b=Object.entries(a||{}).reduce(((e,t)=>{let[n,s]=t;if(s.endpoints.length>1){const t=n.match(m);e.push(`${t[1]}:${t[3]}`)}return e}),[]),h=[...new Set(b)].map((e=>e.split(":"))),v=Object.keys(n),f=h.filter((e=>v.includes(e[0])&&v.includes(e[1])));return Object(s.useEffect)((()=>{const e=Dn.d(i.current).attr("viewBox",`0 0 ${r} ${c}`).append("g"),t=e.selectAll(".application").data(u);let n={x:0,y:j};const s=t.enter().append("g").attr("transform",(e=>{const t=void 0!==e["gui-x"]?e["gui-x"]:n.x,s=void 0!==e["gui-y"]?e["gui-y"]:n.y;return n.x+=250,n.x>p&&(n.x=0,n.y+=200),`translate(${t}, ${s})`}));s.classed("application",!0).attr("data-name",(e=>e.name)).append("circle").attr("cx",(e=>Ds(e)?60:90)).attr("cy",(e=>Ds(e)?60:90)).attr("r",(e=>Ds(e)?60:90)).attr("fill","#f5f5f5").attr("stroke-width",3).attr("stroke","#888888").call((t=>{const{width:n,height:s}=e.node().getBoundingClientRect();if(n>0&&s>0){const t=200,a=Math.min(r/(n+t),c/(s+t)),i=(r-n*a)/2,o=(c-s*a)/2;e.attr("transform",`translate(${i},${o}) scale(${a},${a})`)}})),s.append("image").attr("xlink:href",(e=>T(e["charm-url"]))).attr("width",(e=>Ds(e)?96:126)).attr("height",(e=>Ds(e)?96:126)).attr("transform",(e=>Ds(e)?"translate(13, 13)":"translate(28, 28)")).attr("clip-path",(e=>Ds(e)?"circle(43px at 48px 48px)":"circle(55px at 63px 63px)"));const a=e.selectAll(".relation").data(f);return a.enter().insert("g",":first-child").classed("relation",!0).append("line").attr("x1",(e=>Vs(e).x1)).attr("y1",(e=>Vs(e).y1)).attr("x2",(e=>Vs(e).x2)).attr("y2",(e=>Vs(e).y2)).attr("stroke","#666666").attr("stroke-width",2),t.exit().remove(),a.exit().remove(),()=>{e.remove()}}),[u,l,d,c,r,p,j,f]),Object(O.jsx)("svg",{ref:i})},Hs=n(151),Bs=n.n(Hs);n(539);const Ws=()=>(()=>{const e=document.documentElement;return Math.max(e.clientWidth,window.innerWidth||0)})()>=1580?300:180;var Js=()=>{const{modelName:e,userName:t}=Object(m.i)(),[n,a]=Object(s.useState)(!1),r=Object(c.c)(ws(e,t)),i=Object(c.c)(function(e){return Object(f.a)(gs(e),(e=>e?e.annotations:null))}(r)),o=Object(c.c)(_s(r)),l=Object(c.c)(Ns(r)),d=Object.keys(o||{}).length,{width:u,height:p}=(()=>{const e=document.documentElement;return{width:Math.max(e.clientWidth,window.innerWidth||0)-300,height:Math.max(e.clientHeight,window.innerHeight||0)-300}})(),j=Ws(),b=Yt();sn("keydown",(function(e){"Escape"===e.code&&n&&a(!1)}));const h=()=>{a(!n),b({path:void 0,category:"User",action:"Opened expanded topology"})};return Object(O.jsx)("div",{className:"info-panel","data-testid":"info-panel",children:n?Object(O.jsx)(Bs.a,{close:()=>a(!1),title:(null===e||void 0===e?void 0:e.split("/")[1])||e,children:Object(O.jsx)(Ks,{width:u,height:p,annotations:i,applications:o,relations:l})}):Object(O.jsx)(O.Fragment,{children:d>0&&Object(O.jsxs)("div",{className:"info-panel__pictogram",children:[Object(O.jsx)(Ks,{width:j,height:j,annotations:i,applications:o,relations:l}),void 0!==e&&Object(O.jsx)("i",{className:"p-icon--fullscreen",onClick:h,onKeyPress:h,role:"button",tabIndex:0,children:"Expand topology"})]})})})};n(540);function Gs(e){let{title:t,openByDefault:n,children:a}=e;const[r,c]=Object(s.useState)(n);function i(){c(!r)}const o=r?"minus":"plus";return Object(O.jsxs)("div",{className:"content-reveal","data-open":r,children:[Object(O.jsxs)("div",{className:"content-reveal__header",onClick:()=>i(),onKeyDown:()=>i(),role:"button",tabIndex:0,children:[Object(O.jsx)("i",{className:`p-icon--${o}`}),Object(O.jsx)("div",{className:"content-reveal__title",children:t})]}),Object(O.jsx)("div",{className:"content-reveal__content","aria-hidden":!r,children:a})]})}const Ys={0:null,30:"0,0,0",31:"205,49,49",32:"13,188,121",33:"229,229,16",34:"26,114,200",35:"188,63,188",36:"17,168,205",37:"229,229,229",90:"102,102,102",91:"241,76,76",92:"35,209,139",93:"245,245,67",94:"59,142,234",95:"214,112,214",96:"41,184,219",97:"229,229,229"},zs=/\[\d{1,3}m/g,Xs=e=>{const t=Array.from(e.matchAll(zs));if(0===t.length)return e;let n="",s=0;return t.forEach(((a,r)=>{var c;const i=a[0],o=i.replace("[","").replace("m","");0!==a.index&&0===s&&(n+=e.substring(s,a.index),s=a.index);const l=(null===(c=t[r+1])||void 0===c?void 0:c.index)||e.length;let d=e.substring(a.index,l).replace(i,"");const u=(e=>{const t=Ys[e];if(t)return`color: rgb(${t})`;const n=Ys[e-10];return n?`color: rgb(${n})`:void 0})(o);u&&(d=`<span style="${u}">${d}</span>`),n+=d,s=a.index})),n};var Qs=e=>{let{content:t,helpMessage:n,showHelp:a,setShouldShowHelp:r}=e;const c=Object(s.useRef)(0),[i,o]=Object(s.useState)(1);Object(s.useEffect)((()=>{const e=e=>{const t=window.innerHeight,n=t-(e.clientY+40)+c.current;n<t-100&&n>=10&&o(n)},t=t=>{["webcli__output-dragarea","webcli__output-handle"].includes(t.target.classList.value)&&(c.current=t.layerY,document.addEventListener("mousemove",e),document.addEventListener("ontouchmove",e))},n=()=>{document.removeEventListener("mousemove",e),document.removeEventListener("ontouchmove",e)};return window.addEventListener("mousedown",t),window.addEventListener("mouseup",n),window.addEventListener("ontouchstart",t),window.addEventListener("ontouchend",n),()=>{window.removeEventListener("mousedown",t),window.removeEventListener("mouseup",n),window.removeEventListener("ontouchstart",t),window.removeEventListener("ontouchend",n)}}),[]),Object(s.useEffect)((()=>{a&&o(50)}),[a]),Object(s.useEffect)((()=>{i<20&&r(!1)}),[i,r]),Object(s.useEffect)((()=>{t.length>1&&i<=50&&300!==i&&o(300)}),[t]),t=t.replace(/\\u001b/gi,"");const l=Object(s.useMemo)((()=>a?n:Xs(t)),[t,a,n]);return Object(O.jsxs)("div",{className:"webcli__output",style:{height:`${i}px`},children:[Object(O.jsx)("div",{className:"webcli__output-dragarea","aria-hidden":!0,children:Object(O.jsx)("div",{className:"webcli__output-handle"})}),Object(O.jsx)("pre",{className:"webcli__output-content",style:{height:`${i}px`},children:Object(O.jsx)("code",{dangerouslySetInnerHTML:{__html:l}})})]})};var Zs=class{constructor(e){this._messageBuffer="",this._messageCallback=e.messageCallback,this.address=e.address,this.wsOnOpen=e.onopen,this.wsOnClose=e.onclose}connect(){const e=new WebSocket(this.address);return e.onopen=this._wsOnOpen,e.onclose=this._wsOnClose,e.onmessage=this._handleMessage.bind(this),this._ws=e,this}send(e){this._ws.send(e)}disconnect(){this._ws.close()}_handleMessage(e){try{const t=JSON.parse(e.data);if(t["redirect-to"]&&(this._ws.close(),this.address=t["redirect-to"],this.connect()),t.done)return;if(!t.output)return;this._pushToMessageBuffer(`\n${null===t||void 0===t?void 0:t.output[0]}`)}catch(e){console.log(e)}}_pushToMessageBuffer(e){this._messageBuffer=this._messageBuffer+e,setTimeout((()=>{this._messageCallback(this._messageBuffer),this._messageBuffer=""}))}};n(541);var ea=e=>{let{controllerWSHost:t,credentials:n,modelUUID:a,protocol:r="wss"}=e;const[i,o]=Object(s.useState)(null),[l,d]=Object(s.useState)(!1),u=Object(s.useRef)(),p=Object(s.useRef)();let[j,m]=Object(s.useState)("");const b=Yt(),h=Object(c.c)(W),v=Object(c.d)().getState(),f=Object(s.useMemo)((()=>t&&a?`${r}://${t}/model/${a}/commands`:null),[t,a,r]);Object(s.useEffect)((()=>{if(!f)return void console.error("no websocket address provided");const e=new Zs({address:f,onopen:()=>{},onclose:()=>{},messageCallback:e=>{p.current=p.current+e,m(p.current)}}).connect();return o(e),()=>{e.disconnect()}}),[f]);const g=()=>{d(!0)};return f?Object(O.jsxs)("div",{className:"webcli",children:[Object(O.jsx)(Qs,{content:j,showHelp:l,setShouldShowHelp:d,helpMessage:'Welcome to the Juju Web CLI - see the <a href="https://juju.is/docs/olm/using-the-juju-web-cli" class="p-link--inverted" target="_blank">full documentation here</a>.'}),Object(O.jsxs)("div",{className:"webcli__input",children:[Object(O.jsx)("div",{className:"webcli__input-prompt",children:"$ juju"}),Object(O.jsx)("form",{onSubmit:e=>{e.preventDefault(),p.current="",m(""),d(!1);let t={};if(n&&n.user&&n.password)t.user=n.user,t.credentials=n.password;else{const e=new URL(i.address).origin,n=h.storage.get(e);if(n){const e=JSON.parse(atob(n)),s=new URL(f).origin,a=ce(`${s}/api`,v);t.user=null===a||void 0===a?void 0:a.replace("user-",""),t.macaroons=[e]}else console.error("No authentication information available")}i.send(JSON.stringify({...t,commands:[e.currentTarget.children.command.value.trim()]})),b({category:"User",action:"WebCLI command sent"}),u.current.value=""},children:Object(O.jsx)("input",{autoComplete:"off",autoCorrect:"off",autoCapitalize:"none",spellCheck:"false",className:"webcli__input-input",type:"text",name:"command",ref:u,placeholder:"enter command"})}),Object(O.jsx)("div",{className:"webcli__input-help",children:Object(O.jsx)("i",{className:"p-icon--help is-light",onClick:g,onKeyDown:g,role:"button",tabIndex:"0"})})]})]}):null};n(542);var ta=function(e){let{children:t,onClose:n,isActive:s,isLoading:a=!1,className:r}=e;return sn("keydown",(e=>{s&&"Escape"===e.code&&n()})),sn("click",(e=>{!s||e.target.closest(".p-modal")||e.target.closest(".slide-panel")||e.target.closest('[role="row"]')||e.target.closest(".webcli")||n()})),Object(O.jsxs)("div",{className:Jt()("slide-panel",r),"aria-hidden":!s,children:[Object(O.jsx)("button",{className:"p-modal__close","aria-label":"Close active modal","aria-controls":"modal",onClick:n,onKeyPress:n,children:"Close"}),Object(O.jsx)("div",{className:"slide-panel__content","data-loading":a,children:a?Object(O.jsx)(Mt.a,{}):t})]})};n(543);function na(){const{userName:e,modelName:t,appName:n,unitId:s,machineId:a}=Object(m.i)(),r={id:void 0,title:void 0};return n&&(r.id=n,r.title="Applications"),s&&(r.id=s,r.title="Units"),a&&(r.id=a,r.title="Machines"),Object(O.jsx)("nav",{className:"p-breadcrumbs","aria-label":"Breadcrumb navigation",children:Object(O.jsx)("ol",{className:"p-breadcrumbs__items","data-test":"breadcrumb-items",children:function(){const c=a?"machines":"apps";var i;return n||s||a?Object(O.jsxs)(O.Fragment,{children:[Object(O.jsx)("li",{className:"p-breadcrumbs__item u-no-padding--top","data-test":"breadcrumb-model",children:Object(O.jsx)(j.b,{to:`/models/${e}/${t}`,children:t})}),!s&&Object(O.jsx)("li",{className:"p-breadcrumbs__item u-no-padding--top","data-test":"breadcrumb-section",children:Object(O.jsx)(j.b,{to:`/models/${e}/${t}?activeView=${c}`,children:r.title})}),s&&Object(O.jsxs)(O.Fragment,{children:[Object(O.jsx)("li",{className:"p-breadcrumbs__item u-no-padding--top","data-test":"breadcrumb-section",children:Object(O.jsx)(j.b,{to:`/models/${e}/${t}?activeView=apps`,children:"Applications"})}),Object(O.jsx)("li",{className:"p-breadcrumbs__item u-no-padding--top","data-test":"breadcrumb-app",children:Object(O.jsx)(j.b,{to:`/models/${e}/${t}/app/${n}`,children:n})})]}),Object(O.jsx)("li",{className:"p-breadcrumbs__item u-no-padding--top","data-test":`breadcrumb-${null===(i=r.title)||void 0===i?void 0:i.toLowerCase()}`,children:Object(O.jsx)("strong",{children:r.id})})]}):Object(O.jsx)("li",{className:"p-breadcrumbs__item p-breadcrumbs__item--restricted","data-test":"breadcrumb-model",title:t,children:Object(O.jsx)(j.b,{to:`/models/${e}/${t}`,className:"p-link--soft",children:Object(O.jsx)("strong",{children:t})})})}()})})}var sa=n.p+"static/media/bulb.31f25996.svg",aa=n.p+"static/media/no-config-params.1840ee6f.svg";function ra(e){let{config:t,selectedConfig:n,setSelectedConfig:a,setNewValue:r}=e;const[c,i]=Object(s.useState)(!1),[o,l]=Object(s.useState)(!1),[d,u]=Object(s.useState)(!1),[p,j]=Object(s.useState)(t.value!==t.default),m=Object(s.useRef)(null),b=Object(s.useRef)(null),h=Object(s.useRef)(null),[v,f]=Object(s.useState)("0px");let g=t.default;function x(e){const t="true"===e.target.value;r(e.target.name,t)}return D(t.newValue)?g=t.newValue:t.default!==t.value&&(g=t.value),Object(s.useEffect)((()=>{var e;null!==(e=h.current)&&void 0!==e&&e.firstChild&&f(`${h.current.firstChild.clientHeight}px`)}),[]),Object(s.useEffect)((()=>{h.current&&(h.current.style.maxHeight=d?v:"0px")}),[d,v]),Object(s.useEffect)((()=>{(null===n||void 0===n?void 0:n.name)===t.name?i(!0):i(!1)}),[n,t]),Object(s.useEffect)((()=>{D(t.newValue)&&t.newValue!==t.default||!D(t.newValue)&&t.value!==t.default?j(!0):j(!1),D(t.newValue)&&t.newValue!==t.value?l(!0):l(!1)}),[t]),Object(O.jsxs)("div",{className:Jt()("config-input",{"config-input--focused":c,"config-input--changed":o}),onClick:()=>a(t),children:[Object(O.jsxs)("h5",{className:"u-float-left",children:[Object(O.jsx)("i",{className:Jt()("config-input--view-description",{"p-icon--plus":!d,"p-icon--minus":d}),onClick:()=>u(!d),onKeyPress:()=>u(!d),role:"button",tabIndex:0}),t.name]}),Object(O.jsx)("button",{className:Jt()("u-float-right p-button--base config-panel__hide-button",{"config-panel__show-button":p}),onClick:function(){r(t.name,t.default)},children:"use default"}),Object(O.jsx)("div",{className:Jt()("config-input--description"),ref:h,children:Object(O.jsx)("pre",{className:"config-input--description-container",children:t.description})}),Object(O.jsxs)("div",{className:"row",children:[Object(O.jsxs)("label",{className:".p-radio--inline col-2",children:[Object(O.jsx)("input",{type:"radio",className:"p-radio__input",name:t.name,"aria-labelledby":t.name,checked:!0===g,value:"true",onClick:x,onChange:x,ref:m}),Object(O.jsx)("span",{className:"p-radio__label",children:"true"})]}),Object(O.jsxs)("label",{className:"p-radio--inline col-2",children:[Object(O.jsx)("input",{type:"radio",className:"p-radio__input",name:t.name,"aria-labelledby":t.name,checked:!1===g,value:"false",onClick:x,onChange:x,ref:b}),Object(O.jsx)("span",{className:"p-radio__label",children:"false"})]})]})]})}function ca(e){let{config:t,selectedConfig:n,setSelectedConfig:a,setNewValue:r}=e;const[c,i]=Object(s.useState)(!1),[o,l]=Object(s.useState)(!1),[d,u]=Object(s.useState)(t.value!==t.default),[p,j]=Object(s.useState)(!1),m=Object(s.useRef)(null),b=Object(s.useRef)(null),[h,v]=Object(s.useState)("0px");let f=t.default;function g(){j(!p)}return D(t.newValue)?f=t.newValue:t.default!==t.value&&(f=t.value),Object(s.useEffect)((()=>{var e;null!==(e=b.current)&&void 0!==e&&e.firstChild&&v(`${b.current.firstChild.clientHeight}px`)}),[]),Object(s.useEffect)((()=>{b.current&&(b.current.style.maxHeight=p?h:"0px")}),[p,h]),Object(s.useEffect)((()=>{i((null===n||void 0===n?void 0:n.name)===t.name)}),[n,t]),Object(s.useEffect)((()=>{D(t.newValue)&&t.newValue!==t.default||!D(t.newValue)&&t.value!==t.default?u(!0):u(!1),D(t.newValue)&&t.newValue!==t.value?l(!0):l(!1)}),[t]),Object(O.jsxs)("div",{className:Jt()("config-input",{"config-input--focused":c,"config-input--changed":o}),"data-config-name":t.name,onClick:()=>a(t),children:[Object(O.jsxs)("h5",{className:"u-float-left",children:[Object(O.jsx)("i",{className:Jt()("config-input--view-description",{"p-icon--plus":!p,"p-icon--minus":p}),onClick:g,onKeyPress:g,role:"button",tabIndex:0}),t.name]}),Object(O.jsx)("button",{className:Jt()("u-float-right p-button--base config-panel__hide-button",{"config-panel__show-button":d}),onClick:function(){r(t.name,t.default)},children:"use default"}),Object(O.jsx)("div",{className:Jt()("config-input--description"),ref:b,children:Object(O.jsx)("pre",{className:"config-input--description-container",children:t.description})}),Object(O.jsx)("textarea",{ref:m,value:f,onFocus:()=>a(t),onChange:e=>{r(t.name,e.target.value)}})]})}n(544);function ia(e){let{appName:t,charm:n,modelUUID:a,onClose:r}=e;const i=Object(c.d)(),[o,l]=Object(s.useState)({}),[d,u]=Object(s.useState)(void 0),[p,j]=Object(s.useState)(!1),[m,b]=Object(s.useState)(!1),[h,v]=Object(s.useState)(!0),[f,g]=Object(s.useState)(!1),[w,_]=Object(s.useState)(null),y=Yt();function N(e){const t=Object.keys(e).some((t=>{const n=e[t];if(D(n.newValue)){if(n.newValue===n.default)return!1;if(n.newValue!==n.default)return!0}else if(n.value!==n.default)return!0;return!1}));b(t)}function C(e){const t=k(e);j(t)}function k(e){return Object.keys(e).some((t=>D(e[t].newValue)&&e[t].newValue!==e[t].value))}async function A(){g(!0);const e=await async function(e,t,n,s){const a=await mt(e,s),r={};return Object.keys(n).forEach((e=>{D(n[e].newValue)&&(r[e]=`${n[e].newValue}`)})),await a.facades.application.set({application:t,options:r})}(a,t,o,i.getState());"string"===typeof e&&console.error("error setting config",e),await oa(a,t,i,v,l,N),g(!1),j(!1),_(null),y({category:"User",action:"Config values updated"})}return sn("keydown",(e=>{"Escape"===e.code&&null!==w&&_(null)})),Object(s.useEffect)((()=>{v(!0),oa(a,t,i,v,l,N)}),[t,a,i]),Object(s.useEffect)((()=>{y({category:"User",action:"Config panel opened"})}),[y]),Object(O.jsx)(ta,{isActive:!0,onClose:function(){return k(o)?(_("cancel"),!1):(r(),!0)},isLoading:!t,className:"config-panel",children:Object(O.jsx)("div",{className:"config-panel",children:h?Object(O.jsx)("div",{className:"full-size u-vertically-center",children:Object(O.jsx)(Mt.a,{})}):h||o&&0!==Object.keys(o).length?Object(O.jsx)(qn,{isActive:!0,className:"config-content row",children:Object(O.jsxs)(O.Fragment,{children:[Object(O.jsxs)("div",{className:"config-panel__config-list col-6",children:[Object(O.jsxs)("div",{className:"config-panel__list-header",children:[Object(O.jsxs)("div",{className:"entity-name",children:[F(t,n)," ",t]}),Object(O.jsx)("div",{className:"config-panel__reset-all",children:Object(O.jsx)("button",{className:Jt()("u-button-neutral config-panel__hide-button",{"config-panel__show-button":m}),onClick:function(){const e=x()(o);Object.keys(e).forEach((t=>{const n=e[t];(n.value!==n.default||n.newValue!==n.default)&&(n.newValue=n.default)})),l(e),N(e),C(e)},children:"Reset all values"})})]}),Object(O.jsx)("div",{className:"config-panel__list",children:la(o,d,u,(function(e,t){const n=x()(o);n[e].newValue=t,n[e].newValue===n[e].value&&delete n[e].newValue,l(n),C(n),N(n)}))}),function(){if(w){const e=function(e){return Object.keys(e).reduce(((t,n)=>{const s=e[n];return D(s.newValue)&&s.newValue!==s.value&&t.push(Object(O.jsxs)("div",{children:[Object(O.jsx)("h5",{children:n}),Object(O.jsx)("pre",{children:s.newValue})]},n)),t}),[])}(o);if("apply"===w)return function(e,t,n,s){return Object(O.jsxs)(pn,{buttonRow:Object(O.jsxs)("div",{children:[Object(O.jsx)("div",{className:"config-panel__modal-button-row-hint",children:"You can revert back to the applications default settings by clicking the \u201cReset all values\u201d button; or reset each edited field by clicking \u201cUse default\u201d."}),Object(O.jsxs)("div",{children:[Object(O.jsx)("button",{className:"p-button--neutral",onClick:s,children:"Cancel"},"cancel"),Object(O.jsx)("button",{className:"p-button--positive",onClick:n,children:"Yes, apply changes"},"save")]})]}),children:[Object(O.jsx)("h4",{children:"Are you sure you wish to apply these changes?"}),Object(O.jsxs)("p",{children:["You have edited the following values to the ",e," configuration:"]}),t]})}(t,e,(()=>{_(null),A()}),(()=>_(null)));if("cancel"===w)return function(e,t,n,s){return Object(O.jsxs)(pn,{buttonRow:[Object(O.jsx)("button",{className:"p-button--neutral",onClick:s,children:"Continue editing"},"cancel"),Object(O.jsx)("button",{className:"p-button--negative",onClick:n,children:"Yes, I'm sure"},"save")],children:[Object(O.jsx)("h4",{children:"Are you sure you wish to cancel?"}),Object(O.jsxs)("p",{children:["You have edited the following values to the ",e," configuration:"]}),t]})}(t,e,(()=>{_(null),r()}),(()=>_(null)))}return null}(),Object(O.jsx)("div",{className:Jt()("config-panel__drawer",{"is-open":null!==w}),children:Object(O.jsxs)("div",{className:"config-panel__button-row",children:[Object(O.jsx)("button",{className:"p-button--neutral",onClick:function(){k(o)?_("cancel"):r()},children:"Cancel"}),Object(O.jsx)("button",{className:Jt()("p-button--positive config-panel__save-button",{"is-active":f}),onClick:function(){_("apply")},disabled:!p||f,children:f?Object(O.jsxs)(O.Fragment,{children:[Object(O.jsx)("i",{className:"p-icon--spinner u-animation--spin is-light"}),Object(O.jsx)("span",{children:"Saving\u2026"})]}):"Save and apply"})]})})]}),Object(O.jsx)("div",{className:"config-panel__description col-6",children:d?Object(O.jsx)(qn,{isActive:!0,className:"config-panel__description-wrapper",children:Object(O.jsxs)(O.Fragment,{children:[Object(O.jsx)("h4",{children:"Configuration Description"}),Object(O.jsx)("h5",{children:d.name}),Object(O.jsx)("pre",{children:d.description})]})},d.name):Object(O.jsx)("div",{className:"config-panel__no-description u-vertically-center",children:Object(O.jsx)(ua,{})})})]})}):Object(O.jsx)(qn,{isActive:!0,children:Object(O.jsx)("div",{className:"full-size u-align-center",children:Object(O.jsx)(da,{})})})})})}async function oa(e,t,n,s,a,r){return async function(e,t,n){const s=await mt(e,n);return await s.facades.application.get({application:t})}(e,t,n.getState()).then((e=>{const t={};Object.keys(e.config).forEach((n=>{t[n]=e.config[n],t[n].name=n})),s(!1),a(t),r(t)}))}function la(e,t,n,s){return Object.keys(e).map((a=>{const r=e[a];return"boolean"===r.type?Object(O.jsx)(ra,{config:r,selectedConfig:t,setSelectedConfig:n,setNewValue:s},r.name):Object(O.jsx)(ca,{config:r,selectedConfig:t,setSelectedConfig:n,setNewValue:s},r.name)}))}function da(){return Object(O.jsxs)("div",{className:"config-panel__message",children:[Object(O.jsx)("img",{src:aa,alt:"",className:"config-panel--center-img"}),Object(O.jsx)("h4",{children:"This application doesn't have any configuration parameters"})]})}function ua(){return Object(O.jsxs)("div",{className:"config-panel__message",children:[Object(O.jsx)("img",{src:sa,alt:"",className:"config-panel--center-img"}),Object(O.jsx)("h4",{children:"Click on a configuration row to view its related description and parameters"})]})}const pa=e=>e.map((e=>{let{th:t,td:n}=e;return Object(O.jsxs)("tr",{className:"panel__tr",children:[Object(O.jsx)("th",{className:"panel__th",children:t}),Object(O.jsx)("td",{className:"panel__td",children:n})]},t+n)}));function ja(e){var t;let{entity:n}=e;const s=null===(t=kn()["remote-applications"])||void 0===t?void 0:t[n],a=[{th:"Offer name",td:s["offer-name"]||"-"},{th:"Application",td:"-"},{th:"Charm",td:"-"},{th:"Store",td:"-"},{th:"Application",td:s["offer-url"]||"-"},{th:"Status",td:s.status.status||"-"},{th:"Endpoint",td:"-"},{th:"Interface",td:"-"}];return Object(O.jsxs)("div",{className:"panel",children:[Object(O.jsx)("span",{className:"p-muted-heading",children:"flannel:etcd"}),Object(O.jsx)("h5",{children:"Remote Offer info"}),Object(O.jsx)("table",{className:"panel__table",children:Object(O.jsx)("tbody",{children:pa(a)})})]})}function ma(e){let{entity:t}=e;const n=kn(),a=null===n||void 0===n?void 0:n.offers[t],[r,c]=Object(s.useState)(""),i=e=>{c(e===r?"":e)},o=[{th:"Offer name",td:a["offer-name"]},{th:"Application",td:t},{th:"Charm",td:"-"},{th:"Store",td:"-"},{th:"URL",td:"-"}];return Object(O.jsxs)("div",{className:"panel",children:[Object(O.jsx)("span",{className:"p-muted-heading",children:"mysql:db"}),Object(O.jsx)("h5",{children:"Offer info"}),Object(O.jsx)("table",{className:"panel__table",children:Object(O.jsx)("tbody",{children:pa(o)})}),Object(O.jsx)("aside",{className:"p-accordion",children:Object(O.jsxs)("ul",{className:"p-accordion__list",children:[Object(O.jsxs)("li",{className:"p-accordion__group",children:[Object(O.jsx)("button",{type:"button",className:"p-accordion__tab",id:"tab1","aria-controls":"tab1-section","aria-expanded":"tab1"===r,onClick:()=>i("tab1"),children:"Endpoint 1"}),Object(O.jsx)("section",{className:"p-accordion__panel",id:"tab1-section","aria-hidden":"tab1"!==r,"aria-labelledby":"tab1",children:Object(O.jsx)("table",{className:"panel__table",children:Object(O.jsx)("tbody",{children:pa([{th:"Endpoint",td:"-"},{th:"Interface",td:"-"},{th:"Role",td:"-"}])})})})]}),Object(O.jsxs)("li",{className:"p-accordion__group",children:[Object(O.jsx)("button",{type:"button",className:"p-accordion__tab",id:"tab2","aria-controls":"tab2-section","aria-expanded":"tab2"===r,onClick:()=>i("tab2"),children:"Connection 0/0"}),Object(O.jsx)("section",{className:"p-accordion__panel",id:"tab2-section","aria-hidden":"tab2"!==r,"aria-labelledby":"tab2",children:Object(O.jsx)("table",{className:"panel__table",children:Object(O.jsx)("tbody",{children:pa([{th:"UUID",td:"-"},{th:"User",td:"-"},{th:"Relation-id",td:"-"},{th:"Status",td:"-"},{th:"Ingress-subnets",td:"-"}])})})})]}),Object(O.jsxs)("li",{className:"p-accordion__group",children:[Object(O.jsx)("button",{type:"button",className:"p-accordion__tab",id:"tab3","aria-controls":"tab3-section","aria-expanded":"tab3"===r,onClick:()=>i("tab3"),children:"Users"}),Object(O.jsx)("section",{className:"p-accordion__panel",id:"tab3-section","aria-hidden":"tab3"!==r,"aria-labelledby":"tab3",children:Object(O.jsx)("table",{className:"panel__table",children:Object(O.jsx)("tbody",{children:pa([{th:"User",td:"-"},{th:"display-name",td:"-"},{th:"access",td:"-"}])})})})]})]})})]})}n(545);function ba(e,t,n){switch(e){case"remoteApps":return Object(O.jsx)(ja,{entity:t,panelRowClick:n});case"offers":return Object(O.jsx)(ma,{entity:t,panelRowClick:n})}}var ha=e=>{let{type:t,children:n,className:a=""}=e;const{userName:r,modelName:i}=Object(m.i)(),o=Object(m.g)(),l=Object(c.c)(ws(i,r)),d=Object(c.c)(xs(l)),u=Object(c.c)(_s(l)),[p,j]=Object(b.e)({panel:b.c,entity:b.c,activeView:Object(b.f)(b.c,"apps")}),{panel:h,entity:v,activeView:g}=p,x={panel:void 0,entity:void 0},w=Object(c.d)().getState(),[_,y]=Object(s.useState)(!1),N=null===d||void 0===d?void 0:d["controller-uuid"],C=Object(c.c)((e=>Object(f.a)(B,(t=>t?Object.entries(t).find((t=>t[1].find((t=>e===t.uuid)))):null)))(N));let k=null,A="";C&&(k=G(C[0],w),A=C[0].replace("wss://","").replace("/api",""));const S=(e,t)=>{e.preventDefault(),e.target.scrollIntoView({behavior:"smooth",block:"end",inline:"nearest"}),j({activeView:t})};Object(s.useEffect)((()=>{d&&-1!==(null===d||void 0===d?void 0:d.version.indexOf("2.9"))&&y(!0)}),[d]),Tn(null!==d&&void 0!==d&&d.name?`Model: ${null===d||void 0===d?void 0:d.name}`:"...");const E=Object(s.useCallback)(((e,t)=>{if("apps"!==t)return j({panel:t,entity:e});o.push(`/models/${r}/${i}/app/${e}`)}),[j,o,i,r]);return Object(O.jsxs)(Pn,{className:a,children:[Object(O.jsx)(Ln,{children:Object(O.jsxs)("div",{className:"entity-details__header",children:[Object(O.jsx)(na,{}),Object(O.jsx)("div",{className:"entity-details__view-selector","data-testid":"view-selector",children:d&&"model"===t&&Object(O.jsx)(hs.Tabs,{links:(()=>{let e=[{active:"apps"===g,label:"Applications",onClick:e=>S(e,"apps")},{active:"integrations"===g,label:"Integrations",onClick:e=>S(e,"integrations")},{active:"action-logs"===g,label:"Action Logs",onClick:e=>S(e,"action-logs")}];return"kubernetes"!==d.type&&e.push({active:"machines"===g,label:"Machines",onClick:e=>S(e,"machines")}),e})()})})]})}),d?Object(O.jsx)(qn,{isActive:d,children:Object(O.jsx)("div",{className:"l-content",children:Object(O.jsx)("div",{className:`entity-details entity-details__${t}`,children:Object(O.jsxs)(O.Fragment,{children:[n,(()=>{var e;return"config"===h?Object(O.jsx)(ia,{appName:v,charm:null===u||void 0===u||null===(e=u[v])||void 0===e?void 0:e["charm-url"],modelUUID:l,onClose:()=>j(x)}):"remoteApps"===h||"offers"===h?Object(O.jsx)(ta,{isActive:h,onClose:()=>j(x),isLoading:!v,className:`${h}-panel`,children:ba(h,v,E)}):void 0})()]})})})}):Object(O.jsx)("div",{className:"entity-details__loading","data-testid":"loading-spinner",children:Object(O.jsx)(hs.Spinner,{})}),_&&Object(O.jsx)(ea,{controllerWSHost:A,credentials:k,modelUUID:l})]})};n(546);function Oa(e){let{data:t}=e;return Object(O.jsx)("div",{className:"entity-info__grid",children:Object.entries(t).map((e=>{let[t,n]=e;return Object(O.jsxs)("div",{className:"entity-info__grid-item",children:[Object(O.jsx)("h4",{className:"p-muted-heading",children:t}),Object(O.jsx)("p",{"data-name":t,children:n})]},t)}))})}var va=n(150),fa=n.n(va);function ga(e,t,n){return Object(O.jsx)(j.b,{to:`/models/${t}/${n}/app/${e}`,children:e})}function xa(e,t,n,s){return e?Object(O.jsxs)(O.Fragment,{children:[F(t,e.charm),ga(t,n,s)]}):Object(O.jsx)(O.Fragment,{children:t})}function wa(){const[e,t]=Object(s.useState)([]),[n,a]=Object(s.useState)(!1),{userName:r,modelName:i}=Object(m.i)(),o=Object(c.d)(),l=Object(s.useMemo)((()=>ne(i)),[i]),d=Object(c.c)(l),u=Object(c.c)(ie(d)),p=()=>Object.keys(u.applications);Object(s.useEffect)((()=>{!async function(){const e=await async function(e,t,n){const s=await mt(t,n);return await s.facades.action.listOperations(e)}({applications:p},d,o.getState());t(e.results),a(!0)}()}),[d]);const j=Object(s.useMemo)((()=>{const t=[];return e&&e.forEach((e=>{const n=e.operation.split("-")[1];let s="";e.actions.forEach(((e,a)=>{s=e.action.name;let c={application:"-",id:"-",status:"-",taskId:"",message:"",completed:""},o={};if(0===a){const a=e.action.receiver.match(/unit-(.+)-\d+/),l=a&&a[1];if(!l)return void console.error("Unable to parse action receiver",e.action.receiver);o={application:xa(u.applications[l],l,r,i),id:`${n}/${s}`,status:C(e.status,void 0,!0,!0)},t.push({...c,...o})}o={application:Object(O.jsxs)(O.Fragment,{children:[Object(O.jsx)("span",{className:"entity-details__unit-indent",children:"\u2514"}),Object(O.jsx)("span",{children:e.action.receiver.replace(/unit-(.+)-(\d+)/,"$1/$2")})]}),id:"",status:C(e.status,void 0,!0,!0),taskId:e.action.tag.split("-")[1],message:e.message||"-",completed:e.completed},t.push({...c,...o})}))})),t}),[e,u.applications,r,i]),b=Object(s.useMemo)((()=>[{Header:"application",accessor:"application"},{Header:"operation id/name",accessor:"id"},{Header:"status",accessor:"status"},{Header:"task id",accessor:"taskId"},{Header:"action message",accessor:"message"},{Header:"completion time",accessor:"completed"}]),[]),h=`There are no action logs available yet for ${i}`;return Object(O.jsx)("div",{className:Jt()("entity-details__action-logs",{"entity-details__loading":!n}),children:n?Object(O.jsx)(fa.a,{emptyMsg:h,columns:b,data:j}):Object(O.jsx)(ln.a,{})})}function _a(){const e=Object(m.g)(),[t,n]=Object(s.useState)(null),{userName:a,modelName:r}=Object(m.i)();return Object(s.useEffect)((()=>{const n=t&&t.id.replace("/","-");if("unit"===(null===t||void 0===t?void 0:t.type)){const s=null===n||void 0===n?void 0:n.split("-").slice(0,-1).join("-");a&&r&&t&&s&&e.push(`/models/${a}/${r}/app/${s}/${t.type}/${n}/`)}else a&&r&&t&&e.push(`/models/${a}/${r}/${t.type}/${n}`)}),[t,e,r,a]),(e,t,s)=>{-1===s.target.className.indexOf("p-checkbox")&&n({type:e,id:t})}}const ya=(e,t)=>(t[e]?t[e]=t[e]+=1:t[e]=1,t),Na=e=>{let t=0;return Object.entries(e.offers).forEach((e=>{const n=e[1]["total-connected-count"];n>0&&(t+=n)})),{joined:t}},Ca=(e,t,n)=>e[t]&&Object.entries(e[t]).reduce(((e,t)=>{const s=t[1][n].status;return ya(s,e)}),{});const ka=function(e,t){if(!t)return null;let n=null;switch(e){case"localApps":n=Ca(t,"applications","status");break;case"relations":n=null;break;case"offers":n=Na(t);break;case"remoteApps":n=Ca(t,"remote-applications","status")}return n},Aa=(e,t)=>{switch(t){case"apps":return"apps"===e;case"units":case"machines":case"integrations":case"action-logs":return"relations-title"===e||e===t}};var Sa=()=>{var e,t;const n=kn(),a=Yn(),r=Object(m.g)(),{userName:i,modelName:o}=Object(m.i)(),[l,d]=Object(b.e)({panel:b.c,entity:b.c,activeView:Object(b.f)(b.c,"apps")}),u=Object(c.c)(ws(o,i)),p=_a(),j=Object(s.useCallback)(((e,t)=>{if("apps"!==t)return d({panel:t,entity:e});r.push(`/models/${i}/${o}/app/${e}`)}),[d,r,o,i]),h=Object(c.c)(_s(u)),v=Object(c.c)(Ns(u)),f=Object(c.c)(Cs(u)),g=Object(c.c)(ys(u)),w=Object(c.c)(As(u)),_=Object(s.useMemo)((()=>$s(h,w,p,l)),[h,w,p,l]),y=Object(s.useMemo)((()=>function(e,t,n){if(!e)return[];const s=x()(e["remote-applications"]);return s&&Object.keys(s).map((e=>{const t=s[e],a=t.status.status,r=t["offer-url"],c=Object.keys(null===t||void 0===t?void 0:t.relations).map((e=>e));return{columns:[{"data-test-column":"app",content:t["offer-name"],className:"u-truncate"},{"data-test-column":"status",content:a,className:"u-capitalise u-truncate"},{"data-test-column":"interface",content:c.join(",")},{"data-test-column":"offer_url",content:r,className:"u-truncate"},{"data-test-column":"store",content:"-"}],sortData:{app:e,status:"status",interface:"interface",offer_url:"offer_url",store:"store"},"data-app":e,onClick:e=>!1,className:"remoteApps"===(null===n||void 0===n?void 0:n.panel)&&(null===n||void 0===n?void 0:n.entity)===e?"is-selected":""}}))}(n,0,l)),[n,j,l]),N=Object(s.useMemo)((()=>Ts(f,g,p,null===l||void 0===l?void 0:l.entity)),[f,g,p,l]),C=Object(s.useMemo)((()=>function(e,t){return e?Object.keys(e).map((n=>{var s;const a=e[n],{provider:r,requirer:c,peer:i,providerApplicationName:o,requirerApplicationName:l,peerApplicationName:d}=(e=>{const t={};return e.endpoints.forEach((e=>{const n=e.relation.role;t[n]=e["application-name"]+":"+e.relation.name,t[`${n}ApplicationName`]=e["application-name"]})),t})(a),u=r||i||"-",p=c||"-";return{columns:[{content:Object(O.jsxs)(O.Fragment,{children:[V(o||d,t),u]}),className:"u-truncate"},{content:Object(O.jsxs)(O.Fragment,{children:[V(l,t),p]}),title:p,className:"u-truncate"},{content:a.endpoints[0].relation.interface},{content:a.endpoints[0].relation.role}],sortData:{provider:u,requirer:p,interface:a.interface,type:null===a||void 0===a||null===(s=a.endpoints[0])||void 0===s?void 0:s.relation.role}}})):[]}(v,h)),[h,v]),k=Object(s.useMemo)((()=>function(e){if(!e)return[];const t=e["remote-applications"]||{};return Object.keys(t).map((n=>{const s=t[n];return{columns:[{content:Object(O.jsxs)(O.Fragment,{children:[V(s.offerName,e),s.offerName]}),className:"u-truncate"},{content:Object.entries(s.endpoints).map((e=>`${e[1].name}:${e[1].interface}`)).join("/n"),className:"u-truncate"},{content:s.status.status}]}}))}(n)),[n]),A=Object(s.useMemo)((()=>function(e){if(!e)return[];const t=e.offers;return Object.keys(t).map((n=>{const s=t[n];return{columns:[{content:Object(O.jsxs)(O.Fragment,{children:[V(s.applicationName,e),s.applicationName]}),className:"u-truncate"},{content:Object.entries(s.endpoints).map((e=>`${e[1].name}:${e[1].interface}`)).join("/n"),className:"u-truncate"},{content:s.activeConnectedCount}]}}))}(n)),[n]),S=Object(s.useMemo)((()=>function(e,t,n){if(!e)return[];const s=e.offers;return Object.keys(s).map((t=>{const a=s[t],r=Object.keys(null===a||void 0===a?void 0:a.endpoints).map((e=>e));return{columns:[{content:Object(O.jsxs)(O.Fragment,{children:[V(a,e),a["offer-name"]]}),className:"u-truncate"},{content:Object(O.jsx)(O.Fragment,{children:r.join(",")})},{content:Object(O.jsxs)(O.Fragment,{children:[a["active-connected-count"]," /"," ",a["total-connected-count"]]})},{content:"-"}],onClick:e=>!1,"data-app":t,className:"offers"===n.panel&&n.entity===t?"is-selected":""}}))}(n,0,l)),[n,j,l]),E=Object(c.c)(xs(u)),M=ka("localApps",n),R=ka("offers",n),I=ka("remoteApps",n),P=null===_||void 0===_?void 0:_.length,$=null===S||void 0===S?void 0:S.length,q=null===y||void 0===y?void 0:y.length,T=()=>Object(O.jsx)(O.Fragment,{children:!!$&&Object(O.jsx)(O.Fragment,{children:Object(O.jsx)(Gn.a,{headers:Us,rows:S,className:"entity-details__offers p-main-table",sortable:!0,emptyStateMsg:"There are no offers associated with this model"})})}),D=()=>Object(O.jsx)(O.Fragment,{children:!!P&&Object(O.jsx)(Gn.a,{headers:Ss,rows:_,className:"entity-details__apps p-main-table",sortable:!0,emptyStateMsg:"There are no local applications in this model"})}),F=()=>Object(O.jsx)(O.Fragment,{children:!!q&&Object(O.jsx)(Gn.a,{headers:Es,rows:y,className:"entity-details__remote-apps p-main-table",sortable:!0,emptyStateMsg:"There are no remote applications in this model"})}),H=(e=>{let t=0;return e.forEach((e=>{e>0&&t++})),t})([P,q,$]),B=Object(b.d)("panel",b.c)[1];return Object(O.jsxs)(ha,{type:"model",children:[Object(O.jsxs)("div",{children:[Object(O.jsx)(Js,{}),Object(O.jsx)("div",{className:"entity-details__actions",children:K(a,null===n||void 0===n||null===(e=n.info)||void 0===e?void 0:e.users)&&Object(O.jsxs)("button",{className:"entity-details__action-button","data-test":"model-access-btn",onClick:()=>B("share-model"),children:[Object(O.jsx)("i",{className:"p-icon--share"}),"Model access"]})}),E&&Object(O.jsx)(Oa,{data:{controller:E.type,"Cloud/Region":(W=E["cloud-tag"],J=E.region,W&&J?`${U(W)} / ${J}`:""),version:E.version,sla:null===(t=E.sla)||void 0===t?void 0:t.level}})]}),Object(O.jsxs)("div",{className:"entity-details__main u-overflow--auto",children:[Aa("apps",l.activeView)&&Object(O.jsxs)(O.Fragment,{children:[0===H&&Object(O.jsxs)("span",{children:["There are no applications associated with this model. Learn about"," ",Object(O.jsx)("a",{className:"p-link--external",href:"https://juju.is/docs/deploying-applications",children:"deploying applications"})]}),H>1?Object(O.jsxs)(O.Fragment,{children:[!!$&&Object(O.jsx)(Gs,{title:Object(O.jsxs)(O.Fragment,{children:[Object(O.jsxs)("span",{children:[$," ",L($,"Offer")]}),Object(O.jsx)(bs,{chips:R,descriptor:null})]}),openByDefault:!0,children:T()}),!!P&&Object(O.jsx)(Gs,{title:Object(O.jsxs)(O.Fragment,{children:[Object(O.jsxs)("span",{children:[P," ",L(P,"Local application")]}),Object(O.jsx)(bs,{chips:M,descriptor:null})]}),openByDefault:!0,children:D()}),!!q&&Object(O.jsx)(Gs,{title:Object(O.jsxs)(O.Fragment,{children:[Object(O.jsxs)("span",{children:[q," ",L(q,"Remote application")]}),Object(O.jsx)(bs,{chips:I,descriptor:null})]}),openByDefault:!0,children:F()})]}):Object(O.jsxs)(O.Fragment,{children:[D(),T(),F()]})]}),Aa("machines",l.activeView)&&N.length>0&&Object(O.jsx)(Gn.a,{headers:Rs,rows:N,className:"entity-details__machines p-main-table",sortable:!0,emptyStateMsg:"There are no machines in this model"}),Aa("integrations",l.activeView)&&C.length>0?Object(O.jsxs)(O.Fragment,{children:[Aa("relations-title",l.activeView)&&Object(O.jsxs)("h5",{children:["Relations (",C.length,")"]}),Object(O.jsx)(Gn.a,{headers:Is,rows:C,className:"entity-details__relations p-main-table",sortable:!0,emptyStateMsg:"There are no relations in this model"}),Aa("relations-title",l.activeView)&&Object(O.jsx)(O.Fragment,{children:k.length>0||A.length>0&&Object(O.jsxs)("h5",{children:["Cross-model relations (",k.length+A.length,")"]})}),k.length>0&&Object(O.jsx)(Gn.a,{headers:Ps,rows:k,className:"entity-details__relations p-main-table",sortable:!0,emptyStateMsg:"There are no remote relations in this model"}),A.length>0&&Object(O.jsx)(Gn.a,{headers:Ls,rows:A,className:"entity-details__relations p-main-table",sortable:!0,emptyStateMsg:"There are no connected offers in this model"})]}):Object(O.jsx)(O.Fragment,{children:"integrations"===l.activeView&&Object(O.jsxs)("span",{"data-testid":"no-integrations-msg",children:["There are no integrations associated with this model -"," ",Object(O.jsx)("a",{className:"p-link--external",href:"https://juju.is/integration",children:"learn more about integration"})]})}),Aa("action-logs",l.activeView)&&Object(O.jsx)(wa,{})]})]});var W,J},Ea=n(48),Ma=n.n(Ea);function Ra(e){let{children:t,onFormChange:n=(()=>{}),onSetup:a=(()=>{})}=e;const{values:r,setFieldValue:c}=Object(hn.d)();return Object(s.useEffect)((()=>{a(c)}),[a,c]),Object(s.useEffect)((()=>{n(r)}),[n,r]),Object(O.jsx)(hn.b,{children:t})}var Ia=n.p+"static/media/run-action-icon.341fa27f.svg",Pa=n.p+"static/media/action-logs-icon.1a01b6a9.svg";function La(){const e=Object(m.g)(),{appName:t,userName:n,modelName:a}=Object(m.i)(),[r,i]=Object(s.useState)(!1),o=Object(s.useRef)(null),l=Object(s.useRef)(),d=Object(s.useRef)([]),u=Object(s.useRef)(!1),p=Object(c.c)(ws(a,n)),j=Object(c.c)(_s(p)),h=Object(c.c)(ys(p)),v=Object(c.c)(Cs(p)),f=Object(c.c)(xs(p)),g=_a(),w=Object(s.useMemo)((()=>{const e={};return h&&v?(Object.entries(h).forEach((n=>{let[s,a]=n;if(a.application===t){const t=a["machine-id"];e[t]=v[t]}})),e):null}),[h,v,t]),_=Object(s.useMemo)((()=>Ts(w,h,g)),[w,h,g]),y="kubernetes"===(null===f||void 0===f?void 0:f.type),N=Object(s.useMemo)((()=>{const e="unit-list-select-all";return((e,t)=>{let n=x()(Ms);return t&&(n=n.filter((e=>!("machine"===e.sortKey)))),n.splice(0,0,e),n})({content:Object(O.jsxs)("label",{className:"p-checkbox--inline",htmlFor:e,children:[Object(O.jsx)(hn.a,{id:e,type:"checkbox","aria-labelledby":"select-all-units",className:"p-checkbox__input",name:"selectAll"}),Object(O.jsx)("span",{className:"p-checkbox__label",id:"select-all-units"})]}),sortKey:"",className:"select-unit"},y)}),[y]),k=Object(s.useMemo)((()=>{if(!h)return null;const e={};return Object.entries(h).forEach((n=>{let[s,a]=n;(a.application===t||a.subordinate&&a.principal.split("/")[0]===t)&&(e[s]=a)})),e}),[h,t]),A=Object(s.useMemo)((()=>qs(k,g,!0,y)),[k,g,y]),[S,E]=Object(b.d)("tableview",Object(b.f)(b.c,"units")),[M,R]=Object(b.e)({activeView:Object(b.f)(b.c,"apps"),entity:b.c,panel:b.c}),I=null===j||void 0===j?void 0:j[t];let P={};var L;I&&(P={status:C(null===(L=I.status)||void 0===L?void 0:L.current),charm:I["charm-url"],os:"Ubuntu",revision:q(I["charm-url"])||"-",message:"-",provider:(null===f||void 0===f?void 0:f.type)||"-"});const U=Object(s.useMemo)((()=>function(e,t){const n={};return e&&Object.entries(e).forEach((e=>{let[s,a]=e;if(a.application===t){const e=a["agent-status"].current;if(e)return ya(e,n)}})),n}(h,t)),[h,t]),$=Object(s.useMemo)((()=>function(e,t,n){const s={};if(e&&t){const a=[];Object.entries(t).forEach((e=>{let[t,s]=e;s.application===n&&a.push(s["machine-id"])})),a.forEach((t=>{const n=e[t]["agent-status"].current;if(n)return ya(n,s)}))}return s}(v,h,t)),[v,h,t]),[T,D]=Object(b.e)({panel:b.c,units:b.a}),F=()=>{D({panel:"execute-action",units:d.current})};return Object(O.jsxs)(ha,{type:"app",className:"entity-details__app",children:[Object(O.jsxs)("div",{children:[Object(O.jsx)(Js,{}),Object(O.jsxs)(O.Fragment,{children:[Object(O.jsx)("div",{className:"entity-details__actions",children:Object(O.jsxs)("button",{className:"entity-details__action-button",onClick:()=>{M&&R({panel:"config",entity:t})},children:[Object(O.jsx)("i",{className:"p-icon--settings"}),"Configure"]})}),Object(O.jsx)(Oa,{data:P})]})]}),Object(O.jsxs)("div",{className:"entity-details__main u-overflow--auto",children:[!y&&Object(O.jsx)(ms,{buttons:["units","machines"],activeButton:S,setActiveButton:E}),Object(O.jsxs)("div",{className:"entity-details__tables",ref:o,children:["units"===S&&Object(O.jsxs)(O.Fragment,{children:[Object(O.jsx)(bs,{chips:U,descriptor:"units"}),Object(O.jsxs)("div",{className:"entity-details__action-button-row",children:[Object(O.jsxs)(Ma.a,{appearance:"base",className:"entity-details__action-button",hasIcon:!0,onClick:F,disabled:!r,"data-test":"run-action-button",children:[Object(O.jsx)("img",{className:"entity-details__action-button-row-icon",src:Ia,alt:""}),"Run action"]}),Object(O.jsx)("span",{className:"entity-details__action-button-divider"}),Object(O.jsxs)(Ma.a,{appearance:"base",className:"entity-details__action-button",hasIcon:!0,onClick:()=>{e.push(`/models/${n}/${a}?activeView=action-logs`)},"data-test":"show-action-logs",children:[Object(O.jsx)("img",{className:"entity-details__action-button-row-icon",src:Pa,alt:""}),"View Action Logs"]})]}),Object(O.jsx)(hn.c,{initialValues:{selectAll:!1,selectedUnits:[]},onSubmit:()=>{},children:Object(O.jsx)(Ra,{onFormChange:e=>{if(!l.current)return;let n=[];h&&(n=Object.keys(h).filter((e=>h[e].application===t))),u.current&&!e.selectAll?d.current.length===n.length&&l.current("selectedUnits",[]):!u.current&&e.selectAll&&l.current("selectedUnits",n),u.current=e.selectAll,d.current.length!==n.length&&e.selectedUnits.length===n.length?l.current("selectAll",!0):d.current.length===n.length&&e.selectedUnits.length!==n.length&&l.current("selectAll",!1),d.current.length!==e.selectedUnits.length&&"execute-action"===T.panel&&(d.current=e.selectedUnits,F()),d.current=e.selectedUnits,i(e.selectedUnits.length>0)},onSetup:e=>{l.current=e},children:Object(O.jsx)(Gn.a,{headers:N,rows:A,className:"entity-details__units p-main-table panel__table has-checkbox",sortable:!0,emptyStateMsg:"There are no units in this application","data-test":"units-table"})})})]}),"machines"===S&&Object(O.jsxs)(O.Fragment,{children:[Object(O.jsx)(bs,{chips:$,descriptor:"machines"}),Object(O.jsx)(Gn.a,{headers:Rs,rows:_,className:"entity-details__machines p-main-table panel__table",sortable:!0,emptyStateMsg:"There are no machines in this model","data-test":"machines-table"})]})]})]})]})}function Ua(){const{modelName:e,userName:t,unitId:n}=Object(m.i)(),a=n.replace(/-(\d+)$/,"/$1"),r=_a(),i=Object(c.c)(ws(e,t)),o=Object(c.c)(_s(i)),l=Object(c.c)(ys(i)),d=Object(c.c)(Cs(i)),u=Object(c.c)(xs(i)),p=Object(s.useMemo)((()=>{const e={};if(d&&l){const t=l[a]["machine-id"];e[t]=d[t]}return e}),[d,l,a]),j=Object(s.useMemo)((()=>{const e={};if(o&&l){const t=l[a].application;e[t]=o[t]}return e}),[o,l,a]),b=Object(c.c)(As(i)),h=Object(s.useMemo)((()=>Ts(p,l,r)),[p,l,r]),v=Object(s.useMemo)((()=>$s(j,b,r)),[j,b,r]),f=null===l||void 0===l?void 0:l[a];let g={};if(f){const e=(null===f||void 0===f?void 0:f["charm-url"])||"-";g={charm:e,os:"-",revision:q(e)||"-",version:(null===f||void 0===f?void 0:f["workload-status"].version)||"-",message:(null===f||void 0===f?void 0:f["workload-status"].message)||"-"}}return Object(O.jsxs)(ha,{type:"unit",children:[Object(O.jsxs)("div",{children:[Object(O.jsx)(Js,{}),Object(O.jsx)(Oa,{data:g})]}),Object(O.jsx)("div",{className:"entity-details__main u-overflow--auto",children:Object(O.jsxs)("div",{className:"slide-panel__tables",children:["kubernetes"!==(null===u||void 0===u?void 0:u.type)&&Object(O.jsx)(Gn.a,{headers:Rs,rows:h,className:"entity-details__machines p-main-table",sortable:!0,emptyStateMsg:"There are no machines in this model"}),Object(O.jsx)(Gn.a,{headers:Ss,rows:v,className:"entity-details__apps p-main-table",sortable:!0,emptyStateMsg:"There are no apps in this model"})]})})]})}function $a(){const{machineId:e,modelName:t,userName:n}=Object(m.i)(),a=_a(),r=Object(c.c)(ws(t,n)),i=Object(c.c)(_s(r)),o=Object(c.c)(ys(r)),l=Object(c.c)(Cs(r)),d=null===l||void 0===l?void 0:l[e],u=Object(c.c)(As(r)),p=Object(s.useMemo)((()=>{if(!i||!o)return null;const t={},n=new Set;return Object.entries(o).forEach((t=>{let[s,a]=t;a["machine-id"]===e&&n.add(a.application)})),[...n].forEach((e=>{t[e]=i[e]})),t}),[i,o,e]),j=Object(s.useMemo)((()=>{if(!o)return null;const t={};return Object.entries(o).forEach((n=>{let[s,a]=n;a["machine-id"]===e&&(t[s]=a)})),t}),[o,e]),b=Object(s.useMemo)((()=>$s(p,u,a)),[p,u,a]),h=Object(s.useMemo)((()=>qs(j,a)),[j,a]),v=null===d||void 0===d?void 0:d["hardware-characteristics"],f={memory:(null===v||void 0===v?void 0:v.mem)||"-",disk:(null===v||void 0===v?void 0:v["root-disk"])||"-",cpu:(null===v||void 0===v?void 0:v["cpu-power"])||"-",cores:(null===v||void 0===v?void 0:v["cpu-cores"])||"-",message:(null===d||void 0===d?void 0:d["agent-status"].message)||"-"};return Object(O.jsxs)(ha,{type:"machine",children:[Object(O.jsxs)("div",{children:[Object(O.jsx)(Js,{}),Object(O.jsx)(Oa,{data:f})]}),Object(O.jsx)("div",{className:"entity-details__main u-overflow--auto",children:Object(O.jsx)("div",{children:Object(O.jsxs)("div",{className:"entity-detail__tables",children:[Object(O.jsx)(Gn.a,{headers:Ms,rows:h,className:"entity-details__units p-main-table",sortable:!0,emptyStateMsg:"There are no units in this machine"}),Object(O.jsx)(Gn.a,{headers:Ss,rows:b,className:"entity-details__apps p-main-table",sortable:!0,emptyStateMsg:"There are no apps in this machine"})]})})})]})}function qa(){const e=Object(c.d)().getState(),t=Object(c.b)(),{userName:n,modelName:a}=Object(m.i)(),r=Object(c.c)(ws(a,n));return Object(s.useEffect)((()=>{let n=null,s=null,a=null;return r&&async function(){({conn:n,watcherHandle:a,pingerIntervalId:s}=await bt(r,e,t));const c=await n.facades.client.fullStatus();null!==c&&t(function(e,t){return{type:nt,payload:{status:t,uuid:e}}}(r,c))}(),()=>{a&&async function(e,t,n){e.facades.allWatcher._transport.write({type:"AllWatcher",request:"Stop",version:1,id:t}),lt(n),e.transport.close()}(n,a["watcher-id"],s)}}),[r]),Object(O.jsxs)(m.d,{children:[Object(O.jsx)(m.b,{path:"/models/:userName/:modelName",exact:!0,children:Object(O.jsx)(Sa,{})}),Object(O.jsx)(m.b,{path:"/models/:userName/:modelName/app/:appName",exact:!0,children:Object(O.jsx)(La,{})}),Object(O.jsx)(m.b,{path:"/models/:userName/:modelName/app/:appName/unit/:unitId",exact:!0,children:Object(O.jsx)(Ua,{})}),Object(O.jsx)(m.b,{path:"/models/:userName/:modelName/machine/:machineId",exact:!0,children:Object(O.jsx)($a,{})})]})}n(547);function Ta(){Tn("Settings");const[e,t]=Nn("disableAnalytics",!1);return Object(O.jsxs)(Pn,{children:[Object(O.jsx)(Ln,{children:Object(O.jsx)("span",{className:"l-content settings__header",children:"Settings"})}),Object(O.jsx)(qn,{isActive:!0,children:Object(O.jsx)("div",{className:"l-content settings",children:Object(O.jsx)("div",{className:"settings__toggles",children:Object(O.jsxs)("div",{className:"settings__toggles-group",children:[Object(O.jsxs)("label",{children:["Disable analytics",Object(O.jsx)("input",{type:"checkbox",className:"p-switch",defaultChecked:e,onChange:()=>{t(!e)}}),Object(O.jsx)("div",{className:"p-switch__slider"})]}),Object(O.jsx)("div",{className:"settings__toggles-info",children:"You will need to refresh your browser for this setting to take effect."})]})})})})]})}function Da(e){let{message:t,children:n}=e;return Object(O.jsxs)(O.Fragment,{children:[Object(O.jsx)("h1",{children:Object(O.jsx)("span",{role:"img","aria-label":"Shrug",children:"\xaf\\_(\u30c4)_/\xaf"})}),Object(O.jsx)("h2",{children:t}),Object(O.jsx)("div",{className:"not-found__content",children:n})]})}function Fa(){return Tn("404 - Page not found"),Object(O.jsx)(Pn,{children:Object(O.jsx)("div",{className:"p-strip",children:Object(O.jsx)("div",{className:"row",children:Object(O.jsxs)(Da,{message:"Hmm, we can't seem to find that page...",children:[Object(O.jsx)("p",{children:"Are you looking for any of the pages below?"}),Object(O.jsxs)("ul",{children:[Object(O.jsx)("li",{children:Object(O.jsx)(j.b,{to:"/models",children:"Models"})}),Object(O.jsx)("li",{children:Object(O.jsx)(j.b,{to:"/controllers",children:"Controllers"})}),Object(O.jsx)("li",{children:Object(O.jsx)(j.b,{to:"/settings",children:"Settings"})})]})]})})})})}function Va(){const e=Yt(),t=Object(m.h)();return Object(s.useEffect)((()=>{e({path:window.location.href.replace(window.location.origin,"")})}),[t,e]),Object(O.jsxs)(m.d,{children:[Object(O.jsx)(m.b,{path:"/",exact:!0,children:Object(O.jsx)(m.a,{to:"/models"})}),Object(O.jsx)(m.b,{path:"/models",exact:!0,children:Object(O.jsx)(Ut,{children:Object(O.jsx)(Os,{})})}),Object(O.jsx)(m.b,{path:"/models/:userName/:modelName",children:Object(O.jsx)(Ut,{children:Object(O.jsx)(qa,{})})}),Object(O.jsx)(m.b,{path:"/controllers",exact:!0,children:Object(O.jsx)(Ut,{children:Object(O.jsx)(Wn,{})})}),Object(O.jsx)(m.b,{path:"/settings",exact:!0,children:Object(O.jsx)(Ut,{children:Object(O.jsx)(Ta,{})})}),Object(O.jsx)(m.b,{children:Object(O.jsx)(Fa,{})})]})}n(548);var Ka=function(){const e=null!==!0||!0,{baseAppURL:t}=Object(c.c)(J),[n]=Nn("disableAnalytics",!1);return!e||n&&"false"!==n||(h.a.initialize("UA-1018242-68"),h.a.pageview(window.location.href.replace(window.location.origin,""))),Object(O.jsx)(j.a,{basename:t,children:Object(O.jsx)(v,{children:Object(O.jsx)(b.b,{ReactRouterRoute:m.b,children:Object(O.jsx)(Va,{})})})})};const Ha=["POPULATE_MISSING_ALLWATCHER_DATA","PROCESS_ALL_WATCHER_DELTAS","STORE_BAKERY","STORE_LOGIN_ERROR","STORE_CONFIG","STORE_USER_PASS","STORE_VERSION","UPDATE_CONTROLLER_CONNECTION","UPDATE_CONTROLLER_LIST","UPDATE_JUJU_API_INSTANCE","UPDATE_PINGER_INTERVAL_ID","LOG_OUT","CLEAR_CONTROLLER_DATA","CLEAR_MODEL_DATA","STORE_VISIT_URL","TOGGLE_USER_MENU","SIDENAV_COLLAPSED"],Ba=["connectAndStartPolling","logOut"];function Wa(e,t){console.log("unable to perform action:",e,"user not authenticated for:",t)}const Ja=(e,t)=>(t||console.error("unable to determine logged in status"),se(t,e));var Ga=e=>{let{getState:t}=e;return e=>async(n,s)=>{const a=t(),r=null===s||void 0===s?void 0:s.wsControllerURL;if("function"===typeof n){if(Ba.includes(n.NAME)||Ja(a,r))return void await e(n);Wa(n.NAME,r)}else{if(Ha.includes(n.type)||Ja(a,r))return void e(n);Wa(n.type,r)}}},Ya=n(78);var za=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return Object(Ya.a)(e,(n=>{switch(t.type){case yt:const s=x()(e.controllerConnections||{});s[t.payload.wsControllerURL]=t.payload.conn,n.controllerConnections=s;break;case vt:n.bakery=t.payload;break;case ft:n.config=t.payload;break;case gt:n.loginError=t.payload;break;case xt:const a=x()(e.credentials||{});a[t.payload.wsControllerURL]=t.payload.credential,n.credentials=a;break;case wt:n.appVersion=t.payload;break;case _t:n.visitURL=t.payload;break;case Ot:delete n.bakery.storage._store.identity,delete n.controllerConnections,delete n.visitURL;break;case Nt:const r=x()(e.jujus||{});r[t.payload.wsControllerURL]=t.payload.juju,n.jujus=r;break;case Ct:const c=x()(e.pingerIntervalIds||{});c[t.payload.wsControllerURL]=t.payload.intervalId,n.pingerIntervalIds=c}}))};var Xa=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{userMenuActive:!1,confirmationModalActive:!1,sideNavCollapsed:!1},t=arguments.length>1?arguments[1]:void 0;return Object(Ya.a)(e,(e=>{switch(t.type){case zt.userMenuActive:e.userMenuActive=t.payload;break;case zt.confirmationModalActive:e.confirmationModalActive=t.payload;break;case zt.sideNavCollapsed:e.sideNavCollapsed=t.payload}}))},Qa=n(66),Za=n.n(Qa);let er,tr,nr;function sr(e,t,n,s,a){if(e===tr.CHANGE){const e={[a]:t};Za()(n[s],e)}else e===tr.REMOVE&&s!==nr.MODEL&&delete n[s][a]}function ar(e,t){if(t)return t.forEach((t=>{const n=t[2]["model-uuid"];e[n]||(e[n]={actions:{},annotations:{},applications:{},charms:{},machines:{},model:{"cloud-tag":"","controller-uuid":"","is-controller":!1,"model-uuid":"",config:{},constraints:{},life:"",name:"",owner:"",region:"",sla:{level:"",owner:""},status:{current:"",message:"",since:"",version:""},type:"",version:""},relations:{},units:{}});const s=e[n],a=sr.bind(null,t[1],t[2],s);if(t[0]===er.ACTION)a(nr.ACTIONS,t[2].id);else if(t[0]===er.ANNOTATION){const e={[t[2].tag.replace("application-","")]:t[2].annotations};Za()(s[nr.ANNOTATIONS],e)}else if(t[0]===er.APPLICATION){const e={[t[2].name]:t[2]};void 0===e[t[2].name]["unit-count"]&&(e[t[2].name]["unit-count"]=0),Za()(s[nr.APPLICATIONS],e)}else if(t[0]===er.CHARM)a(nr.CHARMS,t[2]["charm-url"]);else if(t[0]===er.MACHINE)a(nr.MACHINES,t[2].id);else if(t[0]===er.MODEL)t[1]===tr.CHANGE&&Za()(e[n].model,t[2]);else if(t[0]===er.RELATION)a(nr.RELATIONS,t[2].key);else if(t[0]===er.UNIT){a(nr.UNITS,t[2].name);const e={};Object.entries(s.units).forEach((t=>{let[n,s]=t;const a=n.split("/")[0];void 0===e[a]&&(e[a]=0),e[a]+=1})),Object.entries(e).forEach((e=>{let[t,n]=e;s.applications[t]||(s.applications[t]={}),s.applications[t]["unit-count"]=n}))}})),e}!function(e){e.ACTION="action",e.ANNOTATION="annotation",e.APPLICATION="application",e.CHARM="charm",e.MACHINE="machine",e.MODEL="model",e.RELATION="relation",e.UNIT="unit"}(er||(er={})),function(e){e.CHANGE="change",e.REMOVE="remove"}(tr||(tr={})),function(e){e.ACTIONS="actions",e.ANNOTATIONS="annotations",e.APPLICATIONS="applications",e.CHARMS="charms",e.MACHINES="machines",e.MODEL="model",e.RELATIONS="relations",e.UNITS="units"}(nr||(nr={}));const rr={models:{},modelData:{},modelWatcherData:{}};function cr(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:rr,t=arguments.length>1?arguments[1]:void 0;return Object(Ya.a)(e,(n=>{var s,a;const r=t.payload;switch(t.type){case et:const i=x()(e.models||{});let o=t.payload["user-models"];o||(o=[]),o.forEach((e=>{i[e.model.uuid]={lastConnection:e.lastConnection,name:e.model.name,ownerTag:e.model["owner-tag"],type:e.model.type,uuid:e.model.uuid}})),n.models=i;break;case Ze:const l=r.modelUUID;n.modelData[l]||(n.modelData[l]={});["annotations","applications","machines","model","offers","relations","remote-applications"].forEach((e=>{n.modelData[l][e]=r.status[e]})),n.modelData[l].uuid=l;break;case Qe:const d=r.results[0].result;n.modelData[d.uuid]&&(n.modelData[d.uuid].info=d);break;case ze:n.modelData={},n.models={};break;case Ye:n.controllers={};break;case Xe:const u=x()(e.controllers||{});u[t.payload.wsControllerURL]=t.payload.controllers,n.controllers=u;break;case nt:var c;if(null===(s=n.modelWatcherData)||void 0===s||null===(a=s[r.uuid])||void 0===a||!a.model)null!==(c=n.modelWatcherData)&&void 0!==c&&c[r.uuid]||(n.modelWatcherData[r.uuid]={}),n.modelWatcherData[r.uuid].model={};Za()(n.modelWatcherData[r.uuid].model,{"cloud-tag":r.status.model["cloud-tag"],type:r.status.model.type,region:r.status.model.region,version:r.status.model.version});break;case tt:n.modelWatcherData=ar(n.modelWatcherData,r)}}))}var ir=n(155);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));u.a({dsn:"https://5f679e274f34464194e9592a91ed65d4@sentry.is.canonical.com//29"}),p.b("dashboardVersion",ir.a);let or=0;const lr=()=>{if(window.jujuDashboardConfig)!function(){const e=window.jujuDashboardConfig,t=e.controllerAPIEndpoint;if(t&&!t.includes("://")){const n=window.location.protocol.includes("https")?"wss":"ws";e.controllerAPIEndpoint=`${n}://${window.location.host}${t}`}if(null===e.baseControllerURL){const t=window.location.protocol.includes("https")?"wss":"ws";e.controllerAPIEndpoint=`${t}://${window.location.host}/api`}p.b("isJuju",e.isJuju);const n=Object(i.createStore)(Object(i.combineReducers)({root:za,juju:cr,ui:Xa}),Object(l.composeWithDevTools)(Object(i.applyMiddleware)(Ga,o.a)));n.dispatch(function(e){return{type:ft,payload:e}}(e)),n.dispatch((a=ir.a,{type:wt,payload:a}));var a;const u=new d.Bakery({visitPage:e=>{var t;n.dispatch((t=e.Info.VisitURL,{type:_t,payload:t}))},storage:new d.BakeryStorage(localStorage,{})});n.dispatch(function(e){return{type:vt,payload:e}}(u)),e.identityProviderAvailable&&n.dispatch(St(n,u));const j=document.getElementById("root");r.a.render(Object(O.jsx)(c.a,{store:n,children:Object(O.jsx)(s.StrictMode,{children:Object(O.jsx)(Ka,{})})}),j)}();else{if(or<5)return or++,void setTimeout(lr,500);console.error("Configuration values not defined unable to bootstrap application")}};lr(),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((e=>{e.unregister()}))}},[[549,1,2]]]);
//# sourceMappingURL=main.9613f97c.chunk.js.map