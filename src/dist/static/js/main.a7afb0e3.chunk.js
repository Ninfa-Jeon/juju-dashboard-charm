(this["webpackJsonpjuju-dashboard"]=this["webpackJsonpjuju-dashboard"]||[]).push([[0],{133:function(e,t,n){},148:function(e){e.exports=JSON.parse('{"a":"0.9.0"}')},326:function(e,t){},328:function(e,t){},338:function(e,t){},340:function(e,t){},367:function(e,t){},368:function(e,t){},373:function(e,t){},375:function(e,t){},382:function(e,t){},401:function(e,t){},418:function(e,t){},429:function(e,t,n){},430:function(e,t,n){},431:function(e,t,n){},432:function(e,t,n){},434:function(e,t,n){},435:function(e,t,n){},436:function(e,t,n){},437:function(e,t,n){},438:function(e,t,n){},439:function(e,t,n){},440:function(e,t,n){},441:function(e,t,n){},442:function(e,t,n){},443:function(e,t,n){},444:function(e,t,n){},445:function(e,t,n){},455:function(e,t,n){},456:function(e,t,n){},457:function(e,t,n){},458:function(e,t,n){},459:function(e,t,n){},460:function(e,t,n){},528:function(e,t,n){},529:function(e,t,n){},530:function(e,t,n){},531:function(e,t,n){},532:function(e,t,n){},533:function(e,t,n){},534:function(e,t,n){},535:function(e,t,n){},536:function(e,t,n){},537:function(e,t,n){},538:function(e,t,n){},539:function(e,t,n){"use strict";n.r(t);var s=n(0),a=n(1),c=n(57),i=n.n(c),o=n(4),l=n(89),r=n(227),d=n(228),u=n(144),j=n(547),b=n(29),m=n(9),p=n(21),h=n(5),O=n(73);class f extends a.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){b.c((n=>{n.setExtras(t);const s=b.a(e);this.setState({eventId:s})}))}render(){const{hasError:e}=this.state,{children:t}=this.props;return e?Object(s.jsx)("div",{className:"p-notification--negative",children:Object(s.jsxs)("p",{className:"p-notification__response",children:[Object(s.jsx)("span",{className:"p-notification__status",children:"Error: "}),"Something has gone wrong. If this issue persists,"," ",Object(s.jsx)("a",{href:"https://github.com/canonical-web-and-design/jaas-dashboard/issues/new?assignees=&labels=&template=bug_report.md&title=",children:"please raise an issue on GitHub."})]})}):t}}var v=n(14),g=n(12),x=n.n(g),N=n(548),_=n(550),y=n.p+"static/media/default-charm-icon.22a7fa5d.svg";function w(e,t,n){return e?Object(s.jsxs)("div",{className:"entity-name u-truncate",title:t,children:[n&&Object(s.jsx)("span",{className:"subordinate"}),e&&K(t,e),t]}):null}const k=(e="unknown",t,n=!0,a=!1)=>{let c=e?`is-${e.toLowerCase()}`:"",i="";void 0!==t&&(i=` (${t})`);const o=n?"status-icon "+c:"";return a&&"is-running"===c?Object(s.jsxs)("span",{className:"status-icon is-spinner",children:[Object(s.jsx)("i",{className:"p-icon--spinner u-animation--spin"}),e]}):Object(s.jsxs)("span",{className:o,children:[e,i]})},C=["running","alert","blocked"],E=(e,t)=>C.indexOf(e)>C.indexOf(t)?e:t,S=e=>e===C[C.length-1],A=e=>{let t=C[0],n=[];const s=e.applications||{};return Object.keys(s).forEach((e=>{const a=s[e],{status:c}=R(a);if(t=E(c,t),S(t))return void n.push(a.status.info);const i=a.units||{};Object.keys(i).forEach((e=>{const s=i[e],{status:a}=L(s);t=E(a,t),S(t)&&n.push(s["agent-status"].info)}))})),{highestStatus:t,messages:n}},R=e=>{const t=e.status.status,n={status:"running",message:null};return["blocked"].includes(t)&&(n.status="blocked"),["unknown"].includes(t)&&(n.status="alert"),n},I=e=>{const t=e["agent-status"].status,n={status:"running",message:null};return["down"].includes(t)&&(n.status="blocked"),["pending"].includes(t)&&(n.status="alert"),n},L=e=>{const t=e["agent-status"].status,n={status:"running",message:null};return["lost"].includes(t)&&(n.status="blocked"),["allocating"].includes(t)&&(n.status="alert"),n},M=e=>e.split("@")[0].replace("user-",""),$=(e,t)=>{const n={active:"active",allocating:"allocating",down:"down",joined:"joined",lost:"lost",running:"running",started:"started",unknown:"unknown",waiting:"waiting"};return 1===e?t:n[t]?n[t]:`${t}s`},T=(e="")=>e.replace("cloud-",""),U=e=>{if(!e)return"-";let t=e.split("cloudcred-")[1];return t.indexOf("@")>-1?t.split("@")[1].split("_")[1]:t.split("_")[1]},D=(e="")=>e.split("-").pop(),F=e=>{if(0===e.indexOf("local:"))return y;if(0===e.indexOf("cs:"))return`https://api.jujucharms.com/charmstore/v5/${e=e.replace("cs:","")}/icon.svg`;if(0===e.indexOf("ch:")){return`https://charmhub.io/${e.match(/\/(.+)\/(.+)-\d+/)[2]}/icon`}return""},V=e=>e||void 0!==e,K=(e,t)=>{let n=y;return 0!==t.indexOf("local:")&&(n=F(t)),Object(s.jsx)("img",{alt:e+" icon",title:e,width:"24",height:"24",className:"entity-icon",src:n},e)},P=(e,t)=>{const n=t[e];if(n&&e)return K(e,n["charm-url"])},H=(e,t)=>{let n=!1;const s=["admin","write","owner"];return t&&t.forEach((t=>{t.user===e&&s.includes(t.access)&&(n=!0)})),n},B=e=>{var t;return(null===e||void 0===e||null===(t=e.juju)||void 0===t?void 0:t.modelData)?e.juju.modelData:null},W=e=>{var t;return null===e||void 0===e||null===(t=e.juju)||void 0===t?void 0:t.controllers},J=e=>{var t;return null===e||void 0===e||null===(t=e.root)||void 0===t?void 0:t.bakery},q=e=>{var t;return null===e||void 0===e||null===(t=e.root)||void 0===t?void 0:t.config},G=(e,t)=>{var n,s;return null===t||void 0===t||null===(n=t.root)||void 0===n||null===(s=n.credentials)||void 0===s?void 0:s[e]},Y=e=>{var t;return null===e||void 0===e||null===(t=e.root)||void 0===t?void 0:t.loginError},z=e=>{var t;return null===e||void 0===e||null===(t=e.root)||void 0===t?void 0:t.appVersion},X=e=>Object(v.a)([B,W],((t,n)=>te(e,t,n))),Q=e=>{const t={blocked:[],alert:[],running:[]};if(!e)return t;for(let n in e){const s=e[n],{highestStatus:a}=A(s);t[a].push(s)}return t},Z=e=>{const t={};if(!e)return t;for(let n in e){const s=e[n];if(s.info){const e=M(s.info["owner-tag"]);t[e]||(t[e]=[]),t[e].push(s)}}return t},ee=e=>{const t={};if(!e)return t;for(let n in e){const s=e[n];if(s.info){const e=T(s.info["cloud-tag"]);t[e]||(t[e]=[]),t[e].push(s)}}return t},te=(e,t,n)=>{const s=x()(t);if(Object.entries(s).forEach((e=>{if(e[1].info){let t=null;const s=e[1].info;n&&Object.entries(n).some((e=>{var n;return t=null===(n=e[1].find((e=>s["controller-uuid"]===e.uuid)))||void 0===n?void 0:n.path,t})),"a030379a-940f-4760-8fcf-3062b41a04e7"===s["controller-uuid"]&&(t="JAAS"),t||(t=s["controller-uuid"]),s.controllerName=t}})),!e)return s;const a={};return Object.entries(e).forEach((e=>{0!==e[1].length&&(a[e[0]]||(a[e[0]]=[]),a[e[0]].push(e[1]))})),Object.entries(s).forEach((([e,t])=>{var n;const c=null===t||void 0===t||null===(n=t.model)||void 0===n?void 0:n.name,i=(null===t||void 0===t?void 0:t.model)&&T(t.model["cloud-tag"]),o=(null===t||void 0===t?void 0:t.info)&&U(t.info["cloud-credential-tag"]),l=(null===t||void 0===t?void 0:t.model)&&t.model.region,r=(null===t||void 0===t?void 0:t.info)&&M(t.info["owner-tag"]),d=`${c} ${i} ${o} ${l} ${r}`;Object.entries(a).some((([e,n])=>{const s=n[0];switch(e){case"cloud":return!s.includes(i);case"credential":if(t.info)return!s.includes(o);break;case"region":return!s.includes(l);case"owner":if(t.info)return!s.includes(r);break;case"custom":return!s.some((e=>function(e){return d.includes(e)}(e)))}return!1}))&&delete s[e]})),s},ne=e=>Object(v.a)(B,(t=>((e,t)=>{let n=null,s=null;if((null===e||void 0===e?void 0:e.includes("/"))?[n,s]=e.split("/"):s=e,t)for(let a in t){const e=t[a].info;if(e&&e.name===s){if(!n)return a;if(e["owner-tag"]===`user-${n}`)return a}}return null})(e,t))),se=(Object(v.a)((e=>{var t;let n=null;return(null===e||void 0===e||null===(t=e.root)||void 0===t?void 0:t.bakery)&&(n=e.root.bakery.storage._store),n}),(e=>{if(!e)return null;let t={};return Object.keys(e).forEach((n=>{try{t[n]=JSON.parse(atob(e[n]))}catch(s){console.error("Unable to decode macaroons",s)}})),t})),(e,t)=>{var n,s,a,c;return null===(n=t.root.controllerConnections)||void 0===n||null===(s=n[e])||void 0===s||null===(a=s.info)||void 0===a||null===(c=a.user)||void 0===c?void 0:c.identity}),ae=(e,t)=>{var n,s;return null===t||void 0===t||null===(n=t.root)||void 0===n||null===(s=n.controllerConnections)||void 0===s?void 0:s[e]},ce=e=>{var t;return null===e||void 0===e||null===(t=e.root)||void 0===t?void 0:t.controllerConnections},ie=(e,t)=>{var n,s,a;return null===t||void 0===t||null===(n=t.root)||void 0===n||null===(s=n.controllerConnections)||void 0===s||null===(a=s[e])||void 0===a?void 0:a.info.user.identity},oe=e=>Object(v.a)(B,(t=>((e,t)=>t&&t[e]?t[e]:null)(e,t))),le=Object(v.a)(B,Q),re=Object(v.a)(B,(e=>{const t={blocked:[],alert:[],running:[]};if(!e)return t;for(let n in e){const s=e[n];for(let e in s.machines){const n=s.machines[e];t[I(n).status].push(n)}}return t})),de=Object(v.a)(B,(e=>{const t={blocked:[],alert:[],running:[]};if(!e)return t;for(let n in e){const s=e[n];for(let e in s.applications){const n=s.applications[e];for(let e in n.units){const s=n.units[e];t[L(s).status].push(s)}}}return t})),ue=Object(v.a)(B,(e=>{const t={blocked:[],alert:[],running:[]};if(!e)return t;for(let n in e){const s=e[n];for(let e in s.applications){const n=s.applications[e];t[R(n).status].push(n)}}return t})),je=Object(v.a)(le,(e=>({blocked:e.blocked.length,alert:e.alert.length,running:e.running.length}))),be=Object(v.a)(q,(e=>e.controllerAPIEndpoint));var me=n(230),pe=n.n(me),he=n(149),Oe=n(231),fe=n(232),ve=n(233),ge=n(234),xe=n(235),Ne=n(236),_e=n(237),ye=n(238),we=n(239);const{autoBind:ke}=n(19);class Ce{constructor(e,t){this._transport=e,this._info=t,this.version=2,ke(this)}disableControllerUUIDMasking(){return new Promise(((e,t)=>{const n={type:"JIMM",request:"DisableControllerUUIDMasking",version:2,params:{}};this._transport.write(n,e,t)}))}listControllers(){return new Promise(((e,t)=>{const n={type:"JIMM",request:"ListControllers",version:2,params:{}};this._transport.write(n,e,t)}))}}Ce.NAME="JIMM",Ce.VERSION=2;var Ee=Ce;const Se="CLEAR_CONTROLLER_DATA",Ae="CLEAR_MODEL_DATA",Re="UPDATE_CONTROLLER_LIST",Ie="UPDATE_MODEL_INFO",Le="UPDATE_MODEL_STATUS",Me="UPDATE_MODEL_LIST",$e="PROCESS_ALL_WATCHER_DELTAS",Te="POPULATE_MISSING_ALLWATCHER_DATA";function Ue(e,t){return{type:Re,payload:{wsControllerURL:e,controllers:t}}}function De(e){return{type:Me,payload:e}}function Fe(e){return{type:Ie,payload:e}}function Ve(e=!1,t,n){const s=[Oe.a,fe.a,ve.a,ge.a,xe.a,Ne.a,_e.a,Ee,ye.a];return e&&s.push(we.a),{bakery:t,closeCallback:n,debug:!1,facades:s,wsclass:WebSocket}}function Ke(e,t){let n={};return t||(n={username:e.user,password:e.password}),n}function Pe(e){const t=window.setInterval((()=>{e.facades.pinger.ping().catch((e=>{console.error("pinger stopped,",e),He(t)}))}),2e4);return t}function He(e){e&&clearInterval(e)}async function Be(e,t,n,s){const a=new Promise((e=>{setTimeout(e,5e3,"timeout")})),c=Ke(t,s),i=Object(he.b)(e,c,n);return new Promise(((e,t)=>{Promise.race([a,i]).then((n=>{"timeout"!==n?e(n):t("timeout")}))}))}async function We(e,t,n,s){const a=await async function(e,t,n){const s=n(),a=J(s),c=be(s),{identityProviderAvailable:i}=q(s);let o=!1;c===t&&(o=i);const l=t.replace("/api",`/model/${e}/api`);let r=null;if(se(t,n()))try{const e=G(t,n()),{conn:s,logout:c}=await Be(l,e,Ve(!1,a),o);if(se(t,n())&&(r=await s.facades.client.fullStatus(),r.error))return void console.error(r.error);if(se(t,n())){const e=Object.keys(r.applications).map((e=>({tag:`application-${e}`}))),t=await s.facades.annotations.get({entities:e}),n={};t.results.forEach((e=>{if(Object.keys(e.annotations).length>0){const t=e.entity.replace("application-","");n[t]=e.annotations}})),r.annotations=n}c()}catch(d){console.error("error connecting to model:",e,d)}return r}(e,t,s);null!==a&&n(function(e,t){return{type:Le,payload:{modelUUID:e,status:t}}}(e,a),{wsControllerURL:t})}async function Je(e,t){return await e.facades.modelManager.modelInfo({entities:[{tag:`model-${t}`}]})}async function qe(e,t,n,s){const a=s.getState,c=s.dispatch,i=new pe.a({concurrency:1});return t.forEach((t=>{i.push((async s=>{if(se(e,a())&&await We(t,e,c,a),se(e,a())){const s=await Je(n,t);c(Fe(s),{wsControllerURL:e}),s.results[0].result.isController&&c(function(e,t){return async function(n,s){var a,c;const i=null===(a=s())||void 0===a||null===(c=a.juju)||void 0===c?void 0:c.controllers[e],o=t.results[0].result;if(i){const t=x()(i).map((e=>(e.uuid===o["controller-uuid"]&&(e.location={cloud:o["cloud-region"],region:o["cloud-tag"].replace("cloud-","")}),e)));n(Ue(e,t),{wsControllerURL:e})}else console.log("attempting to update non-existent controller:",e)}}(e,s),{wsControllerURL:e})}s()}))})),new Promise((e=>{i.onDone((()=>{e()}))}))}async function Ge(e,t){const n=J(t),s=be(t),{identityProviderAvailable:a}=q(t),c=G(s,t),i=s.replace("/api",`/model/${e}/api`),{conn:o}=await Be(i,c,Ve(!0,n),a);return o}async function Ye(e,t,n){const s=await Ge(e,t),a=await s.facades.client.watchAll(),c=e=>{var t;(null===e||void 0===e?void 0:e.deltas)&&n((t=null===e||void 0===e?void 0:e.deltas,{type:$e,payload:t})),s.facades.allWatcher._transport.write({type:"AllWatcher",request:"Next",version:1,id:a["watcher-id"]},c)},i=Pe(s);return c(),{conn:s,watcherHandle:a,pingerIntervalId:i}}async function ze(e,t,n){try{const s=e.getState(),{identityProviderAvailable:a,isJuju:c}=q(s),i=be(s),o=G(i,s),l=ce(s)||{};let r=[[i,o,t,a]];n&&(r=r.concat(n));const d=Object.keys(l);r=r.filter((e=>!d.includes(e[0]))),r.forEach((t=>async function(e,t,n){let s,a,c,i;try{if(({conn:s,error:a,juju:c,intervalId:i}=await async function(e,t,n,s){const c=await Object(he.a)(e,Ve(!0,n,(e=>console.log("controller closed",e)))),i=Ke(t,s);let o=null;try{o=await c.login(i)}catch(a){return{error:a}}return{conn:o,juju:c,intervalId:Pe(o)}}(...e)),a)return void n.dispatch(function(e){return{type:et,payload:e}}(a))}catch(r){return console.log("unable to log into controller",r,e)}var o,l;b.b("jujuVersion",null===(o=s)||void 0===o||null===(l=o.info)||void 0===l?void 0:l.serverVersion);if(n.dispatch(function(e,t){return{type:at,payload:{wsControllerURL:e,conn:t}}}(e[0],s)),n.dispatch(function(e,t){return{type:ct,payload:{wsControllerURL:e,juju:t}}}(e[0],c)),n.dispatch(function(e,t){return{type:it,payload:{wsControllerURL:e,intervalId:t}}}(e[0],i)),async function(e,t,n,s){let a=null;if(t.facades.jimM)a=(await t.facades.jimM.listControllers()).controllers,a.forEach((e=>e.additionalController=n));else{var c,i;const o=await t.facades.controller.controllerConfig();a=[{path:o.config["controller-name"],uuid:o.config["controller-uuid"],version:null===(c=ae(e,s.getState()))||void 0===c||null===(i=c.info)||void 0===i?void 0:i.serverVersion,additionalController:n}]}s.dispatch(Ue(e,a),{wsControllerURL:e})}(e[0],s,e[4],n),!t)try{await function(e){return new Promise((async(t,n)=>{var s;if(null===e||void 0===e||null===(s=e.facades)||void 0===s?void 0:s.jimM)try{await e.facades.jimM.disableControllerUUIDMasking(),t()}catch(r){n()}else t()}))}(s)}catch(r){}do{try{const t=await s.facades.modelManager.listModels({tag:s.info.user.identity});n.dispatch(De(t),{wsControllerURL:e[0]});const a=t["user-models"].map((e=>e.model.uuid));await qe(e[0],a,s,n)}catch(r){console.log(r)}await new Promise((e=>{setTimeout((()=>{e(!0)}),3e4)}))}while(se(e[0],n.getState()))}(t,c,e)))}catch(s){console.error("Something went wrong: ",s)}}const Xe="LOG_OUT",Qe="STORE_BAKERY",Ze="STORE_CONFIG",et="STORE_LOGIN_ERROR",tt="STORE_USER_PASS",nt="STORE_VERSION",st="STORE_VISIT_URL",at="UPDATE_CONTROLLER_CONNECTION",ct="UPDATE_JUJU_API_INSTANCE",it="UPDATE_PINGER_INTERVAL_ID";function ot(e,t){return{type:tt,payload:{wsControllerURL:e,credential:t}}}function lt(e){async function t(t){var n,s;const a=e.getState(),c=null===a||void 0===a||null===(n=a.root)||void 0===n||null===(s=n.config)||void 0===s?void 0:s.identityProviderAvailable,i=J(a),o=(e=>{var t;return null===e||void 0===e||null===(t=e.root)||void 0===t?void 0:t.jujus})(a),l=(e=>{var t;return null===e||void 0===e||null===(t=e.root)||void 0===t?void 0:t.pingerIntervalIds})(a);i.storage._store.removeItem("identity"),i.storage._store.removeItem("https://api.jujucharms.com/identity"),localStorage.removeItem("additionalControllers"),Object.entries(o).forEach((e=>e[1].logout())),Object.entries(l).forEach((e=>clearInterval(e[1]))),t({type:Xe}),t({type:Ae}),t({type:Se}),c&&t(rt(e,i))}return t.NAME="logOut",t}function rt(e,t){async function n(n){let s=null;try{const e=window.localStorage.getItem("additionalControllers");e&&(s=JSON.parse(e),s.forEach((e=>{n(ot(e[0],e[1])),n(Ue(e[0],[{additionalController:!0}]))})))}catch(a){console.log("Error retrieving additional registered controllers",a)}ze(e,t,s)}return n.NAME="connectAndStartPolling",n}var dt=n(42),ut=n.n(dt),jt=n(549),bt=n(546);function mt({children:e,isActive:t=!0}){return Object(s.jsx)(s.Fragment,{children:t&&Object(s.jsx)(jt.a,{children:Object(s.jsx)(bt.a.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},children:e})})})}var pt=n.p+"static/media/logo-black-on-white.3b8d326f.svg";n(429);function ht({children:e}){const{identityProviderAvailable:t}=Object(o.c)(q),n=Object(o.c)(ce)||{},a=Object.keys(n),c=Object(o.d)(),i=a.some((e=>se(e,c.getState()))),l=Object(o.c)(Y);return Object(s.jsxs)(s.Fragment,{children:[!i&&Object(s.jsx)("div",{className:"login",children:Object(s.jsx)(mt,{isActive:!i,children:Object(s.jsxs)("div",{className:"login__inner p-card--highlighted",children:[Object(s.jsx)("img",{className:"login__logo",src:pt,alt:"JAAS logo"}),t?Object(s.jsx)(ft,{userIsLoggedIn:i}):Object(s.jsx)(vt,{}),Ot(l)]})})}),Object(s.jsx)("div",{className:"app-content",children:e})]})}function Ot(e){if(!e)return null;let t=null;switch(e){case'"user-" is not a valid user tag':t="Invalid user name";break;case"invalid entity name or password":t="Invalid user name or password";break;default:t=e}return Object(s.jsxs)("p",{className:"error-message",children:[Object(s.jsx)("i",{className:"p-icon--error"}),t]})}function ft({userIsLoggedIn:e}){const t=Object(o.c)((t=>{var n;if(!e)return null===t||void 0===t||null===(n=t.root)||void 0===n?void 0:n.visitURL}));return Object(s.jsx)(gt,{visitURL:t})}function vt(){const e=Object(o.b)(),t=Object(o.d)(),n=Object(o.c)(J),c=Object(a.useRef)();return Object(a.useEffect)((()=>{c.current.focus()}),[]),Object(s.jsxs)("form",{onSubmit:function(s){s.preventDefault();const a=s.currentTarget.elements,c=a.username.value,i=a.password.value;e(ot(be(t.getState()),{user:c,password:i})),e(rt(t,n))},children:[Object(s.jsx)("label",{htmlFor:"username",children:"Username"}),Object(s.jsx)("input",{type:"text",name:"username",id:"username",ref:c}),Object(s.jsx)("label",{htmlFor:"password",children:"Password"}),Object(s.jsx)("input",{type:"password",name:"password",id:"password"}),Object(s.jsx)("button",{className:"p-button--positive",type:"submit",children:"Log in to the dashboard"})]})}function gt({visitURL:e}){return e?Object(s.jsx)("a",{className:"p-button--positive",href:e,rel:"noopener noreferrer",target:"_blank",children:"Log in to the dashboard"}):Object(s.jsx)("button",{className:"p-button--neutral",disabled:!0,children:Object(s.jsx)(ut.a,{text:"Connecting..."})})}var xt=n(37),Nt=n.p+"static/media/logo-mark.b44c09ab.svg",_t=n.p+"static/media/jaas-text.107a2fc8.svg",yt=n.p+"static/media/juju-text.b4135778.svg";n(430);function wt(){const e=Object(o.c)(q).isJuju;return Object(s.jsxs)("a",{href:e?"https://juju.is":"https://jaas.ai",className:"logo",children:[Object(s.jsx)("img",{src:Nt,alt:"Juju logo mark",height:"20",width:"20"}),Object(s.jsx)("img",{className:"logo__text",src:e?yt:_t,height:"20",alt:"Juju logo"})]})}var kt=n(6),Ct=n.n(kt);n(431);function Et({isActive:e,children:t,variant:n}){const[c,i]=Object(a.useState)(!1);return Object(a.useEffect)((()=>{i(!1)}),[n]),Object(s.jsxs)("div",{className:"banner","data-active":e&&!c,"data-variant":n,children:[t,Object(s.jsx)("button",{className:"banner__close",onClick:()=>{i(!0)},children:Object(s.jsx)("i",{className:Ct()("p-icon--close",{"is-light":"positive"===n}),children:"Close banner"})})]})}function St(){return({path:e,category:t="",action:n=""})=>{const s=localStorage.getItem("disableAnalytics");(null!==!0||!0)&&"true"!==s&&(e?O.a.pageview(e):O.a.event({category:t,action:n}))}}let At;function Rt(e){return{type:At.sideNavCollapsed,payload:e}}!function(e){e.userMenuActive="TOGGLE_USER_MENU",e.confirmationModalActive="TOGGLE_CONFIRMATION_MODAL",e.sideNavCollapsed="SIDENAV_COLLAPSED"}(At||(At={}));const It=e=>e.ui.userMenuActive,Lt=e=>e.ui.sideNavCollapsed;n(432);var Mt=()=>{const e=St(),t=Object(o.b)(),n=Object(o.d)(),c=n.getState,i=ie(Object(o.c)(be),c()),l=Object(o.c)(It)||!1;Object(a.useEffect)((()=>{l&&e({category:"User",action:"Opened user menu"})}),[l,e]);const r=()=>{return t((e=!l,{type:At.userMenuActive,payload:e}));var e};return Object(s.jsx)(s.Fragment,{children:i&&Object(s.jsxs)("div",{className:Ct()("user-menu",{"is-active":l}),children:[Object(s.jsxs)("div",{className:"user-menu__header",onClick:r,onKeyPress:r,role:"button",tabIndex:"0",children:[Object(s.jsx)("i",{className:"p-icon--user is-light"}),Object(s.jsx)("span",{className:"user-menu__name",children:i?M(i):""}),Object(s.jsx)("i",{className:"p-icon--chevron-up is-light"})]}),Object(s.jsxs)("ul",{className:"p-list user-menu__options",children:[Object(s.jsx)("li",{className:"p-list__item",children:Object(s.jsx)(m.c,{className:"user-menu__link p-list__link",isActive:e=>{if(e&&e.url.includes("settings"))return!0},to:"/settings",activeClassName:"is-selected",children:"Settings"})}),Object(s.jsx)("li",{className:"p-list__item",children:Object(s.jsx)(m.b,{className:"user-menu__link",to:"/",onClick:()=>t(lt(n)),children:"Log out"})})]})]})})};n(434);const $t=[{label:"Models",path:"/models",icon:"models"},{label:"Controllers",path:"/controllers",icon:"controllers"}];var Tt=()=>{const{blocked:e}=Object(o.c)(je),t=Object(o.c)(z);return Object(s.jsxs)("nav",{className:"p-primary-nav",children:[Object(s.jsx)("div",{className:"p-primary-nav__header",children:Object(s.jsx)(wt,{})}),Object(s.jsx)("ul",{className:"p-list is-internal",children:$t.map((t=>Object(s.jsx)("li",{className:"p-list__item",children:Object(s.jsxs)(m.c,{className:"p-list__link",isActive:e=>{if(e&&e.url.includes(t.path))return!0},to:t.path,activeClassName:"is-selected",children:[Object(s.jsx)("i",{className:`p-icon--${t.icon} is-light`}),t.label,"Models"===t.label&&e>0?Object(s.jsx)("span",{className:"entity-count",children:e}):""]})},t.path)))}),Object(s.jsx)("hr",{className:"p-primary-nav__divider"}),Object(s.jsx)("div",{className:"p-primary-nav__bottom",children:Object(s.jsx)("ul",{className:"p-list",children:Object(s.jsx)("li",{className:"p-list__item",children:Object(s.jsx)("a",{className:"p-list__link",href:"https://github.com/canonical-web-and-design/jaas-dashboard/issues/new",target:"_blank",rel:"noopener noreferrer",children:"Report a bug"})})})}),Object(s.jsx)("hr",{className:"p-primary-nav__divider"}),Object(s.jsx)("div",{className:"p-primary-nav__bottom",children:Object(s.jsx)("ul",{className:"p-list",children:Object(s.jsxs)("li",{className:"p-list__item",children:[Object(s.jsxs)("span",{className:"version",children:["Version ",t]}),Object(s.jsx)("span",{className:"p-label--new",children:"Beta"})]})})}),Object(s.jsx)(Mt,{})]})};function Ut(e,t,n=window){const s=Object(a.useRef)();Object(a.useEffect)((()=>{s.current=t}),[t]),Object(a.useEffect)((()=>{if(!(n&&n.addEventListener))return;const t=e=>s.current(e);return n.addEventListener(e,t),()=>{n.removeEventListener(e,t)}}),[e,n])}var Dt=n(71),Ft=n.n(Dt);function Vt({isActive:e=!0,children:t,className:n}){return Object(s.jsx)(s.Fragment,{children:e&&Object(s.jsx)(bt.a.div,{className:n,initial:{x:"100%"},animate:{x:0},exit:{x:"100%"},transition:{type:"tween"},children:t})})}var Kt=n(58),Pt=n.n(Kt);n(435);function Ht({children:e,width:t,pinned:n=!1,loading:a=!1,isSplit:c=!1}){return Object(s.jsx)(Vt,{isActive:!0,className:Ct()("l-aside",{"is-narrow":"narrow"===t,"is-wide":"wide"===t,"is-pinned":!0===n,"is-split":!0===c}),children:a?Object(s.jsx)("div",{className:"loading",children:Object(s.jsx)(Pt.a,{})}):e})}var Bt=n(141);n(436);function Wt({children:e,buttonRow:t}){const n=Object(a.useRef)(null),i=document.querySelector("#confirmation-modal-container")||document.body;return Object(a.useEffect)((()=>{if(n.current){var e;const t=null===n||void 0===n||null===(e=n.current)||void 0===e?void 0:e.querySelector("button.p-button--neutral");t?t.focus():n.current.focus()}}),[]),Object(c.createPortal)(Object(s.jsx)("div",{className:"p-confirmation-modal",ref:n,children:Object(s.jsx)(Bt.Modal,{buttonRow:t,children:Object(s.jsx)("div",{children:e})})}),i)}function Jt({title:e}){const[t,n]=Object(h.e)({panel:h.c,model:h.c}),a={};return Object.keys(t).forEach((e=>{a[e]=void 0})),Object(s.jsxs)("div",{className:"p-panel__header",children:[Object(s.jsx)("div",{className:"p-panel__title",children:e}),Object(s.jsx)("div",{className:"p-panel__controls",children:Object(s.jsx)("button",{onClick:()=>n(a),className:"p-button--base js-aside-close u-no-margin--bottom has-icon",children:Object(s.jsx)("i",{className:"p-icon--close"})})})]})}n(437);function qt({hasData:e,noDataMessage:t,loading:n,children:a}){return Object(s.jsx)("div",{className:"loading-handler",children:e?a:n?Object(s.jsx)("div",{className:"loading-handler__spinner",children:Object(s.jsx)("div",{className:"loading-handler__spinner-content",children:Object(s.jsx)(Pt.a,{})})}):t})}n(438);function Gt({name:e,children:t,description:n,selectedInput:c,onSelect:i}){const[o,l]=Object(a.useState)(!1),r=Object(a.useRef)(null),d=Object(a.useRef)(null);Object(a.useEffect)((()=>{null!==r.current&&(r.current.style.height="40px")}),[r]),Object(a.useEffect)((()=>{l(c===e)}),[c,e]),Object(a.useEffect)((()=>{const e=r.current,t=d.current;if(null===e||null===t)return;let n=0,s=0,a=0;o?(n=e.offsetHeight,s=t.offsetHeight+20,a=s,e.style.height=s+"px"):40!==e.offsetHeight&&(s=40,n=t.offsetHeight+20,a=n);e.animate({height:[n+"px",s+"px"]},{duration:a,easing:"ease-out"}).onfinish=()=>{e.style.height=!1===o?"40px":""}}),[o,40]);const u=()=>{i(e),l(!0)},j=`inputRadio-${e}`;return Object(s.jsx)("div",{className:"radio-input-box","aria-expanded":o,ref:r,children:Object(s.jsxs)("div",{className:"radio-input-box__container",ref:d,children:[Object(s.jsxs)("label",{className:"p-radio radio-input-box__label",children:[Object(s.jsx)("input",{type:"radio",className:"p-radio__input",name:"inputRadioSelector","aria-labelledby":j,onClick:u,onChange:u}),Object(s.jsx)("span",{className:"p-radio__label",id:j,children:e})]}),Object(s.jsxs)("div",{className:"radio-input-box__content",children:[Object(s.jsx)("div",{className:"radio-input-box__description",children:n}),Object(s.jsx)("div",{className:"radio-input-box__options",children:t})]})]})})}var Yt=n(17);function zt({description:e}){return e.length>30?Object(s.jsxs)("details",{className:"radio-input-box__details",children:[Object(s.jsxs)("summary",{className:"radio-input-box__summary",children:[Object(s.jsx)("span",{className:"radio-input-box__summary-description",children:e}),"\xa0"]}),Object(s.jsx)("span",{className:"radio-input-box__details-description",children:e})]}):Object(s.jsx)("span",{children:e})}function Xt({name:e,options:t,onValuesChange:n}){const{values:c}=Object(Yt.d)();return Object(a.useEffect)((()=>{n(e,c)}),[n,e,c]),Object(s.jsx)("form",{children:t.map((t=>{const n=`${e}-${t.name}`;return Object(s.jsxs)("div",{className:"radio-input-box__input-group",children:[Object(s.jsx)("label",{className:Ct()("radio-input-box__label",{"is-required":t.required}),htmlFor:n,children:t.name}),Object(s.jsx)(Yt.a,{className:"radio-input-box__input",type:"text",id:n,name:n}),Object(s.jsx)(zt,{description:t.description})]},`${t.name}InputGroup`)}))})}function Qt({name:e,data:t,onValuesChange:n}){const c=t[e],i=Object(a.useMemo)((()=>{const e=[];return Object.keys(c.params.properties).forEach((t=>{const n=c.params.properties[t],s=c.params.required;e.push({name:t,description:n.description,type:n.type,required:!!s&&s.includes(t)})})),e}),[c.params.properties,c.params.required]),o=Object(a.useMemo)((()=>{const t={};return i.forEach((n=>{t[`${e}-${n.name}`]=""})),t}),[e,i]);return Object(s.jsx)(Yt.c,{initialValues:o,onSubmit:()=>{},children:Object(s.jsx)(Xt,{name:e,options:i,onValuesChange:n})},e)}n(439);function Zt(){var e,t,n,c,i;const l=Object(o.d)(),r=l.getState(),{appName:d,modelName:u}=Object(p.i)(),j=Object(a.useMemo)((()=>ne(u)),[u]),b=Object(o.c)(j),[m,O]=Object(a.useState)(!0),[f,v]=Object(a.useState)({}),[g,x]=Object(a.useState)(!1),[N,_]=Object(a.useState)(""),[y,w]=Object(a.useState)(),k=Object(a.useRef)({}),C=Object(h.d)("units",Object(h.f)(h.a,[]))[0],E=Object(h.d)("panel")[1];Object(a.useEffect)((()=>{x(!0),async function(e,t,n){const s=await Ge(t,n);return await s.facades.action.applicationsCharmsActions({entities:[{tag:`application-${e}`}]})}(d,b,l.getState()).then((e=>{var t,n;(null===e||void 0===e||null===(t=e.results)||void 0===t||null===(n=t[0])||void 0===n?void 0:n.actions)&&v(e.results[0].actions),x(!1)}))}),[d,l,b]);const S=null===(e=r.juju)||void 0===e||null===(t=e.modelData)||void 0===t||null===(n=t[b])||void 0===n||null===(c=n.applications)||void 0===c||null===(i=c[d])||void 0===i?void 0:i.charm,A=async()=>{y&&await async function(e=[],t,n,s,a){const c=e.map((e=>({name:t,receiver:`unit-${e.replace("/","-")}`,parameters:n}))),i=await Ge(s,a);return await i.facades.action.enqueueOperation({actions:c})}(C,y,k.current[y],b,l.getState())},R=Object(a.useCallback)(((e,t)=>{!function(e,t,n){const s={};Object.keys(t).forEach((n=>{s[n.replace(`${e}-`,"")]=t[n]})),n.current={...n.current,[e]:s}}(e,t,k),en(y,C,f,k,O)}),[f,y,C]),I=Object(a.useCallback)((e=>{w(e),en(e,C,f,k,O)}),[f,C]),L=Object.keys(f).length>0?f:null;return Object(s.jsx)(Ht,{width:"narrow",children:Object(s.jsxs)("div",{className:"p-panel actions-panel",children:[Object(s.jsx)(Jt,{title:(()=>{const e=C.length;return Object(s.jsxs)("h5",{children:[K(d,S)," ",e," ",$(e,"unit")," selected"]})})()}),Object(s.jsxs)("div",{className:"actions-panel__unit-list","data-test":"actions-panel-unit-list",children:["Run action on: ",C.length?C.reduce(((e,t)=>`${e}, ${t.split("/")[1]}`)):"0 units selected"]}),Object(s.jsx)("div",{className:"actions-panel__action-list",children:Object(s.jsx)(qt,{hasData:!!L,loading:g,noDataMessage:"This charm has not provided any actions.",children:Object.keys(f).map((e=>Object(s.jsx)(Gt,{name:e,description:f[e].description,onSelect:I,selectedInput:y,children:Object(s.jsx)(Qt,{name:e,data:f,onValuesChange:R})},e)))})}),(()=>{if(N&&y&&"submit"===N)return function(e,t,n,a,c){const i=n.reduce(((e,t)=>`${e}, ${t.split("/")[1]}`));return Object(s.jsx)(Wt,{buttonRow:Object(s.jsxs)("div",{children:[Object(s.jsx)(Ft.a,{onClick:c,children:"Cancel"},"cancel"),Object(s.jsx)(Ft.a,{appearance:"positive",onClick:a,children:"Confirm"},"save")]}),children:Object(s.jsxs)("div",{children:[Object(s.jsxs)("h4",{children:["Run ",e,"?"]}),Object(s.jsxs)("div",{className:"p-confirmation-modal__info-group",children:[Object(s.jsx)("div",{className:"p-confirmation-modal__sub-header",children:"UNIT COUNT"}),Object(s.jsx)("div",{"data-test":"confirmation-modal-unit-count",children:t})]}),Object(s.jsxs)("div",{className:"p-confirmation-modal__info-group",children:[Object(s.jsx)("div",{className:"p-confirmation-modal__sub-header",children:"UNIT NAME"}),Object(s.jsx)("div",{"data-test":"confirmation-modal-unit-names",children:i})]})]})})}(y,C.length,C,(()=>{_(""),A(),E("")}),(()=>_("")))})(),Object(s.jsx)("div",{className:"actions-panel__drawer",children:Object(s.jsx)(Ft.a,{appearance:"positive",className:"actions-panel__run-action",disabled:m,onClick:()=>{_("submit")},children:"Run action"})})]})})}function en(e,t,n,s,a){if(e&&t.length>0){if(tn(e,s.current))return void a(!1);if(nn(e,n,s.current)&&sn(e,s.current))return void a(!1)}a(!0)}const tn=(e,t)=>!t[e]||0===Object.keys(t[e]).length,nn=(e,t,n)=>{const s=t[e].params.required;return!s||(0===s.length||!s.some((t=>""===n[e][t])))},sn=(e,t)=>!0;var an=function(e,t){const[n,s]=Object(a.useState)((()=>{try{const n=window.localStorage.getItem(e);return n?JSON.parse(n):t}catch(n){return console.error("Unable to parse local storage:",n),t}}));return[n,t=>{try{const a=t instanceof Function?t(n):t;s(a),window.localStorage.setItem(e,JSON.stringify(a))}catch(a){console.log(a)}}]};n(440);function cn(){const[e,t]=Object(a.useState)({}),n=Object(o.b)(),c=Object(o.d)(),i=Object(o.c)(J),[l,r]=an("additionalControllers",[]),d=Object(p.g)();function u(n){const s={...e};s[n.target.name]="checkbox"===n.target.type?n.target.checked:n.target.value,t(s)}return Object(s.jsx)(Ht,{children:Object(s.jsxs)("div",{className:"p-panel register-controller",children:[Object(s.jsx)(Jt,{title:Object(s.jsx)("h4",{children:"Register a controller"})}),Object(s.jsxs)("div",{className:"p-panel__content",children:[Object(s.jsxs)("p",{className:"p-form-help-text",children:["Information can be retrieved using the"," ",Object(s.jsx)("code",{children:"juju show-controller"})," command."]}),Object(s.jsxs)("form",{className:"p-form p-form--stacked",onSubmit:function(t){t.preventDefault(),l.push([`wss://${e.wsControllerHost}/api`,{user:e.username,password:e.password},null,e.identityProviderAvailable,!0]),r(l),n(rt(c,i)),d.push("/controllers")},children:[Object(s.jsxs)("div",{className:"p-form__group row",children:[Object(s.jsx)("div",{className:"col-2",children:Object(s.jsx)("label",{htmlFor:"controller-name",className:"p-form__label is-required",children:"Name"})}),Object(s.jsx)("div",{className:"col-10",children:Object(s.jsxs)("div",{className:"p-form__control",children:[Object(s.jsx)("input",{type:"text",id:"controller-name",name:"controllerName",onChange:u,required:!0}),Object(s.jsxs)("p",{className:"p-form-help-text",children:["Must be a valid alpha-numeric Juju controller name. ",Object(s.jsx)("br",{}),"e.g. production-controller-aws"]})]})})]}),Object(s.jsxs)("div",{className:"p-form__group row",children:[Object(s.jsx)("div",{className:"col-2",children:Object(s.jsx)("label",{htmlFor:"host",className:"p-form__label is-required",children:"Host"})}),Object(s.jsx)("div",{className:"col-10",children:Object(s.jsxs)("div",{className:"p-form__control",children:[Object(s.jsx)("input",{type:"text",id:"host",name:"wsControllerHost",onChange:u,required:!0}),Object(s.jsxs)("p",{className:"p-form-help-text",children:["You'll typically want to use the public IP:Port address for the controller. ",Object(s.jsx)("br",{}),"e.g. 91.189.88.181:17070"]})]})})]}),Object(s.jsxs)("div",{className:"p-form__group row",children:[Object(s.jsx)("div",{className:"col-2",children:Object(s.jsx)("label",{htmlFor:"username",className:"p-form__label",children:"Username"})}),Object(s.jsx)("div",{className:"col-10",children:Object(s.jsxs)("div",{className:"p-form__control",children:[Object(s.jsx)("input",{type:"text",id:"username",name:"username",onChange:u}),Object(s.jsx)("p",{className:"p-form-help-text",children:"The username you use to access the controller."})]})})]}),Object(s.jsxs)("div",{className:"p-form__group row",children:[Object(s.jsx)("div",{className:"col-2",children:Object(s.jsx)("label",{htmlFor:"password",className:"p-form__label",children:"Password"})}),Object(s.jsx)("div",{className:"col-10",children:Object(s.jsxs)("div",{className:"p-form__control",children:[Object(s.jsx)("input",{type:"password",id:"password",name:"password",onChange:u}),Object(s.jsxs)("p",{className:"p-form-help-text",children:["The password will be what you used when running"," ",Object(s.jsx)("code",{children:"juju register"})," or if unchanged from the default it can be retrieved by running ",Object(s.jsx)("code",{children:"juju dashboard"}),"."]})]})})]}),Object(s.jsx)("div",{className:Ct()("p-form__group row",{"u-hide":e.username&&e.password}),children:Object(s.jsxs)("div",{className:"col-10 col-start-large-3",children:[Object(s.jsx)("input",{type:"checkbox",id:"identityProviderAvailable",name:"identityProvider",defaultChecked:!1,onChange:u}),Object(s.jsxs)("label",{htmlFor:"identityProviderAvailable",children:["An identity provider is available."," "]}),Object(s.jsx)("div",{className:"p-form-help-text identity-provider",children:"If you provided a username and password this should be left unchecked."})]})}),Object(s.jsx)("div",{className:"p-form__group row",children:Object(s.jsxs)("div",{className:"col-10 col-start-large-3",children:[Object(s.jsx)("i",{className:"p-icon--warning"}),Object(s.jsxs)("div",{className:"controller-link-message",children:["Visit"," ",function(e){if(!e)return"the controller";const t=`https://${e}/dashboard`;return Object(s.jsx)("a",{href:t,target:"_blank",rel:"noopener noreferrer",children:"the controller"})}(null===e||void 0===e?void 0:e.wsControllerHost)," to accept the certificate on this controller to enable a secure connection"]})]})}),Object(s.jsx)("div",{className:"p-form__group row",children:Object(s.jsxs)("div",{className:"col-10 col-start-large-3",children:[Object(s.jsx)("input",{type:"checkbox",id:"certificateHasBeenAccepted",name:"certificateAccepted",defaultChecked:!1,onChange:u,required:!0}),Object(s.jsxs)("label",{htmlFor:"certificateHasBeenAccepted",children:["The SSL certificate, if any, has been accepted."," ",Object(s.jsx)("span",{className:"required-star",children:"*"})]})]})}),Object(s.jsx)("hr",{}),Object(s.jsxs)("div",{className:"row register-a-controller__submit-segment",children:[Object(s.jsx)("div",{className:"col-9",children:Object(s.jsx)("p",{className:"p-form-help-text",children:"The credentials are stored locally in your browser and can be cleared on log-out."})}),Object(s.jsx)("div",{className:"col-3",children:Object(s.jsx)("button",{className:"p-button--positive",type:"submit",disabled:!e.certificateAccepted,children:"Add Controller"})})]})]})]})]})})}function on(){let{modelName:e}=Object(p.i)();const t=Object(h.e)({model:h.c});e||(e=t[0].model);const n=Object(a.useMemo)((()=>ne(e)),[e]),s=Object(o.c)(n),c=Object(a.useMemo)((()=>oe(s)),[s]);return Object(o.c)(c)}function ln({children:e,className:t,isAnimating:n}){return Object(s.jsx)(jt.a,{children:Object(s.jsx)(bt.a.div,{initial:{opacity:1,y:0},animate:n&&{opacity:0,y:50},className:t,children:e})})}n(441);function rn({userName:e,lastConnected:t,access:n,isOwner:c,removeUser:i,accessSelectChange:o}){const[l,r]=Object(a.useState)(!1),[d,u]=Object(a.useState)(!1),[j,b]=Object(a.useState)(!0),[m,p]=Object(a.useState)(null);Object(a.useEffect)((()=>{const e=setTimeout((()=>{b(!1)}),3e3);return()=>{clearTimeout(e)}}),[j]);return Object(s.jsx)("div",{children:Object(s.jsx)(ln,{isAnimating:d,children:Object(s.jsxs)("div",{className:"share-card","data-active":l,children:[Object(s.jsxs)("div",{className:"share-card__title",children:[Object(s.jsx)("strong",{className:"share-card__username",children:e}),Object(s.jsx)("span",{className:"share-card__secondary",children:c?"Owner":Object(s.jsx)("i",{className:"p-icon--delete",onClick:()=>{i(e),u(!0)},onKeyPress:()=>i(e),role:"button",tabIndex:0,children:"Remove user"})})]}),Object(s.jsxs)("div",{className:"share-card__supplementary",children:["Last connected:"," ",t?(h=t,Object(N.a)(Object(_.a)(h)).concat(" ago")):"Never",Object(s.jsx)("div",{className:"share-card__access-wrapper",children:!c&&Object(s.jsxs)(s.Fragment,{children:[Object(s.jsx)(Yt.c,{initialValues:{},onSubmit:()=>{},children:Object(s.jsx)(Yt.b,{children:Object(s.jsxs)(Yt.a,{as:"select",name:"access",onFocus:()=>r(!0),onBlur:()=>r(!1),onChange:t=>{b(!0),p("Updating");const n=o(t,e);n&&n.then((e=>{var t;(null===e||void 0===e||null===(t=e.results[0])||void 0===t?void 0:t.error)?p("Error"):(r(!1),p("Updated"))}))},value:n,className:"share__card-access",children:[Object(s.jsx)("option",{value:"read",children:"read"}),Object(s.jsx)("option",{value:"write",children:"write"}),Object(s.jsx)("option",{value:"admin",children:"admin"})]})})}),Object(s.jsx)("div",{className:"share-card__status","data-visible":j,children:Object(s.jsxs)("div",{className:"share-card__status-wrap "+("updating"===m?"is-spinner":""),children:[Object(s.jsx)("span",{className:"share-card__status-text",children:m})," ",Object(s.jsx)("i",{className:(e=>{let t="";switch(e){case"Updating":t="p-icon--spinner u-animation--spin";break;case"Updated":t="p-icon--success";break;case"Error":t="p-icon--error"}return t})(m)})]})})]})})]})]})})});var h}n(442);function dn({toastInstance:e,type:t,text:n,undo:a}){let c;switch(t){case"positive":c="success";break;case"caution":c="warning";break;case"negative":c="error"}const i=e=>{xt.b.remove(e)};return Object(s.jsxs)("div",{className:"toast-card","data-type":t,role:"status","aria-live":"polite",children:[Object(s.jsxs)("div",{className:"toast-card__body",children:[c&&Object(s.jsx)("i",{className:`p-icon--${c}`,children:"Success"}),Object(s.jsx)("div",{className:"toast-card__message",dangerouslySetInnerHTML:{__html:n}}),Object(s.jsx)("i",{className:"p-icon--close",onClick:()=>i(e.id),onKeyPress:()=>i(e.id),role:"button",tabIndex:0,children:"Close"})]}),a&&Object(s.jsx)("footer",{className:"toast-card__undo",children:Object(s.jsx)("button",{onClick:()=>{a(),i(e.id)},className:"p-button--base",children:"Undo"})})]})}n(443);function un(){var e,t;const n=Object(o.b)(),c=Object(o.d)(),[i,l]=Object(a.useState)({}),[r,d]=Object(a.useState)(!1),[u,j]=Object(a.useState)(!1),b=on()||null,m=null===b||void 0===b||null===(e=b.info)||void 0===e?void 0:e["controller-uuid"],p=null===b||void 0===b?void 0:b.info.uuid,h=null===b||void 0===b?void 0:b.info.name,O=(e=>Object(v.a)(W,(t=>{if(!t)return null;let n=null;Object.entries(t).some((t=>{const s=t[1].find((t=>e===t.uuid));return!!s&&(n=s,!0)}));const s=x()(n);return s&&(s.url=Object.keys(t)[0]),s})))(m),f=Object(o.c)(O),g=null===f||void 0===f?void 0:f.url,N=null===b||void 0===b||null===(t=b.info)||void 0===t?void 0:t.users;Object(a.useEffect)((()=>{const e=x()(i);null===N||void 0===N||N.forEach((t=>{const n=t.user;e&&(e[n]=null===t||void 0===t?void 0:t.access,l(e))}))}),[N]);const _=e=>e===(null===b||void 0===b?void 0:b.info["owner-tag"].replace("user-","")),y=async(e,t,a,i)=>{const o=await async function(e,t,n,s,a,c,i,o){const l=await ae(e,n()),r=async(e,n)=>await l.facades.modelManager.modifyModelAccess({changes:[{access:e,action:n,"model-tag":`model-${t}`,"user-tag":`user-${s}`}]});let d=Promise.resolve({results:[{}]});if(l){c&&(d=await r(c,"revoke")),"grant"===i&&(d=await r(a,"grant"));const n=await Je(l,t);n&&o(Fe(n),{wsControllerURL:e})}else d=Promise.resolve({results:[{error:!0}]});return d}(g,p,c.getState,t,a,i,e,n);return(null===o||void 0===o?void 0:o.error)?(xt.b.custom((e=>Object(s.jsx)(dn,{toastInstance:e,type:"negative",text:o.error}))),!1):o},w=async(e,t)=>{var n,a;const c=e.target.value,o=x()(i);o&&(o[t]=c),l(o);const r=null===i||void 0===i?void 0:i[t],d=await y("grant",t,c,r),u=null===d||void 0===d||null===(n=d.results[0])||void 0===n||null===(a=n.error)||void 0===a?void 0:a.message;return u?xt.b.custom((e=>Object(s.jsx)(dn,{toastInstance:e,type:"negative",text:u}))):xt.b.custom((e=>Object(s.jsx)(dn,{toastInstance:e,type:"positive",text:`Permissions for <strong>${t}</strong> have been changed to <em>${c}.</em>`}))),d},k=async e=>{await y("revoke",e,void 0,null===i||void 0===i?void 0:i[e]),xt.b.custom((t=>Object(s.jsx)(dn,{toastInstance:t,type:"positive",text:`<strong>${e}</strong> has been successfully removed.`,undo:async()=>{const t=null===i||void 0===i?void 0:i[e];await y("grant",e,t,undefined)}})))},C=x()(N||null);return null===C||void 0===C||C.some(((e,t)=>_(e.user)&&C.unshift(C.splice(t,1)[0]))),Object(s.jsx)(Ht,{loading:!b,isSplit:!0,children:Object(s.jsxs)(bt.a.div,{layout:!0,className:"p-panel share-model",children:[Object(s.jsx)(Jt,{title:Object(s.jsx)("div",{className:"title-wrapper",children:u?Object(s.jsx)(s.Fragment,{children:Object(s.jsxs)("button",{className:"p-button--base has-icon",onClick:()=>j(!1),children:[Object(s.jsx)("i",{className:"p-icon--chevron-up"}),Object(s.jsx)("span",{children:"Back"})]})}):Object(s.jsxs)("div",{className:"title-wrapper__heading",children:[Object(s.jsxs)("h5",{children:[Object(s.jsx)("i",{className:"p-icon--share is-inline"})," Model access:"," ",h]})," "]})})}),Object(s.jsxs)("div",{className:"p-panel__content aside-split-wrapper","data-mobile-show-add-user":u,children:[Object(s.jsxs)("div",{className:"aside-split-col share-cards",children:[Object(s.jsxs)("div",{className:"share-cards__heading",children:[Object(s.jsx)("h5",{children:"Sharing with:"}),Object(s.jsxs)("button",{className:"add-user-btn p-button--base has-icon",onClick:()=>j(!0),children:[Object(s.jsx)("i",{className:"p-icon--plus"}),Object(s.jsx)("span",{children:"Add new user"})]})]}),null===C||void 0===C?void 0:C.map((e=>{const t=e.user,n=e["last-connection"];return Object(s.jsx)(rn,{userName:t,lastConnected:n,access:null===i||void 0===i?void 0:i[t],isOwner:_(t),removeUser:k,accessSelectChange:w},t)}))]}),Object(s.jsxs)("div",{className:"aside-split-col add-new-user",children:[Object(s.jsx)("h5",{children:"Add new user"}),Object(s.jsx)(Yt.c,{initialValues:{name:"",access:"read"},validate:e=>(e=>{d(""!==e.username&&null!==e.accessLevel)})(e),onSubmit:(e,{resetForm:t})=>{(async(e,t)=>{if(((e,t)=>t.some((t=>t.user===e)))(e.name,N))xt.b.custom((t=>Object(s.jsx)(dn,{toastInstance:t,type:"negative",text:`<strong>${e.name}</strong> already has access to this model.`})));else{var n,a,c;const i=e.name,o=e.access;let l=null;i&&o&&(l=await y("grant",i,o,void 0));const r=null===(n=l)||void 0===n||null===(a=n.results[0])||void 0===a||null===(c=a.error)||void 0===c?void 0:c.message;r?xt.b.custom((e=>Object(s.jsx)(dn,{toastInstance:e,type:"negative",text:r}))):(t(),xt.b.custom((t=>Object(s.jsx)(dn,{toastInstance:t,type:"positive",text:`<strong>${e.name}</strong> now has access to this model.`}))))}})(e,t),j(!1)},children:Object(s.jsxs)(Yt.b,{children:[Object(s.jsx)("label",{className:"is-required",htmlFor:"username",children:"Username"}),Object(s.jsx)(Yt.a,{required:!0,type:"text",placeholder:"Username",name:"name"}),Object(s.jsx)("label",{className:"is-required",htmlFor:" ",children:"Access level"}),Object(s.jsx)("div",{className:"p-radio",children:Object(s.jsxs)("label",{htmlFor:"accessRead",children:[Object(s.jsx)(Yt.a,{id:"accessRead",type:"radio",className:"p-radio__input",name:"access","aria-labelledby":"Read",value:"read"}),Object(s.jsxs)("span",{className:"p-radio__label",id:"accessLevel1",children:["read",Object(s.jsx)("span",{className:"help-text",children:"A user can view the state of the model"})]})]})}),Object(s.jsx)("div",{className:"p-radio",children:Object(s.jsxs)("label",{htmlFor:"accessWrite",children:[Object(s.jsx)(Yt.a,{id:"accessWrite",type:"radio",className:"p-radio__input",name:"access","aria-labelledby":"Write",value:"write"}),Object(s.jsxs)("span",{className:"p-radio__label",id:"accessLevel2",children:["write",Object(s.jsx)("span",{className:"help-text",children:"In addition to 'read' abilities, a user can modify/configure models"})]})]})}),Object(s.jsx)("div",{className:"p-radio",children:Object(s.jsxs)("label",{htmlFor:"accessAdmin",children:[Object(s.jsx)(Yt.a,{id:"accessAdmin",type:"radio",className:"p-radio__input",name:"access","aria-labelledby":"Admin",value:"admin"}),Object(s.jsxs)("span",{className:"p-radio__label",id:"accessLevel3",children:["admin",Object(s.jsx)("span",{className:"help-text",children:"In addition to 'write' abilities, a user can perform model upgrades and connect to machines via juju ssh. Makes the user an effective model owner."})]})]})}),Object(s.jsx)("div",{className:"action-wrapper",children:Object(s.jsx)("button",{className:"p-button--positive",type:"submit",disabled:!r,children:"Add user"})})]})})]})]})]})})}n(133);const jn=function(e,t){"Escape"===e.code&&t(void 0)};function bn(){const[e,t]=Object(h.d)("panel",h.c);Ut("keydown",(e=>jn(e,t)));return Object(s.jsx)(jt.a,{children:e&&(()=>{switch(e){case"register-controller":return Object(s.jsx)(cn,{});case"execute-action":return Object(s.jsx)(Zt,{});case"share-model":return Object(s.jsx)(un,{});default:return null}})()})}n(444);var mn=({children:e})=>{const[t,n]=Object(a.useState)(!0),c=Object(p.h)(),i=Object(o.b)(),{modelName:l}=Object(p.i)(),r=Object(o.c)(Lt)||!1;Object(a.useEffect)((()=>(i(Rt(!!l)),()=>{i(Rt(!1))})),[l,i]);const d=function(){const[e,t]=Object(a.useState)(null);return Object(a.useEffect)((()=>{const e=window.addEventListener("offline",(function(){t(!0)}),!1),n=window.addEventListener("online",(function(){t(!1)}),!1);return()=>{window.removeEventListener("offline",e),window.removeEventListener("online",n)}}),[]),e}();return Object(s.jsxs)(s.Fragment,{children:[Object(s.jsx)("a",{className:"skip-main",href:"#main-content",children:"Skip to main content"}),Object(s.jsx)(Et,{isActive:null!==d,variant:!1===d?"positive":"caution",children:d?Object(s.jsx)("p",{children:"Your dashboard is offline."}):Object(s.jsxs)("p",{children:["Your dashboard is now back online - please"," ",Object(s.jsx)("a",{href:c.pathname,children:"refresh your browser."})]})}),Object(s.jsx)("div",{id:"confirmation-modal-container"}),Object(s.jsxs)("div",{className:"l-application",children:[Object(s.jsxs)("div",{className:"l-navigation-bar",children:[Object(s.jsx)(wt,{}),Object(s.jsx)("button",{className:"is-dense toggle-menu",onClick:()=>{n(!t)},children:t?"Open menu":"Close menu"})]}),Object(s.jsx)("header",{className:"l-navigation","data-collapsed":t,"data-sidenav-initially-collapsed":r,children:Object(s.jsx)("div",{className:"l-navigation__drawer",children:Object(s.jsx)(Tt,{})})}),Object(s.jsx)("main",{className:"l-main",id:"main-content",children:Object(s.jsx)("div",{"data-test":"main-children",children:e})}),Object(s.jsx)(bn,{}),Object(s.jsx)(xt.a,{position:"bottom-right",containerClassName:"toast-container",toastOptions:{duration:5e3},reverseOrder:!0})]})]})};n(445);var pn=({children:e})=>Object(s.jsx)("div",{className:"header",children:e}),hn=n(105),On=n.n(hn);function fn({children:e,className:t,isActive:n=!0}){return Object(s.jsx)(s.Fragment,{children:n&&Object(s.jsx)(jt.a,{children:Object(s.jsx)(bt.a.div,{initial:{opacity:0},animate:{opacity:1},className:t,children:e})})})}function vn(e){const t=e?`${e} | `:"";Object(a.useEffect)((()=>{document.title=`${t}Juju Dashboard`}),[t])}var gn=n(53);var xn=({chartData:e})=>{const t=Object(a.useRef)(),n=((null===e||void 0===e?void 0:e.blocked)||0)+((null===e||void 0===e?void 0:e.alert)||0)+((null===e||void 0===e?void 0:e.running)||0)===0;return Object(a.useEffect)((()=>{const s=Math.min(100,100)/2,a=gn.d(t.current).attr("width",100).attr("height",100).append("g").attr("transform","translate(50,50) scale(0.49,0.49)"),c=n?{disabled:1}:e,i=gn.c().domain(Object.keys(c)).range(n?["is-disabled"]:["is-blocked","is-alert","is-running"]),o=gn.b().value((e=>e[1]))(Object.entries(c));return a.selectAll("g").data(o).enter().append("path").attr("d",gn.a().innerRadius(100).outerRadius(s)).attr("class",(e=>i(e.data[0]))),()=>{a.remove()}}),[e,n]),Object(s.jsx)("svg",{ref:t})};n(455);function Nn(e,t){if(0===e||0===t)return 0;const n=Math.trunc(e/t);return Number.isNaN(n)?0:n}function _n({chartData:e,totalLabel:t}){const n=(e.blocked||0)+(e.alert||0)+(e.running||0);return Object(s.jsxs)("div",{className:"p-chart",children:[Object(s.jsx)("div",{className:"p-chart__chart",children:Object(s.jsx)(xn,{chartData:e})}),Object(s.jsx)("div",{className:"p-chart__legend",children:Object(s.jsxs)("ul",{className:"p-list p-legend",children:[Object(s.jsx)("li",{className:"p-list__item p-legend__item label","data-test":"legend-label",children:Object(s.jsxs)("strong",{"data-test":"total-count",children:[n," ",$(n,t)]})}),Object(s.jsxs)("li",{className:"p-list__item p-legend__item is-blocked","data-test":"legend-blocked",children:["Blocked: ",Nn(n,e.blocked),"%,"," ",e.blocked||0]}),Object(s.jsxs)("li",{className:"p-list__item p-legend__item is-alert","data-test":"legend-alert",children:["Alerts: ",Nn(n,e.alert),"%,"," ",e.alert||0]}),Object(s.jsxs)("li",{className:"p-list__item p-legend__item is-running","data-test":"legend-running",children:["Running: ",Nn(n,e.running),"%,"," ",e.running||0]})]})})]})}n(456);function yn(){const e=Object(o.c)(re),t=Object(o.c)(ue),n=Object(o.c)(de);let a={blocked:e.blocked.length,alert:e.alert.length,running:e.running.length},c={blocked:t.blocked.length,alert:t.alert.length,running:t.running.length},i={blocked:n.blocked.length,alert:n.alert.length,running:n.running.length};return Object(s.jsx)("div",{className:"p-strip is-shallow controllers-overview",children:Object(s.jsxs)("div",{className:"controllers-overview__container",children:[Object(s.jsx)("div",{className:"controllers-overview__chart",children:Object(s.jsx)(_n,{chartData:a,totalLabel:"machine"})}),Object(s.jsx)("div",{className:"controllers-overview__chart",children:Object(s.jsx)(_n,{chartData:c,totalLabel:"application"})}),Object(s.jsx)("div",{className:"controllers-overview__chart",children:Object(s.jsx)(_n,{chartData:i,totalLabel:"unit"})})]})})}n(457);function wn(){vn("Controllers");const e=Object(o.c)(W),t=Object(o.c)(B),n={},a=[];if(e&&(Object.entries(e).forEach((e=>{e[1].forEach((t=>{t.additionalController&&a.push(t.uuid),n[t.uuid]={...t,models:0,machines:0,applications:0,units:0,wsControllerURL:e[0]}}))})),t))for(const s in t){const e=t[s];if(e.info){const t=e.info["controller-uuid"];if(n[t]){n[t].models+=1,n[t].machines+=Object.keys(e.machines).length;const s=Object.keys(e.applications);n[t].applications+=s.length;const a=s.reduce(((t,n)=>{const s=e.applications[n].units||{};return t+Object.keys(s).length}),0);n[t].units+=a}}}const c=[{content:"Default",sortKey:"name"},{content:"cloud/region",sortKey:"cloud/region"},{content:"models",sortKey:"models",className:"u-align--right"},{content:"machines",sortKey:"machines",className:"u-align--right"},{content:"applications",sortKey:"applications",className:"u-align--right"},{content:"units",sortKey:"units",className:"u-align--right"},{content:"version",sortKey:"version",className:"u-align--right"},{content:"public",sortKey:"public",className:"u-align--right"}],i=x()(c);function l(e){const t={content:""};return"admin/jaas"===(null===e||void 0===e?void 0:e.path)?t.content="JAAS":(null===e||void 0===e?void 0:e.path)?t.content=e.path:(t.content=null===e||void 0===e?void 0:e.wsControllerURL,t.className="is-disconnected",t.title="disconnected"),t}function r(e){var t,n;const s=`${(null===e||void 0===e||null===(t=e.location)||void 0===t?void 0:t.cloud)||"unknown"}/${(null===e||void 0===e||null===(n=e.location)||void 0===n?void 0:n.region)||"unknown"}`,a=`${null===e||void 0===e?void 0:e.Public}`||"False";return{columns:[l(e),{content:s},{content:e.models,className:"u-align--right"},{content:e.machines,className:"u-align--right"},{content:e.applications,className:"u-align--right"},{content:e.units,className:"u-align--right"},{content:e.version,className:"u-align--right"},{content:a,className:"u-align--right u-capitalise"}]}}i[0].content=Object(s.jsxs)("span",{children:["Registered",Object(s.jsx)("span",{className:"controllers--registered-tooltip p-icon--help",title:"The controller authentication data is only stored in your browser localStorage. If you'd like this to persist across browsers try JAAS"})]});const d=a.map((e=>{const t=r(n[e]);return delete n[e],t})),u=n&&Object.values(n).map(r),j=Object(h.d)("panel",h.c)[1];return Object(s.jsxs)(s.Fragment,{children:[Object(s.jsxs)("div",{className:"controllers--header",children:[Object(s.jsx)("div",{className:"controllers__heading",children:"Model status across controllers"}),Object(s.jsx)("div",{className:"controllers--register",children:Object(s.jsx)("button",{className:"p-button--positive",onClick:()=>j("register-controller"),children:"Register a controller"})})]}),Object(s.jsx)(yn,{}),Object(s.jsxs)("div",{className:"l-controllers-table u-overflow--scroll",children:[u.length>0&&Object(s.jsx)(On.a,{headers:c,rows:u}),d.length>0&&Object(s.jsx)(On.a,{headers:i,rows:d})]})]})}function kn(){const e=Object(o.c)(W);let t=0;e&&(t=Object.keys(e).length);const n=Object(o.c)(B);let a=0;return n&&(a=Object.keys(n).length),Object(s.jsxs)(mn,{children:[Object(s.jsx)(pn,{children:Object(s.jsx)("div",{className:"entity-details__header",children:Object(s.jsxs)("strong",{className:"controllers--count",children:[t," controllers,"," ",Object(s.jsxs)(m.b,{to:"/models",children:[a," models"]})]})})}),Object(s.jsx)("div",{className:"l-content controllers",children:Object(s.jsx)(fn,{isActive:!0,children:Object(s.jsx)(wn,{})})})]})}var Cn=n(13),En=n.n(Cn);function Sn(){var e;const t=Object(o.d)().getState;return null===(e=ie(Object(o.c)(be),t()))||void 0===e?void 0:e.replace("user-","")}var An=n.p+"static/media/aws.80fb338e.svg",Rn=n.p+"static/media/azure.394f88bf.svg",In=n.p+"static/media/gce.cf230f61.svg",Ln=n.p+"static/media/kubernetes.f5c2ef9a.svg";function Mn(e,t,n){if(!t)return n;const a=`/models/${t.replace("user-","")}/${e}`;return Object(s.jsx)(m.b,{to:a,children:n})}function $n(e,t){var n;let a="";if("object"===typeof e&&null!==e)switch(t){case"summary":const c=Object.keys(e.applications),i=c.length,o=Object.keys(e.machines).length,l=c.reduce(((t,n)=>{const s=e.applications[n].units||{};return t+Object.keys(s).length}),0);a=Object(s.jsx)(s.Fragment,{children:Object(s.jsxs)("div",{className:"u-flex",children:[Object(s.jsxs)("div",{className:"u-flex--block p-tooltip--top-center","aria-describedby":"tp-cntr",children:[Object(s.jsxs)("div",{className:"has-icon",children:[Object(s.jsx)("i",{className:"p-icon--applications"}),Object(s.jsx)("span",{children:i})]}),Object(s.jsx)("span",{className:"p-tooltip__message",role:"tooltip",id:"tp-cntr",children:"Applications"})]}),Object(s.jsxs)("div",{className:"u-flex--block p-tooltip--top-center","aria-describedby":"tp-cntr",children:[Object(s.jsxs)("div",{className:"has-icon",children:[Object(s.jsx)("i",{className:"p-icon--units"}),Object(s.jsx)("span",{children:l})]}),Object(s.jsx)("span",{className:"p-tooltip__message",role:"tooltip",id:"tp-cntr",children:"Units"})]}),Object(s.jsxs)("div",{className:"u-flex--block p-tooltip--top-center","aria-describedby":"tp-cntr",children:[Object(s.jsxs)("div",{className:"has-icon",children:[Object(s.jsx)("i",{className:"p-icon--machines"}),Object(s.jsx)("span",{children:o})]}),Object(s.jsx)("span",{className:"p-tooltip__message",role:"tooltip",id:"tp-cntr",children:"Machines"})]})]})});break;case"cloud-tag":a=T(e.model["cloud-tag"]);break;case"region":a=e.model.region;break;case"cloud-credential-tag":a=U(e["cloud-credential-tag"]);break;case"controllerUuid":a=e["controller-uuid"];break;case"controllerName":a=e.controllerName;break;case"status.since":a=null===(n=e.status.since)||void 0===n?void 0:n.split("T")[0];break;default:console.log(`unsupported status value key: ${t}`)}return a}function Tn(e){var t;let n=null;switch(null===e||void 0===e||null===(t=e.info)||void 0===t?void 0:t["provider-type"]){case"ec2":n=Object(s.jsx)("img",{src:An,alt:"AWS logo",className:"p-table__logo","data-test":"provider-logo"});break;case"gce":n=Object(s.jsx)("img",{src:In,alt:"Google Cloud Platform logo",className:"p-table__logo","data-test":"provider-logo"});break;case"azure":n=Object(s.jsx)("img",{src:Rn,alt:"Azure logo",className:"p-table__logo","data-test":"provider-logo"});break;case"kubernetes":n=Object(s.jsx)("img",{src:Ln,alt:"Kubernetes logo",className:"p-table__logo","data-test":"provider-logo"})}return Object(s.jsxs)(s.Fragment,{children:[n,Un(e)]})}function Un(e){return`${$n(e,"cloud-tag")}/${$n(e,"region")}`}function Dn(e,t){return Object(s.jsx)("button",{onClick:()=>{e({model:t,panel:"share-model"})},className:"model-access p-button--neutral is-dense",children:"Access"})}function Fn(e,t){return[{content:k(e,t),sortKey:"name"},{content:"",sortKey:"summary"},{content:"Owner",sortKey:"owner"},{content:"Cloud/Region",sortKey:"cloud"},{content:"Credential",sortKey:"credential"},{content:"Controller",sortKey:"controller"},{content:"Last Updated",sortKey:"lastUpdated",className:"u-align--right"},{content:"",sortKey:"",className:"sm-screen-access-header"}]}const Vn=e=>{var t;const{messages:n}=A(e),a=n.join("; "),c=Mn(e.model.name,null===e||void 0===e||null===(t=e.info)||void 0===t?void 0:t.ownerTag,a);return Object(s.jsx)("span",{className:"model-table-list_error-message",title:a,children:c})},Kn=(e,t)=>{const n=Mn(e.model.name,e.info&&e.info["owner-tag"],e.model.name);return Object(s.jsxs)(s.Fragment,{children:[Object(s.jsx)("div",{children:n}),"blocked"===t?Vn(e):null]})};function Pn({filters:e}){const t=Object(o.c)((e=>Object(v.a)(X(e),Q))(e)),n=Object(h.e)({model:h.c,panel:Object(h.f)(h.c,"share-model")})[1],a=Sn(),{blockedRows:c,alertRows:i,runningRows:l}=function(e,t,n){const a={blockedRows:[],alertRows:[],runningRows:[]};return Object.keys(e).forEach((c=>{e[c].forEach((e=>{var i,o,l,r;let d="";e.info&&(d=M(e.info["owner-tag"]));const u=Tn(e),j=$n(e.info,"cloud-credential-tag"),b=$n(e.info,"controllerName"),m=null===(i=$n(e.info,"status.since"))||void 0===i?void 0:i.slice(2);a[`${c}Rows`].push({"data-test-model-uuid":null===e||void 0===e?void 0:e.uuid,columns:[{"data-test-column":"name",content:Kn(e,c)},{"data-test-column":"summary",content:$n(e,"summary"),className:"u-overflow--visible"},{"data-test-column":"owner",content:Object(s.jsx)(s.Fragment,{children:d})},{"data-test-column":"cloud",content:u,className:"u-truncate",title:Un(e)},{"data-test-column":"credential",content:j},{"data-test-column":"controller",content:b},{"data-test-column":"updated",content:Object(s.jsxs)(s.Fragment,{children:[H(n,null===e||void 0===e||null===(o=e.info)||void 0===o?void 0:o.users)&&Dn(t,e.model.name),Object(s.jsx)("span",{className:"model-access-alt",children:m})]}),className:"u-align--right lrg-screen-access-cell "+(H(n,null===e||void 0===e||null===(l=e.info)||void 0===l?void 0:l.users)?"has-permission":"")},{content:Object(s.jsx)(s.Fragment,{children:H(n,null===e||void 0===e||null===(r=e.info)||void 0===r?void 0:r.users)&&Dn(t,e.model.name)}),className:"sm-screen-access-cell"}],sortData:{name:e.model.name,owner:d,cloud:u,credential:j,controller:b,lastUpdated:m}})}))})),a}(t,n,a),r="There are no models with this status";return Object(s.jsxs)("div",{className:"status-group u-overflow--scroll",children:[c.length?Object(s.jsx)(En.a,{headers:Fn("Blocked",c.length),rows:c,sortable:!0,emptyStateMsg:r,className:"p-main-table"}):null,i.length?Object(s.jsx)(En.a,{headers:Fn("Alert",i.length),rows:i,sortable:!0,emptyStateMsg:r,className:"p-main-table"}):null,l.length?Object(s.jsx)(En.a,{headers:Fn("Running",l.length),rows:l,sortable:!0,emptyStateMsg:r,className:"p-main-table"}):null]})}function Hn(e,t){return[{content:k(e,t,!1),sortKey:"name"},{content:"",sortKey:"summary"},{content:"Owner",sortKey:"owner"},{content:"Status",sortKey:"status"},{content:"Region",sortKey:"region"},{content:"Credential",sortKey:"credential"},{content:"Controller",sortKey:"controller"},{content:"Last Updated",sortKey:"lastUpdated",className:"u-align--right"},{content:"",sortKey:"",className:"sm-screen-access-header"}]}function Bn({filters:e}){const t=Sn(),n=Object(o.c)((e=>Object(v.a)(X(e),ee))(e)),a=Object(h.e)({model:h.c,panel:Object(h.f)(h.c,"share-model")})[1],c=function(e){const t={};return Object.keys(e).forEach((n=>{t[n]=t[n]||[],t[n].push(e[n])})),t}(n);let i=[],l={};for(const o in c)Object.values(c[o]).forEach((e=>{l.rows=[],e.forEach((e=>{var n,c,i,o;const{highestStatus:r}=A(e),d=M(e.info["owner-tag"]),u=$n(e,"region"),j=$n(e.info,"cloud-credential-tag"),b=$n(e.info,"controllerName"),m=null===(n=$n(e.info,"status.since"))||void 0===n?void 0:n.slice(2);l.rows.push({"data-test-model-uuid":null===e||void 0===e?void 0:e.uuid,columns:[{"data-test-column":"name",content:Mn(e.info.name,e.info&&e.info["owner-tag"],e.info.name)},{"data-test-column":"summary",content:$n(e,"summary"),className:"u-overflow--visible"},{"data-test-column":"owner",content:d},{"data-test-column":"status",content:k(r),className:"u-capitalise"},{"data-test-column":"region",content:u},{"data-test-column":"credential",content:j},{"data-test-column":"controller",content:b},{"data-test-column":"updated",content:Object(s.jsxs)(s.Fragment,{children:[H(t,null===e||void 0===e||null===(c=e.info)||void 0===c?void 0:c.users)&&Dn(a,e.info.name),Object(s.jsx)("span",{className:"model-access-alt",children:m})]}),className:"u-align--right lrg-screen-access-cell "+(H(t,null===e||void 0===e||null===(i=e.info)||void 0===i?void 0:i.users)?"has-permission":"")},{content:Object(s.jsx)(s.Fragment,{children:H(t,null===e||void 0===e||null===(o=e.info)||void 0===o?void 0:o.users)&&Dn(a,e.info.name)}),className:"sm-screen-access-cell"}],sortData:{name:e.info.name,owner:d,status:r,region:u,credential:j,controller:b,lastUpdated:m}})}))})),i.push(Object(s.jsx)(En.a,{headers:Hn(o,l.rows.length),rows:l.rows,sortable:!0},o));return Object(s.jsx)("div",{className:"cloud-group u-overflow--scroll",children:i})}function Wn(e,t){return[{content:k(e,t,!1),sortKey:"name"},{content:"",sortKey:"summary"},{content:"Status",sortKey:"status"},{content:"Cloud/Region",sortKey:"cloud"},{content:"Credential",sortKey:"credential"},{content:"Controller",sortKey:"controller"},{content:"Last Updated",sortKey:"lastUpdated",className:"u-align--right"},{content:"",sortKey:"",className:"sm-screen-access-header"}]}function Jn({filters:e}){const t=function(e){const t={};return Object.keys(e).forEach((n=>{t[n]=t[n]||[],t[n].push(e[n])})),t}(Object(o.c)((e=>Object(v.a)(X(e),Z))(e))),n=Object(h.e)({model:h.c,panel:Object(h.f)(h.c,"share-model")})[1],a=Sn();let c=[],i={};for(const o in t)Object.values(t[o]).forEach((e=>{i.rows=[],e.forEach((e=>{var t,c,o,l;const{highestStatus:r}=A(e),d=Tn(e),u=$n(e.info,"cloud-credential-tag"),j=$n(e.info,"controllerName"),b=null===(t=$n(e.info,"status.since"))||void 0===t?void 0:t.slice(2);i.rows.push({"data-test-model-uuid":null===e||void 0===e?void 0:e.uuid,columns:[{"data-test-column":"name",content:Mn(e.info.name,e.info&&e.info["owner-tag"],e.info.name)},{"data-test-column":"summary",content:$n(e,"summary"),className:"u-overflow--visible"},{"data-test-column":"status",content:k(r),className:"u-capitalise"},{"data-test-column":"cloud",content:d,className:"u-truncate",title:Un(e)},{"data-test-column":"credential",content:u},{"data-test-column":"controller",content:j},{"data-test-column":"updated",content:Object(s.jsxs)(s.Fragment,{children:[H(a,null===e||void 0===e||null===(c=e.info)||void 0===c?void 0:c.users)&&Dn(n,e.info.name),Object(s.jsx)("span",{className:"model-access-alt",children:b})]}),className:"u-align--right lrg-screen-access-cell "+(H(a,null===e||void 0===e||null===(o=e.info)||void 0===o?void 0:o.users)?"has-permission":"")},{content:Object(s.jsx)(s.Fragment,{children:H(a,null===e||void 0===e||null===(l=e.info)||void 0===l?void 0:l.users)&&Dn(n,e.info.name)}),className:"sm-screen-access-cell"}],sortData:{name:e.info.name,status:r,cloud:d,credential:u,controller:j,lastUpdated:b}})}))})),c.push(Object(s.jsx)(En.a,{headers:Wn(o,i.rows.length),rows:i.rows,sortable:!0,className:"p-main-table"},o));return Object(s.jsx)("div",{className:"owners-group u-overflow--scroll",children:c})}n(458);function qn({filters:e,groupedBy:t}){switch(t){case"status":default:return Object(s.jsx)(Pn,{filters:e});case"cloud":return Object(s.jsx)(Bn,{filters:e});case"owner":return Object(s.jsx)(Jn,{filters:e})}}n(459);var Gn=({buttons:e,label:t,activeButton:n,setActiveButton:a})=>Object(s.jsx)("div",{className:"p-button-group",children:Object(s.jsxs)("div",{className:"p-button-group__inner",children:[t?Object(s.jsx)("span",{className:"p-button-group__label","data-test":"label",children:t}):null,Object(s.jsx)("div",{className:"p-button-group__buttons",children:e.map((e=>Object(s.jsx)("button",{"aria-label":`view by ${e}`,className:Ct()("p-button-group__button",{"is-selected":n===e}),value:e,onClick:e=>a(e.currentTarget.value),children:e},e)))})]})});n(460);var Yn=({chips:e,descriptor:t})=>{const n=(e=>{let t=0;return e&&Object.values(e).forEach((e=>{t+=e})),t})(e),a=(e=>{let t;switch(e){case"localApps":t="Local applications";break;case"units":t="Units";break;case"machines":t="Machines"}return t})(t);return Object(s.jsx)(s.Fragment,{children:n>0&&Object(s.jsxs)("div",{className:"chip-group",children:[a&&Object(s.jsx)("strong",{className:"chip-group__descriptor",children:`${n} ${a}`}),Object.entries(e).map((([e,t])=>t>0&&Object(s.jsx)("div",{className:"p-chip",children:Object(s.jsx)("span",{className:`status-icon is-${e.toLowerCase()}`,children:`${t} ${e}`})},e)))]})})},zn=n(88);n(528);function Xn(){vn("Models");const[e,t]=Object(h.d)("groupedby",Object(h.f)(h.c,"status")),[n,a]=Object(h.e)({cloud:Object(h.f)(h.a,[]),owner:Object(h.f)(h.a,[]),region:Object(h.f)(h.a,[]),credential:Object(h.f)(h.a,[]),custom:Object(h.f)(h.a,[])}),c=Object(o.c)(B),{clouds:i,regions:l,owners:r,credentials:d}=function(e){const t=[],n=[],s=[],a=[];return Object.values(e).forEach((e=>{if(!e.info)return;const c=T(e.info["cloud-tag"]);t.includes(c)||t.push(c);const i=e.info["cloud-region"];n.includes(i)||n.push(i);const o=M(e.info["owner-tag"]);s.includes(o)||s.push(o);const l=U(e.info["cloud-credential-tag"]);a.includes(l)||a.push(l)})),{clouds:t,regions:n,owners:s,credentials:a}}(c),u=(e,t)=>{let n=[];return t.forEach((t=>{n.push({lead:e,value:t})})),n},{blocked:j,alert:b,running:m}=Object(o.c)(je);let p={};const O=[];for(const[s,o]of Object.entries(n))o.forEach((e=>{O.push({lead:s,value:e})}));const f=j+b+m,v=f>0;return Object(s.jsxs)(mn,{children:[Object(s.jsx)(pn,{children:Object(s.jsxs)("div",{className:"models__header","data-disabled":0===f,children:[Object(s.jsxs)("strong",{className:"models__count",children:[f," ",$(f,"model")]}),Object(s.jsx)(Gn,{activeButton:e,buttons:["status","cloud","owner"],label:"Group by:",setActiveButton:t}),Object(s.jsx)(zn.SearchAndFilter,{filterPanelData:[{id:0,heading:"Cloud",chips:u("Cloud",i)},{id:1,heading:"Region",chips:u("Region",l)},{id:2,heading:"Owner",chips:u("Owner",r)},{id:3,heading:"Credential",chips:u("Credential",d)}],existingSearchData:O,returnSearchData:e=>{var t,s;p={cloud:[],owner:[],region:[],credential:[],custom:[]},e.length&&e.forEach((({lead:e,value:t})=>{const n=e?e.toLowerCase():"custom";p[n]||(p[n]=[]),p[n].push(t)})),t=p,s=n,JSON.stringify(t)!==JSON.stringify(s)&&a(p)}})]})}),v?Object(s.jsx)(fn,{isActive:v,children:Object(s.jsx)("div",{className:"l-content",children:Object(s.jsxs)("div",{className:"models",children:[Object(s.jsx)(Yn,{chips:{blocked:j,alert:b,running:m}}),Object(s.jsx)(qn,{groupedBy:e,filters:n})]})})}):Object(s.jsx)("div",{className:"entity-details__loading",children:Object(s.jsx)(ut.a,{})})]})}const Qn=e=>e.juju.modelWatcherData,Zn=e=>e.juju.models;function es(e){return Object(v.a)(Qn,(t=>(null===t||void 0===t?void 0:t[e])?t[e]:null))}function ts(e){return Object(v.a)(es(e),(e=>e?e.model:null))}function ns(e,t){return Object(v.a)(Zn,(n=>{let s="";return n?(Object.entries(n).some((([n,{name:a,ownerTag:c,uuid:i}])=>a===e&&c.replace("user-","")===t&&(s=i,!0))),s):s}))}function ss(e){return Object(v.a)(es(e),(e=>e?e.applications:null))}function as(e){return Object(v.a)(es(e),(e=>e?e.units:null))}function cs(e){return Object(v.a)(es(e),(e=>e?e.relations:null))}function is(e){return Object(v.a)(es(e),(e=>e?e.machines:null))}var os;function ls(e){return Object(v.a)(as(e),(e=>{if(!e)return null;const t={};return Object.entries(e).forEach((([e,n])=>{let s=os.running;switch(n["workload-status"].current){case"maintenance":case"waiting":s=os.alert;break;case"blocked":s=os.blocked}let a=os.running;switch(n["agent-status"].current){case"allocating":case"executing":case"rebooting":a=os.alert;break;case"failed":case"lost":a=os.blocked}const c=Math.max(s,a,os.running);t[n.application]=os[c]})),t}))}!function(e){e[e.running=0]="running",e[e.alert=1]="alert",e[e.blocked=2]="blocked"}(os||(os={}));const rs=[{content:"local apps",sortKey:"local-apps"},{content:"status",sortKey:"status"},{content:"version",sortKey:"version"},{content:"scale",className:"u-align--right",sortKey:"scale"},{content:"store",sortKey:"store"},{content:"rev",className:"u-align--right",sortKey:"rev"},{content:"message",sortKey:"message"}],ds=[{content:"remote apps",sortKey:"remote-apps"},{content:"status",sortKey:"status"},{content:"interface",sortKey:"interface"},{content:"offer url",sortKey:"offer-url"},{content:"store",sortKey:"store"}],us=[{content:"unit",sortKey:"unit"},{content:"workload",sortKey:"workload"},{content:"agent",sortKey:"agent"},{content:"machine",className:"u-align--right",sortKey:"machine"},{content:"public address",sortKey:"publicAddress"},{content:"ports",className:"u-align--right",sortKey:"ports"},{content:"message",sortKey:"message"}],js=[{content:"machine",sortKey:"machine"},{content:"apps",sortKey:"apps"},{content:"state",sortKey:"state"},{content:"az",sortKey:"az"},{content:"instance id",sortKey:"instanceId"},{content:"message",sortKey:"message"}],bs=[{content:"relation provider",sortKey:"provider"},{content:"requirer",sortKey:"requirer"},{content:"interface",sortKey:"interface"},{content:"type",sortKey:"type"}],ms=[{content:"consumed"},{content:"endpoint"},{content:"status"}],ps=[{content:"connected offers"},{content:"endpoints"},{content:"connections"}],hs=[{content:"offers"},{content:"interface"},{content:"connection"},{content:"offer url"}];function Os(e,t,n,s){if(!e)return[];return Object.keys(e).map((a=>{var c,i,o;const l=e[a],r=D(l["charm-url"])||"-",d=(u=l["charm-url"])?0===u.indexOf("local:")?"Local":"Charmhub":"";var u;const j=l["workload-version"]||"-";return{columns:[{"data-test-column":"name",content:w(l["charm-url"]||"",a,!1),className:"u-truncate"},{"data-test-column":"status",content:l.status?k(t[l.name]):"-",className:"u-capitalise u-truncate"},{"data-test-column":"version",content:l["workload-version"]||"-"},{"data-test-column":"scale",content:l["unit-count"],className:"u-align--right"},{"data-test-column":"store",content:d},{"data-test-column":"revision",content:r,className:"u-align--right"},{"data-test-column":"message",content:null===(c=l.status)||void 0===c?void 0:c.message,className:"u-truncate",title:null===(i=l.status)||void 0===i?void 0:i.message}],sortData:{app:a,status:null===(o=l.status)||void 0===o?void 0:o.status,version:j,scale:l["unit-count"],store:d,rev:r,notes:"-"},onClick:e=>n("app",a,e),"data-app":a,className:"apps"===(null===s||void 0===s?void 0:s.panel)&&(null===s||void 0===s?void 0:s.entity)===a?"is-selected":""}}))}function fs(e,t,n,a){if(!e)return[];const c=x()(e);Object.entries(c).forEach((([e,t])=>{t.subordinate&&c[t.principal]&&(c[t.principal].subordinates||(c[t.principal].subordinates={}),c[t.principal].subordinates[e]=t,delete c[e])}));const i=[];return Object.keys(c).forEach((e=>{const o=c[e],l=o["workload-status"].current||"-",r=o["agent-status"].current||"-",d=o["public-address"]||"-",u=function(e){return e&&0!==e.length?e.map((e=>e.number)).join(", "):"-"}(o.ports),j=o["workload-status"].message||"-",b=o["charm-url"];let m=[{content:w(b||"",e,!1),className:"u-truncate"},{content:k(l),className:"u-capitalise"},{content:r},{content:o["machine-id"],className:"u-align--right",key:"machine"},{content:d},{content:u,className:"u-align--right",title:u},{content:Object(s.jsx)("span",{title:j,children:j}),className:"u-truncate"}];if(a&&(m=m.filter((e=>!("machine"===e.key)))),n){const t=`table-checkbox-${e}`,n=`aria-labeled-${e}`;m.splice(0,0,{content:Object(s.jsxs)("label",{className:"p-checkbox--inline",htmlFor:t,children:[Object(s.jsx)(Yt.a,{id:t,type:"checkbox","aria-labelledby":n,className:"p-checkbox__input",name:"selectedUnits",value:e}),Object(s.jsx)("span",{className:"p-checkbox__label",id:n})]})})}i.push({columns:m,sortData:{unit:e,workload:l,agent:r,machine:o.machine,publicAddress:d,ports:u,message:j},onClick:n=>t("unit",e,n),"data-unit":e});const p=o.subordinates;if(p)for(let[s]of Object.entries(p)){const a=p[s];let c=[{content:w(a["charm-url"],s,!0),className:"u-truncate"},{content:k(a["workload-status"].current),className:"u-capitalise"},{content:a["agent-status"].current},{content:a["machine-id"],className:"u-align--right"},{content:a["public-address"]},{content:a["public-address"].split(":")[-1]||"-",className:"u-align--right"},{content:a["workload-status"].current,className:"u-truncate"}];n&&c.splice(0,0,{content:""}),i.push({columns:c,sortData:{unit:e,workload:l,agent:r,machine:o["machine-id"],publicAddress:d,ports:u,message:j},onClick:n=>t("unit",e,n),"data-unit":e})}})),i}function vs(e,t,n,a){if(!e)return[];const c=(e,t)=>{const n=[];t&&Object.values(t).forEach((t=>{e===t["machine-id"]&&n.push([t.application,t["charm-url"]])}));return n.length?n.map((e=>K(e[0],e[1]))):"None"};return Object.keys(e).map((i=>{var o,l;const r=e[i],d=(null===r||void 0===r||null===(o=r["hardware-characteristics"])||void 0===o?void 0:o["availability-zone"])||"";return{columns:[{content:Object(s.jsxs)(s.Fragment,{children:[Object(s.jsxs)("div",{children:[i,Object(s.jsxs)("span",{className:"u-capitalise",children:[". ",r.series]})]}),r.dnsName]})},{content:c(i,t),className:"machine-app-icons"},{content:k(r["agent-status"].current),className:"u-capitalise"},{content:d},{content:r["instance-id"]},{content:Object(s.jsx)("span",{title:r["agent-status"].message,children:r["agent-status"].message}),className:"u-truncate"}],sortData:{machine:r.series,state:null===r||void 0===r||null===(l=r["agent-status"])||void 0===l?void 0:l.current,az:d,instanceId:r["instance-id"],message:null===r||void 0===r?void 0:r["agent-status"].message},onClick:e=>n("machine",i,e),"data-machine":i,className:a===i?"is-selected":""}}))}const gs=e=>{var t;return(null===e||void 0===e||null===(t=e.subordinateTo)||void 0===t?void 0:t.length)>0},xs=(e,t)=>parseFloat(e)+-parseFloat(t),Ns=e=>{const t=/(\d*\.?\d*),\s(\d*\.?\d*)/,n=t=>gn.d(`[data-name="${e[t]}"]`),s=e=>t.exec(e.node().getAttribute("transform")),a=e=>e.data()[0],c=n(0),i=n(1),o=s(c),l=s(i);return{x1:xs(o[1],gs(a(c))?-60:-90),y1:xs(o[2],gs(a(c))?-60:-90),x2:xs(l[1],gs(a(i))?-60:-90),y2:xs(l[2],gs(a(i))?-60:-90)}};var _s=({annotations:e,applications:t,relations:n,width:c,height:i})=>{const o=Object(a.useRef)(),l=x()(e),{deltaX:r,deltaY:d}=(e=>{let t=null,n=null;return e?(Object.keys(e).forEach((s=>{const{"gui-x":a,"gui-y":c}=e[s],i=parseFloat(a),o=parseFloat(c);!isNaN(i)&&(null===t||i<t)&&(t=i),!isNaN(o)&&(null===n||o<n)&&(n=o)})),{deltaX:t,deltaY:n}):{deltaX:t,deltaY:n}})(l),u=Object.entries(t).map((([e,t])=>({...t,...l[e],name:e})));for(const s in l){const e=l[s];e["gui-x"]&&(e["gui-x"]=xs(e["gui-x"],r)),e["gui-y"]&&(e["gui-y"]=xs(e["gui-y"],d))}let{maxX:j,maxY:b}=(e=>{let t=0,n=0;return e?(Object.keys(e).forEach((s=>{const{"gui-x":a,"gui-y":c}=e[s],i=parseFloat(c),o=parseFloat(a);!isNaN(o)&&o>n&&(n=o),!isNaN(i)&&i>t&&(t=i)})),{maxX:n,maxY:t}):{maxX:n,maxY:t}})(l);0===j&&(j=500);const m=/(.+):(.+)\s(.+):(.+)/,p=Object.entries(n||{}).reduce(((e,[t,n])=>{if(n.endpoints.length>1){const n=t.match(m);e.push(`${n[1]}:${n[3]}`)}return e}),[]),h=[...new Set(p)].map((e=>e.split(":"))),O=Object.keys(t),f=h.filter((e=>O.includes(e[0])&&O.includes(e[1])));return Object(a.useEffect)((()=>{const e=gn.d(o.current).attr("viewBox",`0 0 ${c} ${i}`).append("g"),t=e.selectAll(".application").data(u);let n={x:0,y:b};const s=t.enter().append("g").attr("transform",(e=>{const t=void 0!==e["gui-x"]?e["gui-x"]:n.x,s=void 0!==e["gui-y"]?e["gui-y"]:n.y;return n.x+=250,n.x>j&&(n.x=0,n.y+=200),`translate(${t}, ${s})`}));s.classed("application",!0).attr("data-name",(e=>e.name)).append("circle").attr("cx",(e=>gs(e)?60:90)).attr("cy",(e=>gs(e)?60:90)).attr("r",(e=>gs(e)?60:90)).attr("fill","#f5f5f5").attr("stroke-width",3).attr("stroke","#888888").call((t=>{const{width:n,height:s}=e.node().getBoundingClientRect();if(n>0&&s>0){const t=200,a=Math.min(c/(n+t),i/(s+t)),o=(c-n*a)/2,l=(i-s*a)/2;e.attr("transform",`translate(${o},${l}) scale(${a},${a})`)}})),s.append("image").attr("xlink:href",(e=>F(e["charm-url"]))).attr("width",(e=>gs(e)?96:126)).attr("height",(e=>gs(e)?96:126)).attr("transform",(e=>gs(e)?"translate(13, 13)":"translate(28, 28)")).attr("clip-path",(e=>gs(e)?"circle(43px at 48px 48px)":"circle(55px at 63px 63px)"));const a=e.selectAll(".relation").data(f);return a.enter().insert("g",":first-child").classed("relation",!0).append("line").attr("x1",(e=>Ns(e).x1)).attr("y1",(e=>Ns(e).y1)).attr("x2",(e=>Ns(e).x2)).attr("y2",(e=>Ns(e).y2)).attr("stroke","#666666").attr("stroke-width",2),t.exit().remove(),a.exit().remove(),()=>{e.remove()}}),[u,r,d,i,c,j,b,f]),Object(s.jsx)("svg",{ref:o})},ys=n(143),ws=n.n(ys);n(529);const ks=()=>(()=>{const e=document.documentElement;return Math.max(e.clientWidth,window.innerWidth||0)})()>=1580?300:180;var Cs=()=>{const{modelName:e,userName:t}=Object(p.i)(),[n,c]=Object(a.useState)(!1),i=Object(o.c)(ns(e,t)),l=Object(o.c)(function(e){return Object(v.a)(es(e),(e=>e?e.annotations:null))}(i)),r=Object(o.c)(ss(i)),d=Object(o.c)(cs(i)),u=Object.keys(r||{}).length,{width:j,height:b}=(()=>{const e=document.documentElement;return{width:Math.max(e.clientWidth,window.innerWidth||0)-300,height:Math.max(e.clientHeight,window.innerHeight||0)-300}})(),m=ks(),h=St();Ut("keydown",(function(e){"Escape"===e.code&&n&&c(!1)}));const O=()=>{c(!n),h({path:void 0,category:"User",action:"Opened expanded topology"})};return Object(s.jsx)("div",{className:"info-panel","data-testid":"info-panel",children:n?Object(s.jsx)(ws.a,{close:()=>c(!1),title:(null===e||void 0===e?void 0:e.split("/")[1])||e,children:Object(s.jsx)(_s,{width:j,height:b,annotations:l,applications:r,relations:d})}):Object(s.jsx)(s.Fragment,{children:u>0&&Object(s.jsxs)("div",{className:"info-panel__pictogram",children:[Object(s.jsx)(_s,{width:m,height:m,annotations:l,applications:r,relations:d}),void 0!==e&&Object(s.jsx)("i",{className:"p-icon--fullscreen",onClick:O,onKeyPress:O,role:"button",tabIndex:0,children:"Expand topology"})]})})})};n(530);function Es({title:e,openByDefault:t,children:n}){const[c,i]=Object(a.useState)(t);function o(){i(!c)}const l=c?"minus":"plus";return Object(s.jsxs)("div",{className:"content-reveal","data-open":c,children:[Object(s.jsxs)("div",{className:"content-reveal__header",onClick:()=>o(),onKeyDown:()=>o(),role:"button",tabIndex:0,children:[Object(s.jsx)("i",{className:`p-icon--${l}`}),Object(s.jsx)("div",{className:"content-reveal__title",children:e})]}),Object(s.jsx)("div",{className:"content-reveal__content","aria-hidden":!c,children:n})]})}const Ss={0:null,30:"0,0,0",31:"205,49,49",32:"13,188,121",33:"229,229,16",34:"26,114,200",35:"188,63,188",36:"17,168,205",37:"229,229,229",90:"102,102,102",91:"241,76,76",92:"35,209,139",93:"245,245,67",94:"59,142,234",95:"214,112,214",96:"41,184,219",97:"229,229,229"},As=/\[\d{1,3}m/g,Rs=e=>{const t=Array.from(e.matchAll(As));if(0===t.length)return e;let n="",s=0;return t.forEach(((a,c)=>{var i;const o=a[0],l=o.replace("[","").replace("m","");0!==a.index&&0===s&&(n+=e.substring(s,a.index),s=a.index);const r=(null===(i=t[c+1])||void 0===i?void 0:i.index)||e.length;let d=e.substring(a.index,r).replace(o,"");const u=(e=>{const t=Ss[e];if(t)return`color: rgb(${t})`;const n=Ss[e-10];return n?`color: rgb(${n})`:void 0})(l);u&&(d=`<span style="${u}">${d}</span>`),n+=d,s=a.index})),n};var Is=({content:e,helpMessage:t,showHelp:n,setShouldShowHelp:c})=>{const i=Object(a.useRef)(0),[o,l]=Object(a.useState)(1);Object(a.useEffect)((()=>{const e=e=>{const t=window.innerHeight,n=t-(e.clientY+40)+i.current;n<t-100&&n>=10&&l(n)},t=t=>{["webcli__output-dragarea","webcli__output-handle"].includes(t.target.classList.value)&&(i.current=t.layerY,document.addEventListener("mousemove",e),document.addEventListener("ontouchmove",e))},n=()=>{document.removeEventListener("mousemove",e),document.removeEventListener("ontouchmove",e)};return window.addEventListener("mousedown",t),window.addEventListener("mouseup",n),window.addEventListener("ontouchstart",t),window.addEventListener("ontouchend",n),()=>{window.removeEventListener("mousedown",t),window.removeEventListener("mouseup",n),window.removeEventListener("ontouchstart",t),window.removeEventListener("ontouchend",n)}}),[]),Object(a.useEffect)((()=>{n&&l(50)}),[n]),Object(a.useEffect)((()=>{o<20&&c(!1)}),[o,c]),Object(a.useEffect)((()=>{e.length>1&&o<=50&&300!==o&&l(300)}),[e]),e=e.replace(/\\u001b/gi,"");const r=Object(a.useMemo)((()=>n?t:Rs(e)),[e,n,t]);return Object(s.jsxs)("div",{className:"webcli__output",style:{height:`${o}px`},children:[Object(s.jsx)("div",{className:"webcli__output-dragarea","aria-hidden":!0,children:Object(s.jsx)("div",{className:"webcli__output-handle"})}),Object(s.jsx)("pre",{className:"webcli__output-content",style:{height:`${o}px`},children:Object(s.jsx)("code",{dangerouslySetInnerHTML:{__html:r}})})]})};var Ls=class{constructor(e){this._messageBuffer="",this._messageCallback=e.messageCallback,this.address=e.address,this.wsOnOpen=e.onopen,this.wsOnClose=e.onclose}connect(){const e=new WebSocket(this.address);return e.onopen=this._wsOnOpen,e.onclose=this._wsOnClose,e.onmessage=this._handleMessage.bind(this),this._ws=e,this}send(e){this._ws.send(e)}disconnect(){this._ws.close()}_handleMessage(e){try{const t=JSON.parse(e.data);if(t["redirect-to"]&&(this._ws.close(),this.address=t["redirect-to"],this.connect()),t.done)return;if(!t.output)return;this._pushToMessageBuffer(`\n${null===t||void 0===t?void 0:t.output[0]}`)}catch(e){console.log(e)}}_pushToMessageBuffer(e){this._messageBuffer=this._messageBuffer+e,setTimeout((()=>{this._messageCallback(this._messageBuffer),this._messageBuffer=""}))}};n(531);var Ms=({controllerWSHost:e,credentials:t,modelUUID:n,protocol:c="wss"})=>{const[i,l]=Object(a.useState)(null),[r,d]=Object(a.useState)(!1),u=Object(a.useRef)(),j=Object(a.useRef)();let[b,m]=Object(a.useState)("");const p=St(),h=Object(o.c)(J),O=Object(o.d)().getState(),f=Object(a.useMemo)((()=>e&&n?`${c}://${e}/model/${n}/commands`:null),[e,n,c]);Object(a.useEffect)((()=>{const e=new Ls({address:f,onopen:()=>{},onclose:()=>{},messageCallback:e=>{j.current=j.current+e,m(j.current)}}).connect();return l(e),()=>{e.disconnect()}}),[f]);const v=()=>{d(!0)};return Object(s.jsxs)("div",{className:"webcli",children:[Object(s.jsx)(Is,{content:b,showHelp:r,setShouldShowHelp:d,helpMessage:'Welcome to the Juju Web CLI - see the <a href="https://juju.is/docs/olm/using-the-juju-web-cli" class="p-link--inverted" target="_blank">full documentation here</a>.'}),Object(s.jsxs)("div",{className:"webcli__input",children:[Object(s.jsx)("div",{className:"webcli__input-prompt",children:"$ juju"}),Object(s.jsx)("form",{onSubmit:e=>{e.preventDefault(),j.current="",m(""),d(!1);let n={};if(t&&t.user&&t.password)n.user=t.user,n.credentials=t.password;else{const e=new URL(i.address).origin,t=h.storage.get(e);if(t){const e=JSON.parse(atob(t)),s=new URL(f).origin,a=ie(`${s}/api`,O);n.user=null===a||void 0===a?void 0:a.replace("user-",""),n.macaroons=[e]}else console.error("No authentication information available")}i.send(JSON.stringify({...n,commands:[e.currentTarget.children.command.value.trim()]})),p({category:"User",action:"WebCLI command sent"}),u.current.value=""},children:Object(s.jsx)("input",{autoComplete:"off",autoCorrect:"off",autoCapitalize:"none",spellCheck:"false",className:"webcli__input-input",type:"text",name:"command",ref:u,placeholder:"enter command"})}),Object(s.jsx)("div",{className:"webcli__input-help",children:Object(s.jsx)("i",{className:"p-icon--help is-light",onClick:v,onKeyDown:v,role:"button",tabIndex:"0"})})]})]})};n(532);var $s=function({children:e,onClose:t,isActive:n,isLoading:a=!1,className:c}){return Ut("keydown",(e=>{n&&"Escape"===e.code&&t()})),Ut("click",(e=>{!n||e.target.closest(".p-modal")||e.target.closest(".slide-panel")||e.target.closest('[role="row"]')||e.target.closest(".webcli")||t()})),Object(s.jsxs)("div",{className:Ct()("slide-panel",c),"aria-hidden":!n,children:[Object(s.jsx)("button",{className:"p-modal__close","aria-label":"Close active modal","aria-controls":"modal",onClick:t,onKeyPress:t,children:"Close"}),Object(s.jsx)("div",{className:"slide-panel__content","data-loading":a,children:a?Object(s.jsx)(ut.a,{}):e})]})};n(533);function Ts(){const{userName:e,modelName:t,appName:n,unitId:a,machineId:c}=Object(p.i)(),i={id:void 0,title:void 0};return n&&(i.id=n,i.title="Applications"),a&&(i.id=a,i.title="Units"),c&&(i.id=c,i.title="Machines"),Object(s.jsx)("nav",{className:"p-breadcrumbs","aria-label":"Breadcrumb navigation",children:Object(s.jsx)("ol",{className:"p-breadcrumbs__items","data-test":"breadcrumb-items",children:function(){const o=c?"machines":"apps";var l;return n||a||c?Object(s.jsxs)(s.Fragment,{children:[Object(s.jsx)("li",{className:"p-breadcrumbs__item u-no-padding--top","data-test":"breadcrumb-model",children:Object(s.jsx)(m.b,{to:`/models/${e}/${t}`,children:t})}),!a&&Object(s.jsx)("li",{className:"p-breadcrumbs__item u-no-padding--top","data-test":"breadcrumb-section",children:Object(s.jsx)(m.b,{to:`/models/${e}/${t}?activeView=${o}`,children:i.title})}),a&&Object(s.jsxs)(s.Fragment,{children:[Object(s.jsx)("li",{className:"p-breadcrumbs__item u-no-padding--top","data-test":"breadcrumb-section",children:Object(s.jsx)(m.b,{to:`/models/${e}/${t}?activeView=apps`,children:"Applications"})}),Object(s.jsx)("li",{className:"p-breadcrumbs__item u-no-padding--top","data-test":"breadcrumb-app",children:Object(s.jsx)(m.b,{to:`/models/${e}/${t}/app/${n}`,children:n})})]}),Object(s.jsx)("li",{className:"p-breadcrumbs__item u-no-padding--top","data-test":`breadcrumb-${null===(l=i.title)||void 0===l?void 0:l.toLowerCase()}`,children:Object(s.jsx)("strong",{children:i.id})})]}):Object(s.jsx)("li",{className:"p-breadcrumbs__item p-breadcrumbs__item--restricted","data-test":"breadcrumb-model",title:t,children:Object(s.jsx)(m.b,{to:`/models/${e}/${t}`,className:"p-link--soft",children:Object(s.jsx)("strong",{children:t})})})}()})})}var Us=n.p+"static/media/bulb.31f25996.svg",Ds=n.p+"static/media/no-config-params.1840ee6f.svg";function Fs({config:e,selectedConfig:t,setSelectedConfig:n,setNewValue:c}){const[i,o]=Object(a.useState)(!1),[l,r]=Object(a.useState)(!1),[d,u]=Object(a.useState)(!1),[j,b]=Object(a.useState)(e.value!==e.default),m=Object(a.useRef)(null),p=Object(a.useRef)(null),h=Object(a.useRef)(null),[O,f]=Object(a.useState)("0px");let v=e.default;function g(e){const t="true"===e.target.value;c(e.target.name,t)}return V(e.newValue)?v=e.newValue:e.default!==e.value&&(v=e.value),Object(a.useEffect)((()=>{var e;(null===(e=h.current)||void 0===e?void 0:e.firstChild)&&f(`${h.current.firstChild.clientHeight}px`)}),[]),Object(a.useEffect)((()=>{h.current&&(h.current.style.maxHeight=d?O:"0px")}),[d,O]),Object(a.useEffect)((()=>{(null===t||void 0===t?void 0:t.name)===e.name?o(!0):o(!1)}),[t,e]),Object(a.useEffect)((()=>{V(e.newValue)&&e.newValue!==e.default||!V(e.newValue)&&e.value!==e.default?b(!0):b(!1),V(e.newValue)&&e.newValue!==e.value?r(!0):r(!1)}),[e]),Object(s.jsxs)("div",{className:Ct()("config-input",{"config-input--focused":i,"config-input--changed":l}),onClick:()=>n(e),children:[Object(s.jsxs)("h5",{className:"u-float-left",children:[Object(s.jsx)("i",{className:Ct()("config-input--view-description",{"p-icon--plus":!d,"p-icon--minus":d}),onClick:()=>u(!d),onKeyPress:()=>u(!d),role:"button",tabIndex:0}),e.name]}),Object(s.jsx)("button",{className:Ct()("u-float-right p-button--base config-panel__hide-button",{"config-panel__show-button":j}),onClick:function(){c(e.name,e.default)},children:"use default"}),Object(s.jsx)("div",{className:Ct()("config-input--description"),ref:h,children:Object(s.jsx)("pre",{className:"config-input--description-container",children:e.description})}),Object(s.jsxs)("div",{className:"row",children:[Object(s.jsxs)("label",{className:".p-radio--inline col-2",children:[Object(s.jsx)("input",{type:"radio",className:"p-radio__input",name:e.name,"aria-labelledby":e.name,checked:!0===v,value:"true",onClick:g,onChange:g,ref:m}),Object(s.jsx)("span",{className:"p-radio__label",children:"true"})]}),Object(s.jsxs)("label",{className:"p-radio--inline col-2",children:[Object(s.jsx)("input",{type:"radio",className:"p-radio__input",name:e.name,"aria-labelledby":e.name,checked:!1===v,value:"false",onClick:g,onChange:g,ref:p}),Object(s.jsx)("span",{className:"p-radio__label",children:"false"})]})]})]})}function Vs({config:e,selectedConfig:t,setSelectedConfig:n,setNewValue:c}){const[i,o]=Object(a.useState)(!1),[l,r]=Object(a.useState)(!1),[d,u]=Object(a.useState)(e.value!==e.default),[j,b]=Object(a.useState)(!1),m=Object(a.useRef)(null),p=Object(a.useRef)(null),[h,O]=Object(a.useState)("0px");let f=e.default;function v(){b(!j)}return V(e.newValue)?f=e.newValue:e.default!==e.value&&(f=e.value),Object(a.useEffect)((()=>{var e;(null===(e=p.current)||void 0===e?void 0:e.firstChild)&&O(`${p.current.firstChild.clientHeight}px`)}),[]),Object(a.useEffect)((()=>{p.current&&(p.current.style.maxHeight=j?h:"0px")}),[j,h]),Object(a.useEffect)((()=>{o((null===t||void 0===t?void 0:t.name)===e.name)}),[t,e]),Object(a.useEffect)((()=>{V(e.newValue)&&e.newValue!==e.default||!V(e.newValue)&&e.value!==e.default?u(!0):u(!1),V(e.newValue)&&e.newValue!==e.value?r(!0):r(!1)}),[e]),Object(s.jsxs)("div",{className:Ct()("config-input",{"config-input--focused":i,"config-input--changed":l}),"data-config-name":e.name,onClick:()=>n(e),children:[Object(s.jsxs)("h5",{className:"u-float-left",children:[Object(s.jsx)("i",{className:Ct()("config-input--view-description",{"p-icon--plus":!j,"p-icon--minus":j}),onClick:v,onKeyPress:v,role:"button",tabIndex:0}),e.name]}),Object(s.jsx)("button",{className:Ct()("u-float-right p-button--base config-panel__hide-button",{"config-panel__show-button":d}),onClick:function(){c(e.name,e.default)},children:"use default"}),Object(s.jsx)("div",{className:Ct()("config-input--description"),ref:p,children:Object(s.jsx)("pre",{className:"config-input--description-container",children:e.description})}),Object(s.jsx)("textarea",{ref:m,value:f,onFocus:()=>n(e),onChange:t=>{c(e.name,t.target.value)}})]})}n(534);function Ks({appName:e,charm:t,modelUUID:n,onClose:c}){const i=Object(o.d)(),[l,r]=Object(a.useState)({}),[d,u]=Object(a.useState)(void 0),[j,b]=Object(a.useState)(!1),[m,p]=Object(a.useState)(!1),[h,O]=Object(a.useState)(!0),[f,v]=Object(a.useState)(!1),[g,N]=Object(a.useState)(null),_=St();function y(e){const t=Object.keys(e).some((t=>{const n=e[t];if(V(n.newValue)){if(n.newValue===n.default)return!1;if(n.newValue!==n.default)return!0}else if(n.value!==n.default)return!0;return!1}));p(t)}function w(e){const t=k(e);b(t)}function k(e){return Object.keys(e).some((t=>V(e[t].newValue)&&e[t].newValue!==e[t].value))}async function C(){v(!0);const t=await async function(e,t,n,s){const a=await Ge(e,s),c={};return Object.keys(n).forEach((e=>{V(n[e].newValue)&&(c[e]=`${n[e].newValue}`)})),await a.facades.application.set({application:t,options:c})}(n,e,l,i.getState());"string"===typeof t&&console.error("error setting config",t),await Ps(n,e,i,O,r,y),v(!1),b(!1),N(null),_({category:"User",action:"Config values updated"})}return Ut("keydown",(e=>{"Escape"===e.code&&null!==g&&N(null)})),Object(a.useEffect)((()=>{O(!0),Ps(n,e,i,O,r,y)}),[e,n,i]),Object(a.useEffect)((()=>{_({category:"User",action:"Config panel opened"})}),[_]),Object(s.jsx)($s,{isActive:!0,onClose:function(){return k(l)?(N("cancel"),!1):(c(),!0)},isLoading:!e,className:"config-panel",children:Object(s.jsx)("div",{className:"config-panel",children:h?Object(s.jsx)("div",{className:"full-size u-vertically-center",children:Object(s.jsx)(ut.a,{})}):h||l&&0!==Object.keys(l).length?Object(s.jsx)(fn,{isActive:!0,className:"config-content row",children:Object(s.jsxs)(s.Fragment,{children:[Object(s.jsxs)("div",{className:"config-panel__config-list col-6",children:[Object(s.jsxs)("div",{className:"config-panel__list-header",children:[Object(s.jsxs)("div",{className:"entity-name",children:[K(e,t)," ",e]}),Object(s.jsx)("div",{className:"config-panel__reset-all",children:Object(s.jsx)("button",{className:Ct()("u-button-neutral config-panel__hide-button",{"config-panel__show-button":m}),onClick:function(){const e=x()(l);Object.keys(e).forEach((t=>{const n=e[t];(n.value!==n.default||n.newValue!==n.default)&&(n.newValue=n.default)})),r(e),y(e),w(e)},children:"Reset all values"})})]}),Object(s.jsx)("div",{className:"config-panel__list",children:Hs(l,d,u,(function(e,t){const n=x()(l);n[e].newValue=t,n[e].newValue===n[e].value&&delete n[e].newValue,r(n),w(n),y(n)}))}),function(){if(g){const t=function(e){return Object.keys(e).reduce(((t,n)=>{const a=e[n];return V(a.newValue)&&a.newValue!==a.value&&t.push(Object(s.jsxs)("div",{children:[Object(s.jsx)("h5",{children:n}),Object(s.jsx)("pre",{children:a.newValue})]},n)),t}),[])}(l);if("apply"===g)return function(e,t,n,a){return Object(s.jsxs)(Wt,{buttonRow:Object(s.jsxs)("div",{children:[Object(s.jsx)("div",{className:"config-panel__modal-button-row-hint",children:"You can revert back to the applications default settings by clicking the \u201cReset all values\u201d button; or reset each edited field by clicking \u201cUse default\u201d."}),Object(s.jsxs)("div",{children:[Object(s.jsx)("button",{className:"p-button--neutral",onClick:a,children:"Cancel"},"cancel"),Object(s.jsx)("button",{className:"p-button--positive",onClick:n,children:"Yes, apply changes"},"save")]})]}),children:[Object(s.jsx)("h4",{children:"Are you sure you wish to apply these changes?"}),Object(s.jsxs)("p",{children:["You have edited the following values to the ",e," configuration:"]}),t]})}(e,t,(()=>{N(null),C()}),(()=>N(null)));if("cancel"===g)return function(e,t,n,a){return Object(s.jsxs)(Wt,{buttonRow:[Object(s.jsx)("button",{className:"p-button--neutral",onClick:a,children:"Continue editing"},"cancel"),Object(s.jsx)("button",{className:"p-button--negative",onClick:n,children:"Yes, I'm sure"},"save")],children:[Object(s.jsx)("h4",{children:"Are you sure you wish to cancel?"}),Object(s.jsxs)("p",{children:["You have edited the following values to the ",e," configuration:"]}),t]})}(e,t,(()=>{N(null),c()}),(()=>N(null)))}return null}(),Object(s.jsx)("div",{className:Ct()("config-panel__drawer",{"is-open":null!==g}),children:Object(s.jsxs)("div",{className:"config-panel__button-row",children:[Object(s.jsx)("button",{className:"p-button--neutral",onClick:function(){k(l)?N("cancel"):c()},children:"Cancel"}),Object(s.jsx)("button",{className:Ct()("p-button--positive config-panel__save-button",{"is-active":f}),onClick:function(){N("apply")},disabled:!j||f,children:f?Object(s.jsxs)(s.Fragment,{children:[Object(s.jsx)("i",{className:"p-icon--spinner u-animation--spin is-light"}),Object(s.jsx)("span",{children:"Saving\u2026"})]}):"Save and apply"})]})})]}),Object(s.jsx)("div",{className:"config-panel__description col-6",children:d?Object(s.jsx)(fn,{isActive:!0,className:"config-panel__description-wrapper",children:Object(s.jsxs)(s.Fragment,{children:[Object(s.jsx)("h4",{children:"Configuration Description"}),Object(s.jsx)("h5",{children:d.name}),Object(s.jsx)("pre",{children:d.description})]})},d.name):Object(s.jsx)("div",{className:"config-panel__no-description u-vertically-center",children:Object(s.jsx)(Ws,{})})})]})}):Object(s.jsx)(fn,{isActive:!0,children:Object(s.jsx)("div",{className:"full-size u-align-center",children:Object(s.jsx)(Bs,{})})})})})}async function Ps(e,t,n,s,a,c){return async function(e,t,n){const s=await Ge(e,n);return await s.facades.application.get({application:t})}(e,t,n.getState()).then((e=>{const t={};Object.keys(e.config).forEach((n=>{t[n]=e.config[n],t[n].name=n})),s(!1),a(t),c(t)}))}function Hs(e,t,n,a){return Object.keys(e).map((c=>{const i=e[c];return"boolean"===i.type?Object(s.jsx)(Fs,{config:i,selectedConfig:t,setSelectedConfig:n,setNewValue:a},i.name):Object(s.jsx)(Vs,{config:i,selectedConfig:t,setSelectedConfig:n,setNewValue:a},i.name)}))}function Bs(){return Object(s.jsxs)("div",{className:"config-panel__message",children:[Object(s.jsx)("img",{src:Ds,alt:"",className:"config-panel--center-img"}),Object(s.jsx)("h4",{children:"This application doesn't have any configuration parameters"})]})}function Ws(){return Object(s.jsxs)("div",{className:"config-panel__message",children:[Object(s.jsx)("img",{src:Us,alt:"",className:"config-panel--center-img"}),Object(s.jsx)("h4",{children:"Click on a configuration row to view its related description and parameters"})]})}const Js=e=>e.map((({th:e,td:t})=>Object(s.jsxs)("tr",{className:"panel__tr",children:[Object(s.jsx)("th",{className:"panel__th",children:e}),Object(s.jsx)("td",{className:"panel__td",children:t})]},e+t)));function qs({entity:e}){var t;const n=null===(t=on()["remote-applications"])||void 0===t?void 0:t[e],a=[{th:"Offer name",td:n["offer-name"]||"-"},{th:"Application",td:"-"},{th:"Charm",td:"-"},{th:"Store",td:"-"},{th:"Application",td:n["offer-url"]||"-"},{th:"Status",td:n.status.status||"-"},{th:"Endpoint",td:"-"},{th:"Interface",td:"-"}];return Object(s.jsxs)("div",{className:"panel",children:[Object(s.jsx)("span",{className:"p-muted-heading",children:"flannel:etcd"}),Object(s.jsx)("h5",{children:"Remote Offer info"}),Object(s.jsx)("table",{className:"panel__table",children:Object(s.jsx)("tbody",{children:Js(a)})})]})}function Gs({entity:e}){const t=on(),n=null===t||void 0===t?void 0:t.offers[e],[c,i]=Object(a.useState)(""),o=e=>{i(e===c?"":e)},l=[{th:"Offer name",td:n["offer-name"]},{th:"Application",td:e},{th:"Charm",td:"-"},{th:"Store",td:"-"},{th:"URL",td:"-"}];return Object(s.jsxs)("div",{className:"panel",children:[Object(s.jsx)("span",{className:"p-muted-heading",children:"mysql:db"}),Object(s.jsx)("h5",{children:"Offer info"}),Object(s.jsx)("table",{className:"panel__table",children:Object(s.jsx)("tbody",{children:Js(l)})}),Object(s.jsx)("aside",{className:"p-accordion",children:Object(s.jsxs)("ul",{className:"p-accordion__list",children:[Object(s.jsxs)("li",{className:"p-accordion__group",children:[Object(s.jsx)("button",{type:"button",className:"p-accordion__tab",id:"tab1","aria-controls":"tab1-section","aria-expanded":"tab1"===c,onClick:()=>o("tab1"),children:"Endpoint 1"}),Object(s.jsx)("section",{className:"p-accordion__panel",id:"tab1-section","aria-hidden":"tab1"!==c,"aria-labelledby":"tab1",children:Object(s.jsx)("table",{className:"panel__table",children:Object(s.jsx)("tbody",{children:Js([{th:"Endpoint",td:"-"},{th:"Interface",td:"-"},{th:"Role",td:"-"}])})})})]}),Object(s.jsxs)("li",{className:"p-accordion__group",children:[Object(s.jsx)("button",{type:"button",className:"p-accordion__tab",id:"tab2","aria-controls":"tab2-section","aria-expanded":"tab2"===c,onClick:()=>o("tab2"),children:"Connection 0/0"}),Object(s.jsx)("section",{className:"p-accordion__panel",id:"tab2-section","aria-hidden":"tab2"!==c,"aria-labelledby":"tab2",children:Object(s.jsx)("table",{className:"panel__table",children:Object(s.jsx)("tbody",{children:Js([{th:"UUID",td:"-"},{th:"User",td:"-"},{th:"Relation-id",td:"-"},{th:"Status",td:"-"},{th:"Ingress-subnets",td:"-"}])})})})]}),Object(s.jsxs)("li",{className:"p-accordion__group",children:[Object(s.jsx)("button",{type:"button",className:"p-accordion__tab",id:"tab3","aria-controls":"tab3-section","aria-expanded":"tab3"===c,onClick:()=>o("tab3"),children:"Users"}),Object(s.jsx)("section",{className:"p-accordion__panel",id:"tab3-section","aria-hidden":"tab3"!==c,"aria-labelledby":"tab3",children:Object(s.jsx)("table",{className:"panel__table",children:Object(s.jsx)("tbody",{children:Js([{th:"User",td:"-"},{th:"display-name",td:"-"},{th:"access",td:"-"}])})})})]})]})})]})}n(535);function Ys(e,t,n){switch(e){case"remoteApps":return Object(s.jsx)(qs,{entity:t,panelRowClick:n});case"offers":return Object(s.jsx)(Gs,{entity:t,panelRowClick:n})}}var zs=({type:e,children:t,className:n=""})=>{const{userName:c,modelName:i}=Object(p.i)(),l=Object(p.g)(),r=Object(o.c)(ns(i,c)),d=Object(o.c)(ts(r)),u=Object(o.c)(ss(r)),[j,b]=Object(h.e)({panel:h.c,entity:h.c,activeView:Object(h.f)(h.c,"apps")}),{panel:m,entity:O,activeView:f}=j,g={panel:void 0,entity:void 0},x=Object(o.d)().getState(),[N,_]=Object(a.useState)(!1),y=null===d||void 0===d?void 0:d["controller-uuid"],w=Object(o.c)((e=>Object(v.a)(W,(t=>t?Object.entries(t).find((t=>t[1].find((t=>e===t.uuid)))):null)))(y));let k=null,C="";w&&(k=G(w[0],x),C=w[0].replace("wss://","").replace("/api",""));const E=(e,t)=>{e.preventDefault(),e.target.scrollIntoView({behavior:"smooth",block:"end",inline:"nearest"}),b({activeView:t})};Object(a.useEffect)((()=>{d&&-1!==(null===d||void 0===d?void 0:d.version.indexOf("2.9"))&&_(!0)}),[d]),vn((null===d||void 0===d?void 0:d.name)?`Model: ${null===d||void 0===d?void 0:d.name}`:"...");const S=Object(a.useCallback)(((e,t)=>{if("apps"!==t)return b({panel:t,entity:e});l.push(`/models/${c}/${i}/app/${e}`)}),[b,l,i,c]);return Object(s.jsxs)(mn,{className:n,children:[Object(s.jsx)(pn,{children:Object(s.jsxs)("div",{className:"entity-details__header",children:[Object(s.jsx)(Ts,{}),Object(s.jsx)("div",{className:"entity-details__view-selector","data-testid":"view-selector",children:d&&"model"===e&&Object(s.jsx)(zn.Tabs,{links:(()=>{let e=[{active:"apps"===f,label:"Applications",onClick:e=>E(e,"apps")},{active:"integrations"===f,label:"Integrations",onClick:e=>E(e,"integrations")},{active:"action-logs"===f,label:"Action Logs",onClick:e=>E(e,"action-logs")}];return"kubernetes"!==d.type&&e.push({active:"machines"===f,label:"Machines",onClick:e=>E(e,"machines")}),e})()})})]})}),d?Object(s.jsx)(fn,{isActive:d,children:Object(s.jsx)("div",{className:"l-content",children:Object(s.jsx)("div",{className:`entity-details entity-details__${e}`,children:Object(s.jsxs)(s.Fragment,{children:[t,(()=>{var e;return"config"===m?Object(s.jsx)(Ks,{appName:O,charm:null===u||void 0===u||null===(e=u[O])||void 0===e?void 0:e["charm-url"],modelUUID:r,onClose:()=>b(g)}):"remoteApps"===m||"offers"===m?Object(s.jsx)($s,{isActive:m,onClose:()=>b(g),isLoading:!O,className:`${m}-panel`,children:Ys(m,O,S)}):void 0})()]})})})}):Object(s.jsx)("div",{className:"entity-details__loading","data-testid":"loading-spinner",children:Object(s.jsx)(zn.Spinner,{})}),N&&Object(s.jsx)(Ms,{controllerWSHost:C,credentials:k,modelUUID:r})]})};n(536);function Xs({data:e}){return Object(s.jsx)("div",{className:"entity-info__grid",children:Object.entries(e).map((([e,t])=>Object(s.jsxs)("div",{className:"entity-info__grid-item",children:[Object(s.jsx)("h4",{className:"p-muted-heading",children:e}),Object(s.jsx)("p",{"data-name":e,children:t})]},e)))})}var Qs=n(142),Zs=n.n(Qs);function ea(e,t,n){return Object(s.jsx)(m.b,{to:`/models/${t}/${n}/app/${e}`,children:e})}function ta(e,t,n,a){return e?Object(s.jsxs)(s.Fragment,{children:[K(t,e.charm),ea(t,n,a)]}):Object(s.jsx)(s.Fragment,{children:t})}function na(){const[e,t]=Object(a.useState)([]),[n,c]=Object(a.useState)(!1),{userName:i,modelName:l}=Object(p.i)(),r=Object(o.d)(),d=Object(a.useMemo)((()=>ne(l)),[l]),u=Object(o.c)(d),j=Object(o.c)(oe(u)),b=()=>Object.keys(j.applications);Object(a.useEffect)((()=>{!async function(){const e=await async function(e,t,n){const s=await Ge(t,n);return await s.facades.action.listOperations(e)}({applications:b},u,r.getState());t(e.results),c(!0)}()}),[u]);const m=Object(a.useMemo)((()=>{const t=[];return e&&e.forEach((e=>{const n=e.operation.split("-")[1];let a="";e.actions.forEach(((e,c)=>{a=e.action.name;let o={application:"-",id:"-",status:"-",taskId:"",message:"",completed:""},r={};if(0===c){const s=e.action.receiver.match(/unit-(.+)-\d+/),c=s&&s[1];if(!c)return void console.error("Unable to parse action receiver",e.action.receiver);r={application:ta(j.applications[c],c,i,l),id:`${n}/${a}`,status:k(e.status,void 0,!0,!0)},t.push({...o,...r})}r={application:Object(s.jsxs)(s.Fragment,{children:[Object(s.jsx)("span",{className:"entity-details__unit-indent",children:"\u2514"}),Object(s.jsx)("span",{children:e.action.receiver.replace(/unit-(.+)-(\d+)/,"$1/$2")})]}),id:"",status:k(e.status,void 0,!0,!0),taskId:e.action.tag.split("-")[1],message:e.message||"-",completed:e.completed},t.push({...o,...r})}))})),t}),[e,j.applications,i,l]),h=Object(a.useMemo)((()=>[{Header:"application",accessor:"application"},{Header:"operation id/name",accessor:"id"},{Header:"status",accessor:"status"},{Header:"task id",accessor:"taskId"},{Header:"action message",accessor:"message"},{Header:"completion time",accessor:"completed"}]),[]),O=`There are no action logs available yet for ${l}`;return Object(s.jsx)("div",{className:Ct()("entity-details__action-logs",{"entity-details__loading":!n}),children:n?Object(s.jsx)(Zs.a,{emptyMsg:O,columns:h,data:m}):Object(s.jsx)(Pt.a,{})})}function sa(){const e=Object(p.g)(),[t,n]=Object(a.useState)(null),{userName:s,modelName:c}=Object(p.i)();return Object(a.useEffect)((()=>{const n=t&&t.id.replace("/","-");if("unit"===(null===t||void 0===t?void 0:t.type)){const a=null===n||void 0===n?void 0:n.split("-").slice(0,-1).join("-");s&&c&&t&&a&&e.push(`/models/${s}/${c}/app/${a}/${t.type}/${n}/`)}else s&&c&&t&&e.push(`/models/${s}/${c}/${t.type}/${n}`)}),[t,e,c,s]),(e,t,s)=>{-1===s.target.className.indexOf("p-checkbox")&&n({type:e,id:t})}}const aa=(e,t)=>(t[e]?t[e]=t[e]+=1:t[e]=1,t),ca=(e,t,n)=>e[t]&&Object.entries(e[t]).reduce(((e,t)=>{const s=t[1][n].status;return aa(s,e)}),{});const ia=(e,t,n="")=>{if(!t)return null;let s=null;switch(e){case"localApps":s=ca(t,"applications","status");break;case"relations":s=null;break;case"offers":s=(e=>{let t=0;return Object.entries(e.offers).forEach((e=>{const n=e[1]["total-connected-count"];n>0&&(t+=n)})),{joined:t}})(t);break;case"remoteApps":s=ca(t,"remote-applications","status")}return s},oa=(e,t)=>{switch(t){case"apps":return"apps"===e;case"units":case"machines":case"integrations":case"action-logs":return"relations-title"===e||e===t}};var la=()=>{var e,t;const n=on(),c=Sn(),i=Object(p.g)(),{userName:l,modelName:r}=Object(p.i)(),[d,u]=Object(h.e)({panel:h.c,entity:h.c,activeView:Object(h.f)(h.c,"apps")}),j=Object(o.c)(ns(r,l)),b=sa(),m=Object(a.useCallback)(((e,t)=>{if("apps"!==t)return u({panel:t,entity:e});i.push(`/models/${l}/${r}/app/${e}`)}),[u,i,r,l]),O=Object(o.c)(ss(j)),f=Object(o.c)(cs(j)),v=Object(o.c)(is(j)),g=Object(o.c)(as(j)),N=Object(o.c)(ls(j)),_=Object(a.useMemo)((()=>Os(O,N,b,d)),[O,N,b,d]),y=Object(a.useMemo)((()=>function(e,t,n){if(!e)return[];const s=x()(e["remote-applications"]);return s&&Object.keys(s).map((e=>{const t=s[e],a=t.status.status,c=t["offer-url"],i=Object.keys(null===t||void 0===t?void 0:t.relations).map((e=>e));return{columns:[{"data-test-column":"app",content:t["offer-name"],className:"u-truncate"},{"data-test-column":"status",content:a,className:"u-capitalise u-truncate"},{"data-test-column":"interface",content:i.join(",")},{"data-test-column":"offer_url",content:c,className:"u-truncate"},{"data-test-column":"store",content:"-"}],sortData:{app:e,status:"status",interface:"interface",offer_url:"offer_url",store:"store"},"data-app":e,onClick:e=>!1,className:"remoteApps"===(null===n||void 0===n?void 0:n.panel)&&(null===n||void 0===n?void 0:n.entity)===e?"is-selected":""}}))}(n,0,d)),[n,m,d]),w=Object(a.useMemo)((()=>vs(v,g,b,null===d||void 0===d?void 0:d.entity)),[v,g,b,d]),k=Object(a.useMemo)((()=>function(e,t){return e?Object.keys(e).map((n=>{var a;const c=e[n],{provider:i,requirer:o,peer:l,providerApplicationName:r,requirerApplicationName:d,peerApplicationName:u}=(e=>{const t={};return e.endpoints.forEach((e=>{const n=e.relation.role;t[n]=e["application-name"]+":"+e.relation.name,t[`${n}ApplicationName`]=e["application-name"]})),t})(c),j=i||l||"-",b=o||"-";return{columns:[{content:Object(s.jsxs)(s.Fragment,{children:[P(r||u,t),j]}),className:"u-truncate"},{content:Object(s.jsxs)(s.Fragment,{children:[P(d,t),b]}),title:b,className:"u-truncate"},{content:c.endpoints[0].relation.interface},{content:c.endpoints[0].relation.role}],sortData:{provider:j,requirer:b,interface:c.interface,type:null===c||void 0===c||null===(a=c.endpoints[0])||void 0===a?void 0:a.relation.role}}})):[]}(f,O)),[O,f]),C=Object(a.useMemo)((()=>function(e){if(!e)return[];const t=e["remote-applications"]||{};return Object.keys(t).map((n=>{const a=t[n];return{columns:[{content:Object(s.jsxs)(s.Fragment,{children:[P(a.offerName,e),a.offerName]}),className:"u-truncate"},{content:Object.entries(a.endpoints).map((e=>`${e[1].name}:${e[1].interface}`)).join("/n"),className:"u-truncate"},{content:a.status.status}]}}))}(n)),[n]),E=Object(a.useMemo)((()=>function(e){if(!e)return[];const t=e.offers;return Object.keys(t).map((n=>{const a=t[n];return{columns:[{content:Object(s.jsxs)(s.Fragment,{children:[P(a.applicationName,e),a.applicationName]}),className:"u-truncate"},{content:Object.entries(a.endpoints).map((e=>`${e[1].name}:${e[1].interface}`)).join("/n"),className:"u-truncate"},{content:a.activeConnectedCount}]}}))}(n)),[n]),S=Object(a.useMemo)((()=>function(e,t,n){if(!e)return[];const a=e.offers;return Object.keys(a).map((t=>{const c=a[t],i=Object.keys(null===c||void 0===c?void 0:c.endpoints).map((e=>e));return{columns:[{content:Object(s.jsxs)(s.Fragment,{children:[P(c,e),c["offer-name"]]}),className:"u-truncate"},{content:Object(s.jsx)(s.Fragment,{children:i.join(",")})},{content:Object(s.jsxs)(s.Fragment,{children:[c["active-connected-count"]," /"," ",c["total-connected-count"]]})},{content:"-"}],onClick:e=>!1,"data-app":t,className:"offers"===n.panel&&n.entity===t?"is-selected":""}}))}(n,0,d)),[n,m,d]),A=Object(o.c)(ts(j)),R=ia("localApps",n),I=ia("offers",n),L=ia("remoteApps",n),M=null===_||void 0===_?void 0:_.length,U=null===S||void 0===S?void 0:S.length,D=null===y||void 0===y?void 0:y.length,F=()=>Object(s.jsx)(s.Fragment,{children:!!U&&Object(s.jsx)(s.Fragment,{children:Object(s.jsx)(En.a,{headers:hs,rows:S,className:"entity-details__offers p-main-table",sortable:!0,emptyStateMsg:"There are no offers associated with this model"})})}),V=()=>Object(s.jsx)(s.Fragment,{children:!!M&&Object(s.jsx)(En.a,{headers:rs,rows:_,className:"entity-details__apps p-main-table",sortable:!0,emptyStateMsg:"There are no local applications in this model"})}),K=()=>Object(s.jsx)(s.Fragment,{children:!!D&&Object(s.jsx)(En.a,{headers:ds,rows:y,className:"entity-details__remote-apps p-main-table",sortable:!0,emptyStateMsg:"There are no remote applications in this model"})}),B=(e=>{let t=0;return e.forEach((e=>{e>0&&t++})),t})([M,D,U]),W=Object(h.d)("panel",h.c)[1];return Object(s.jsxs)(zs,{type:"model",children:[Object(s.jsxs)("div",{children:[Object(s.jsx)(Cs,{}),Object(s.jsx)("div",{className:"entity-details__actions",children:H(c,null===n||void 0===n||null===(e=n.info)||void 0===e?void 0:e.users)&&Object(s.jsxs)("button",{className:"entity-details__action-button","data-test":"model-access-btn",onClick:()=>W("share-model"),children:[Object(s.jsx)("i",{className:"p-icon--share"}),"Model access"]})}),A&&Object(s.jsx)(Xs,{data:{controller:A.type,"Cloud/Region":(J=A["cloud-tag"],q=A.region,J&&q?`${T(J)} / ${q}`:""),version:A.version,sla:null===(t=A.sla)||void 0===t?void 0:t.level}})]}),Object(s.jsxs)("div",{className:"entity-details__main u-overflow--scroll",children:[oa("apps",d.activeView)&&Object(s.jsxs)(s.Fragment,{children:[0===B&&Object(s.jsxs)("span",{children:["There are no applications associated with this model. Learn about"," ",Object(s.jsx)("a",{className:"p-link--external",href:"https://juju.is/docs/deploying-applications",children:"deploying applications"})]}),B>1?Object(s.jsxs)(s.Fragment,{children:[!!U&&Object(s.jsx)(Es,{title:Object(s.jsxs)(s.Fragment,{children:[Object(s.jsxs)("span",{children:[U," ",$(U,"Offer")]}),Object(s.jsx)(Yn,{chips:I,descriptor:null})]}),openByDefault:!0,children:F()}),!!M&&Object(s.jsx)(Es,{title:Object(s.jsxs)(s.Fragment,{children:[Object(s.jsxs)("span",{children:[M," ",$(M,"Local application")]}),Object(s.jsx)(Yn,{chips:R,descriptor:null})]}),openByDefault:!0,children:V()}),!!D&&Object(s.jsx)(Es,{title:Object(s.jsxs)(s.Fragment,{children:[Object(s.jsxs)("span",{children:[D," ",$(D,"Remote application")]}),Object(s.jsx)(Yn,{chips:L,descriptor:null})]}),openByDefault:!0,children:K()})]}):Object(s.jsxs)(s.Fragment,{children:[V(),F(),K()]})]}),oa("machines",d.activeView)&&w.length>0&&Object(s.jsx)(En.a,{headers:js,rows:w,className:"entity-details__machines p-main-table",sortable:!0,emptyStateMsg:"There are no machines in this model"}),oa("integrations",d.activeView)&&k.length>0?Object(s.jsxs)(s.Fragment,{children:[oa("relations-title",d.activeView)&&Object(s.jsxs)("h5",{children:["Relations (",k.length,")"]}),Object(s.jsx)(En.a,{headers:bs,rows:k,className:"entity-details__relations p-main-table",sortable:!0,emptyStateMsg:"There are no relations in this model"}),oa("relations-title",d.activeView)&&Object(s.jsx)(s.Fragment,{children:C.length>0||E.length>0&&Object(s.jsxs)("h5",{children:["Cross-model relations (",C.length+E.length,")"]})}),C.length>0&&Object(s.jsx)(En.a,{headers:ms,rows:C,className:"entity-details__relations p-main-table",sortable:!0,emptyStateMsg:"There are no remote relations in this model"}),E.length>0&&Object(s.jsx)(En.a,{headers:ps,rows:E,className:"entity-details__relations p-main-table",sortable:!0,emptyStateMsg:"There are no connected offers in this model"})]}):Object(s.jsx)(s.Fragment,{children:"integrations"===d.activeView&&Object(s.jsxs)("span",{"data-testid":"no-integrations-msg",children:["There are no integrations associated with this model -"," ",Object(s.jsx)("a",{className:"p-link--external",href:"https://juju.is/integration",children:"learn more about integration"})]})}),oa("action-logs",d.activeView)&&Object(s.jsx)(na,{})]})]});var J,q},ra=n(50),da=n.n(ra);function ua({children:e,onFormChange:t=(()=>{}),onSetup:n=(()=>{})}){const{values:c,setFieldValue:i}=Object(Yt.d)();return Object(a.useEffect)((()=>{n(i)}),[n,i]),Object(a.useEffect)((()=>{t(c)}),[t,c]),Object(s.jsx)(Yt.b,{children:e})}var ja=n.p+"static/media/run-action-icon.341fa27f.svg",ba=n.p+"static/media/action-logs-icon.1a01b6a9.svg";function ma(){const e=Object(p.g)(),{appName:t,userName:n,modelName:c}=Object(p.i)(),[i,l]=Object(a.useState)(!1),r=Object(a.useRef)(null),d=Object(a.useRef)(),u=Object(a.useRef)([]),j=Object(a.useRef)(!1),b=Object(o.c)(ns(c,n)),m=Object(o.c)(ss(b)),O=Object(o.c)(as(b)),f=Object(o.c)(is(b)),v=Object(o.c)(ts(b)),g=sa(),N=Object(a.useMemo)((()=>{const e={};return O&&f?(Object.entries(O).forEach((([n,s])=>{if(s.application===t){const t=s["machine-id"];e[t]=f[t]}})),e):null}),[O,f,t]),_=Object(a.useMemo)((()=>vs(N,O,g)),[N,O,g]),y="kubernetes"===(null===v||void 0===v?void 0:v.type),w=Object(a.useMemo)((()=>{const e="unit-list-select-all";return((e,t)=>{let n=x()(us);return t&&(n=n.filter((e=>!("machine"===e.sortKey)))),n.splice(0,0,e),n})({content:Object(s.jsxs)("label",{className:"p-checkbox--inline",htmlFor:e,children:[Object(s.jsx)(Yt.a,{id:e,type:"checkbox","aria-labelledby":"select-all-units",className:"p-checkbox__input",name:"selectAll"}),Object(s.jsx)("span",{className:"p-checkbox__label",id:"select-all-units"})]}),sortKey:"",className:"select-unit"},y)}),[y]),C=Object(a.useMemo)((()=>{if(!O)return null;const e={};return Object.entries(O).forEach((([n,s])=>{(s.application===t||s.subordinate&&s.principal.split("/")[0]===t)&&(e[n]=s)})),e}),[O,t]),E=Object(a.useMemo)((()=>fs(C,g,!0,y)),[C,g,y]),[S,A]=Object(h.d)("tableview",Object(h.f)(h.c,"units")),[R,I]=Object(h.e)({activeView:Object(h.f)(h.c,"apps"),entity:h.c,panel:h.c}),L=null===m||void 0===m?void 0:m[t];let M={};var $;L&&(M={status:k(null===($=L.status)||void 0===$?void 0:$.current),charm:L["charm-url"],os:"Ubuntu",revision:D(L["charm-url"])||"-",message:"-",provider:(null===v||void 0===v?void 0:v.type)||"-"});const T=Object(a.useMemo)((()=>function(e,t){const n={};return e&&Object.entries(e).forEach((([e,s])=>{if(s.application===t){const e=s["agent-status"].current;if(e)return aa(e,n)}})),n}(O,t)),[O,t]),U=Object(a.useMemo)((()=>function(e,t,n){const s={};if(e&&t){const a=[];Object.entries(t).forEach((([e,t])=>{t.application===n&&a.push(t["machine-id"])})),a.forEach((t=>{const n=e[t]["agent-status"].current;if(n)return aa(n,s)}))}return s}(f,O,t)),[f,O,t]),[F,V]=Object(h.e)({panel:h.c,units:h.a}),K=()=>{V({panel:"execute-action",units:u.current})};return Object(s.jsxs)(zs,{type:"app",className:"entity-details__app",children:[Object(s.jsxs)("div",{children:[Object(s.jsx)(Cs,{}),Object(s.jsxs)(s.Fragment,{children:[Object(s.jsx)("div",{className:"entity-details__actions",children:Object(s.jsxs)("button",{className:"entity-details__action-button",onClick:()=>{R&&I({panel:"config",entity:t})},children:[Object(s.jsx)("i",{className:"p-icon--settings"}),"Configure"]})}),Object(s.jsx)(Xs,{data:M})]})]}),Object(s.jsxs)("div",{className:"entity-details__main u-overflow--scroll",children:[!y&&Object(s.jsx)(Gn,{buttons:["units","machines"],activeButton:S,setActiveButton:A}),Object(s.jsxs)("div",{className:"entity-details__tables",ref:r,children:["units"===S&&Object(s.jsxs)(s.Fragment,{children:[Object(s.jsx)(Yn,{chips:T,descriptor:"units"}),Object(s.jsxs)("div",{className:"entity-details__action-button-row",children:[Object(s.jsxs)(da.a,{appearance:"base",className:"entity-details__action-button",hasIcon:!0,onClick:K,disabled:!i,"data-test":"run-action-button",children:[Object(s.jsx)("img",{className:"entity-details__action-button-row-icon",src:ja,alt:""}),"Run action"]}),Object(s.jsx)("span",{className:"entity-details__action-button-divider"}),Object(s.jsxs)(da.a,{appearance:"base",className:"entity-details__action-button",hasIcon:!0,onClick:()=>{e.push(`/models/${n}/${c}?activeView=action-logs`)},"data-test":"show-action-logs",children:[Object(s.jsx)("img",{className:"entity-details__action-button-row-icon",src:ba,alt:""}),"View Action Logs"]})]}),Object(s.jsx)(Yt.c,{initialValues:{selectAll:!1,selectedUnits:[]},onSubmit:()=>{},children:Object(s.jsx)(ua,{onFormChange:e=>{if(!d.current)return;let n=[];O&&(n=Object.keys(O).filter((e=>O[e].application===t))),j.current&&!e.selectAll?u.current.length===n.length&&d.current("selectedUnits",[]):!j.current&&e.selectAll&&d.current("selectedUnits",n),j.current=e.selectAll,u.current.length!==n.length&&e.selectedUnits.length===n.length?d.current("selectAll",!0):u.current.length===n.length&&e.selectedUnits.length!==n.length&&d.current("selectAll",!1),u.current.length!==e.selectedUnits.length&&"execute-action"===F.panel&&(u.current=e.selectedUnits,K()),u.current=e.selectedUnits,l(e.selectedUnits.length>0)},onSetup:e=>{d.current=e},children:Object(s.jsx)(En.a,{headers:w,rows:E,className:"entity-details__units p-main-table panel__table has-checkbox",sortable:!0,emptyStateMsg:"There are no units in this application","data-test":"units-table"})})})]}),"machines"===S&&Object(s.jsxs)(s.Fragment,{children:[Object(s.jsx)(Yn,{chips:U,descriptor:"machines"}),Object(s.jsx)(En.a,{headers:js,rows:_,className:"entity-details__machines p-main-table panel__table",sortable:!0,emptyStateMsg:"There are no machines in this model","data-test":"machines-table"})]})]})]})]})}function pa(){const{modelName:e,userName:t,unitId:n}=Object(p.i)(),c=n.replace(/-(\d+)$/,"/$1"),i=sa(),l=Object(o.c)(ns(e,t)),r=Object(o.c)(ss(l)),d=Object(o.c)(as(l)),u=Object(o.c)(is(l)),j=Object(o.c)(ts(l)),b=Object(a.useMemo)((()=>{const e={};if(u&&d){const t=d[c]["machine-id"];e[t]=u[t]}return e}),[u,d,c]),m=Object(a.useMemo)((()=>{const e={};if(r&&d){const t=d[c].application;e[t]=r[t]}return e}),[r,d,c]),h=Object(o.c)(ls(l)),O=Object(a.useMemo)((()=>vs(b,d,i)),[b,d,i]),f=Object(a.useMemo)((()=>Os(m,h,i)),[m,h,i]),v=null===d||void 0===d?void 0:d[c];let g={};if(v){const e=(null===v||void 0===v?void 0:v["charm-url"])||"-";g={charm:e,os:"-",revision:D(e)||"-",version:(null===v||void 0===v?void 0:v["workload-status"].version)||"-",message:(null===v||void 0===v?void 0:v["workload-status"].message)||"-"}}return Object(s.jsxs)(zs,{type:"unit",children:[Object(s.jsxs)("div",{children:[Object(s.jsx)(Cs,{}),Object(s.jsx)(Xs,{data:g})]}),Object(s.jsx)("div",{className:"entity-details__main u-overflow--scroll",children:Object(s.jsxs)("div",{className:"slide-panel__tables",children:["kubernetes"!==(null===j||void 0===j?void 0:j.type)&&Object(s.jsx)(En.a,{headers:js,rows:O,className:"entity-details__machines p-main-table",sortable:!0,emptyStateMsg:"There are no machines in this model"}),Object(s.jsx)(En.a,{headers:rs,rows:f,className:"entity-details__apps p-main-table",sortable:!0,emptyStateMsg:"There are no apps in this model"})]})})]})}function ha(){const{machineId:e,modelName:t,userName:n}=Object(p.i)(),c=sa(),i=Object(o.c)(ns(t,n)),l=Object(o.c)(ss(i)),r=Object(o.c)(as(i)),d=Object(o.c)(is(i)),u=null===d||void 0===d?void 0:d[e],j=Object(o.c)(ls(i)),b=Object(a.useMemo)((()=>{if(!l||!r)return null;const t={},n=new Set;return Object.entries(r).forEach((([t,s])=>{s["machine-id"]===e&&n.add(s.application)})),[...n].forEach((e=>{t[e]=l[e]})),t}),[l,r,e]),m=Object(a.useMemo)((()=>{if(!r)return null;const t={};return Object.entries(r).forEach((([n,s])=>{s["machine-id"]===e&&(t[n]=s)})),t}),[r,e]),h=Object(a.useMemo)((()=>Os(b,j,c)),[b,j,c]),O=Object(a.useMemo)((()=>fs(m,c)),[m,c]),f=null===u||void 0===u?void 0:u["hardware-characteristics"],v={memory:(null===f||void 0===f?void 0:f.mem)||"-",disk:(null===f||void 0===f?void 0:f["root-disk"])||"-",cpu:(null===f||void 0===f?void 0:f["cpu-power"])||"-",cores:(null===f||void 0===f?void 0:f["cpu-cores"])||"-",message:(null===u||void 0===u?void 0:u["agent-status"].message)||"-"};return Object(s.jsxs)(zs,{type:"machine",children:[Object(s.jsxs)("div",{children:[Object(s.jsx)(Cs,{}),Object(s.jsx)(Xs,{data:v})]}),Object(s.jsx)("div",{className:"entity-details__main u-overflow--scroll",children:Object(s.jsx)("div",{children:Object(s.jsxs)("div",{className:"entity-detail__tables",children:[Object(s.jsx)(En.a,{headers:us,rows:O,className:"entity-details__units p-main-table",sortable:!0,emptyStateMsg:"There are no units in this machine"}),Object(s.jsx)(En.a,{headers:rs,rows:h,className:"entity-details__apps p-main-table",sortable:!0,emptyStateMsg:"There are no apps in this machine"})]})})})]})}function Oa(){const e=Object(o.d)().getState(),t=Object(o.b)(),{userName:n,modelName:c}=Object(p.i)(),i=Object(o.c)(ns(c,n));return Object(a.useEffect)((()=>{let n=null,s=null,a=null;return i&&async function(){({conn:n,watcherHandle:a,pingerIntervalId:s}=await Ye(i,e,t));const c=await n.facades.client.fullStatus();null!==c&&t(function(e,t){return{type:Te,payload:{status:t,uuid:e}}}(i,c))}(),()=>{a&&async function(e,t,n){e.facades.allWatcher._transport.write({type:"AllWatcher",request:"Stop",version:1,id:t}),He(n),e.transport.close()}(n,a["watcher-id"],s)}}),[i]),Object(s.jsxs)(p.d,{children:[Object(s.jsx)(p.b,{path:"/models/:userName/:modelName",exact:!0,children:Object(s.jsx)(la,{})}),Object(s.jsx)(p.b,{path:"/models/:userName/:modelName/app/:appName",exact:!0,children:Object(s.jsx)(ma,{})}),Object(s.jsx)(p.b,{path:"/models/:userName/:modelName/app/:appName/unit/:unitId",exact:!0,children:Object(s.jsx)(pa,{})}),Object(s.jsx)(p.b,{path:"/models/:userName/:modelName/machine/:machineId",exact:!0,children:Object(s.jsx)(ha,{})})]})}n(537);function fa(){vn("Settings");const[e,t]=an("disableAnalytics",!1);return Object(s.jsxs)(mn,{children:[Object(s.jsx)(pn,{children:Object(s.jsx)("span",{className:"l-content settings__header",children:"Settings"})}),Object(s.jsx)(fn,{isActive:!0,children:Object(s.jsx)("div",{className:"l-content settings",children:Object(s.jsx)("div",{className:"settings__toggles",children:Object(s.jsxs)("div",{className:"settings__toggles-group",children:[Object(s.jsxs)("label",{children:["Disable analytics",Object(s.jsx)("input",{type:"checkbox",className:"p-switch",defaultChecked:e,onChange:()=>{t(!e)}}),Object(s.jsx)("div",{className:"p-switch__slider"})]}),Object(s.jsx)("div",{className:"settings__toggles-info",children:"You will need to refresh your browser for this setting to take effect."})]})})})})]})}function va({message:e,children:t}){return Object(s.jsxs)(s.Fragment,{children:[Object(s.jsx)("h1",{children:Object(s.jsx)("span",{role:"img","aria-label":"Shrug",children:"\xaf\\_(\u30c4)_/\xaf"})}),Object(s.jsx)("h2",{children:e}),Object(s.jsx)("div",{className:"not-found__content",children:t})]})}function ga(){return vn("404 - Page not found"),Object(s.jsx)(mn,{children:Object(s.jsx)("div",{className:"p-strip",children:Object(s.jsx)("div",{className:"row",children:Object(s.jsxs)(va,{message:"Hmm, we can't seem to find that page...",children:[Object(s.jsx)("p",{children:"Are you looking for any of the pages below?"}),Object(s.jsxs)("ul",{children:[Object(s.jsx)("li",{children:Object(s.jsx)(m.b,{to:"/models",children:"Models"})}),Object(s.jsx)("li",{children:Object(s.jsx)(m.b,{to:"/controllers",children:"Controllers"})}),Object(s.jsx)("li",{children:Object(s.jsx)(m.b,{to:"/settings",children:"Settings"})})]})]})})})})}function xa(){const e=St(),t=Object(p.h)();return Object(a.useEffect)((()=>{e({path:window.location.href.replace(window.location.origin,"")})}),[t,e]),Object(s.jsxs)(p.d,{children:[Object(s.jsx)(p.b,{path:"/",exact:!0,children:Object(s.jsx)(p.a,{to:"/models"})}),Object(s.jsx)(p.b,{path:"/models",exact:!0,children:Object(s.jsx)(ht,{children:Object(s.jsx)(Xn,{})})}),Object(s.jsx)(p.b,{path:"/models/:userName/:modelName",children:Object(s.jsx)(ht,{children:Object(s.jsx)(Oa,{})})}),Object(s.jsx)(p.b,{path:"/controllers",exact:!0,children:Object(s.jsx)(ht,{children:Object(s.jsx)(kn,{})})}),Object(s.jsx)(p.b,{path:"/settings",exact:!0,children:Object(s.jsx)(ht,{children:Object(s.jsx)(fa,{})})}),Object(s.jsx)(p.b,{children:Object(s.jsx)(ga,{})})]})}n(538);var Na=function(){const e=null!==!0||!0,{baseAppURL:t}=Object(o.c)(q),[n]=an("disableAnalytics",!1);return!e||n&&"false"!==n||(O.a.initialize("UA-1018242-68"),O.a.pageview(window.location.href.replace(window.location.origin,""))),Object(s.jsx)(m.a,{basename:t,children:Object(s.jsx)(f,{children:Object(s.jsx)(h.b,{ReactRouterRoute:p.b,children:Object(s.jsx)(xa,{})})})})};const _a=["POPULATE_MISSING_ALLWATCHER_DATA","PROCESS_ALL_WATCHER_DELTAS","STORE_BAKERY","STORE_LOGIN_ERROR","STORE_CONFIG","STORE_USER_PASS","STORE_VERSION","UPDATE_CONTROLLER_CONNECTION","UPDATE_CONTROLLER_LIST","UPDATE_JUJU_API_INSTANCE","UPDATE_PINGER_INTERVAL_ID","LOG_OUT","CLEAR_CONTROLLER_DATA","CLEAR_MODEL_DATA","STORE_VISIT_URL","TOGGLE_USER_MENU","SIDENAV_COLLAPSED"],ya=["connectAndStartPolling","logOut"];function wa(e,t){console.log("unable to perform action:",e,"user not authenticated for:",t)}const ka=(e,t)=>(t||console.error("unable to determine logged in status"),se(t,e));var Ca=({getState:e})=>t=>async(n,s)=>{const a=e(),c=null===s||void 0===s?void 0:s.wsControllerURL;if("function"===typeof n){if(ya.includes(n.NAME)||ka(a,c))return void await t(n);wa(n.NAME,c)}else{if(_a.includes(n.type)||ka(a,c))return void t(n);wa(n.type,c)}},Ea=n(72);var Sa=function(e={},t){return Object(Ea.a)(e,(n=>{switch(t.type){case at:const s=x()(e.controllerConnections||{});s[t.payload.wsControllerURL]=t.payload.conn,n.controllerConnections=s;break;case Qe:n.bakery=t.payload;break;case Ze:n.config=t.payload;break;case et:n.loginError=t.payload;break;case tt:const a=x()(e.credentials||{});a[t.payload.wsControllerURL]=t.payload.credential,n.credentials=a;break;case nt:n.appVersion=t.payload;break;case st:n.visitURL=t.payload;break;case Xe:delete n.bakery.storage._store.identity,delete n.controllerConnections,delete n.visitURL;break;case ct:const c=x()(e.jujus||{});c[t.payload.wsControllerURL]=t.payload.juju,n.jujus=c;break;case it:const i=x()(e.pingerIntervalIds||{});i[t.payload.wsControllerURL]=t.payload.intervalId,n.pingerIntervalIds=i}}))};var Aa=function(e={userMenuActive:!1,confirmationModalActive:!1,sideNavCollapsed:!1},t){return Object(Ea.a)(e,(e=>{switch(t.type){case At.userMenuActive:e.userMenuActive=t.payload;break;case At.confirmationModalActive:e.confirmationModalActive=t.payload;break;case At.sideNavCollapsed:e.sideNavCollapsed=t.payload}}))},Ra=n(61),Ia=n.n(Ra);let La,Ma,$a;function Ta(e,t,n,s,a){if(e===Ma.CHANGE){const e={[a]:t};Ia()(n[s],e)}else e===Ma.REMOVE&&s!==$a.MODEL&&delete n[s][a]}function Ua(e,t){if(t)return t.forEach((t=>{const n=t[2]["model-uuid"];e[n]||(e[n]={actions:{},annotations:{},applications:{},charms:{},machines:{},model:{"cloud-tag":"","controller-uuid":"","is-controller":!1,"model-uuid":"",config:{},constraints:{},life:"",name:"",owner:"",region:"",sla:{level:"",owner:""},status:{current:"",message:"",since:"",version:""},type:"",version:""},relations:{},units:{}});const s=e[n],a=Ta.bind(null,t[1],t[2],s);if(t[0]===La.ACTION)a($a.ACTIONS,t[2].id);else if(t[0]===La.ANNOTATION){const e={[t[2].tag.replace("application-","")]:t[2].annotations};Ia()(s[$a.ANNOTATIONS],e)}else if(t[0]===La.APPLICATION){const e={[t[2].name]:t[2]};void 0===e[t[2].name]["unit-count"]&&(e[t[2].name]["unit-count"]=0),Ia()(s[$a.APPLICATIONS],e)}else if(t[0]===La.CHARM)a($a.CHARMS,t[2]["charm-url"]);else if(t[0]===La.MACHINE)a($a.MACHINES,t[2].id);else if(t[0]===La.MODEL)t[1]===Ma.CHANGE&&Ia()(e[n].model,t[2]);else if(t[0]===La.RELATION)a($a.RELATIONS,t[2].key);else if(t[0]===La.UNIT){a($a.UNITS,t[2].name);const e={};Object.entries(s.units).forEach((([t,n])=>{const s=t.split("/")[0];void 0===e[s]&&(e[s]=0),e[s]+=1})),Object.entries(e).forEach((([e,t])=>{s.applications[e]||(s.applications[e]={}),s.applications[e]["unit-count"]=t}))}})),e}!function(e){e.ACTION="action",e.ANNOTATION="annotation",e.APPLICATION="application",e.CHARM="charm",e.MACHINE="machine",e.MODEL="model",e.RELATION="relation",e.UNIT="unit"}(La||(La={})),function(e){e.CHANGE="change",e.REMOVE="remove"}(Ma||(Ma={})),function(e){e.ACTIONS="actions",e.ANNOTATIONS="annotations",e.APPLICATIONS="applications",e.CHARMS="charms",e.MACHINES="machines",e.MODEL="model",e.RELATIONS="relations",e.UNITS="units"}($a||($a={}));const Da={models:{},modelData:{},modelWatcherData:{}};function Fa(e=Da,t){return Object(Ea.a)(e,(n=>{var s,a;const c=t.payload;switch(t.type){case Me:const o=x()(e.models||{});let l=t.payload["user-models"];l||(l=[]),l.forEach((e=>{o[e.model.uuid]={lastConnection:e.lastConnection,name:e.model.name,ownerTag:e.model["owner-tag"],type:e.model.type,uuid:e.model.uuid}})),n.models=o;break;case Le:const r=c.modelUUID;n.modelData[r]||(n.modelData[r]={});["annotations","applications","machines","model","offers","relations","remote-applications"].forEach((e=>{n.modelData[r][e]=c.status[e]})),n.modelData[r].uuid=r;break;case Ie:const d=c.results[0].result;n.modelData[d.uuid]&&(n.modelData[d.uuid].info=d);break;case Ae:n.modelData={},n.models={};break;case Se:n.controllers={};break;case Re:const u=x()(e.controllers||{});u[t.payload.wsControllerURL]=t.payload.controllers,n.controllers=u;break;case Te:var i;if(!(null===(s=n.modelWatcherData)||void 0===s||null===(a=s[c.uuid])||void 0===a?void 0:a.model))(null===(i=n.modelWatcherData)||void 0===i?void 0:i[c.uuid])||(n.modelWatcherData[c.uuid]={}),n.modelWatcherData[c.uuid].model={};Ia()(n.modelWatcherData[c.uuid].model,{"cloud-tag":c.status.model["cloud-tag"],type:c.status.model.type,region:c.status.model.region,version:c.status.model.version});break;case $e:n.modelWatcherData=Ua(n.modelWatcherData,c)}}))}var Va=n(148);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));j.a({dsn:"https://5f679e274f34464194e9592a91ed65d4@sentry.is.canonical.com//29"}),b.b("dashboardVersion",Va.a);let Ka=0;const Pa=()=>{if(window.jujuDashboardConfig)!function(){const e=window.jujuDashboardConfig;b.b("isJuju",e.isJuju);const t=Object(l.createStore)(Object(l.combineReducers)({root:Sa,juju:Fa,ui:Aa}),Object(d.composeWithDevTools)(Object(l.applyMiddleware)(Ca,r.a)));t.dispatch(function(e){return{type:Ze,payload:e}}(e)),t.dispatch((n=Va.a,{type:nt,payload:n}));var n;const c=new u.Bakery({visitPage:e=>{var n;t.dispatch((n=e.Info.VisitURL,{type:st,payload:n}))},storage:new u.BakeryStorage(localStorage,{})});t.dispatch(function(e){return{type:Qe,payload:e}}(c)),e.identityProviderAvailable&&t.dispatch(rt(t,c));const j=document.getElementById("root");i.a.render(Object(s.jsx)(o.a,{store:t,children:Object(s.jsx)(a.StrictMode,{children:Object(s.jsx)(Na,{})})}),j)}();else{if(Ka<5)return Ka++,void setTimeout(Pa,500);console.error("Configuration values not defined unable to bootstrap application")}};Pa(),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((e=>{e.unregister()}))}},[[539,1,2]]]);
//# sourceMappingURL=main.a7afb0e3.chunk.js.map